
## فاکتور

<div class="tab-start">
</div>

# [csharp](#tab/csharp)

## صدور فاکتور توسط کسب وکار 
هرگونه پرداخت در پلتفرم پاد، از طریق فاکتور صورت می‌گیرد. در این بخش صدور فاکتور با استفاده از توکن کسب‌و‌کار شرح داده شده و می‌توان با خروجی حاصل از این متد، کاربر را به راحتی به درگاه پرداخت هدایت نمود. برای  صدور فاکتور از سرویس زیر استفاده نمایید. شبه کد زیر یک فاکتور با دو بند  فاکتور را شامل می شود:
پارامترهای اختیاری کامنت شده اند,برای استفاده می توانید از حالت کامنت خارج کنید.

``` csharp
var output = new ResultSrv<InvoiceSrv>();
                var invoiceSrv = IssueInvoiceVo.ConcreteBuilder
                    .SetGuildCode("{put your guildCode}")
                    .SetProductsInfo(new List<ProductInfo>
                    {                         
               ProductInfo.ConcreteBuilder.SetProductId(0).SetPrice(1000).SetQuantity(3).SetProductDescription("tst1").Build(),                         
                ProductInfo.ConcreteBuilder.SetProductId(0).SetPrice(1000).SetQuantity(3).SetProductDescription("tst1").Build()
                    })
                    .SetOtt("{Put your ott}")
                    //.SetPreview({put your preview})
                    //.SetMetadata("{put your metadata}")
                    //.SetUserId({put user id})
                    //.SetAddressId("{put your addressId}")
                    .Build(); // Create new instance 
 billingService.IssueInvoice(invoiceSrv, response => Listener.GetResult(response, out output));

```

## لیست آدرس
در صورتی که تمایل به ارسال آدرس مشتری دارید، از طریق سرویس زیر شناسه‌های آدرس‌های موجود برای کاربر را استخراج نمایید.
 پارامترهای اختیاری کامنت شده اند,برای استفاده می توانید از حالت کامنت خارج کنید.

``` csharp
 var output = new ResultSrv<AddressSrv>();
                var invoiceSrv = ListAddressVo.ConcreteBuilder
                    .SetOffset("0")
                    //.SetSize("")
                    .Build();
 billingService.GetListAddress(invoiceSrv, response => Listener.GetResult(response, out output));

```

## تایید پرداخت فاکتور
در صورتی که در صدور فاکتور پارامتر verificationNeeded را با مقدار true  ارسال نموده باشید، پرداخت سه مرحله ای فعال شده است. به این معنی که پس از هدایت کاربر به صفحه پرداخت(فقط در صورت پرداخت فاکتور از طریق اتصال به  درگاه می توانید سرویس تایید فاکتور را صدا بزنید) و دریافت پاسخ در redirectUri لازم است پرداخت توسط کسب و کار با استفاده از API زیر تایید شود. 
در صورتی که فاکتور مورد نظر تسهیمی است، شناسه ای که باید به این سرویس  ارسال گردد، معادل result -> id موجود در خروجی فاکتور تسهیمی می باشد.
پارامترهای اختیاری کامنت شده اند,برای استفاده می توانید از حالت کامنت خارج کنید.

``` csharp
var output = new ResultSrv<InvoiceSrv>();
var verifyInvoiceVo = VerifyInvoiceVo.ConcreteBuilder
                    .SetId({put your id})
                    //.SetBillNumber("{put your billNumber}")
                    .Build();
billingService.VerifyInvoice(verifyInvoiceVo, response => Listener.GetResult(response, out output));
```

## بستن فاکتور
فاکتور هایی که بسته شوند دیگر قابل ابطال نیستند. برای اینکه بتوانید مبالغ فروش خود را تسویه نمایید لازم است حتما فاکتورها را ببندید.

``` csharp
var output = new ResultSrv<bool>();
var closeInvoiceVo = CloseInvoiceVo.ConcreteBuilder
                    .SetId({put your id})
                    .Build();
billingService.CloseInvoice(closeInvoiceVo, response => Listener.GetResult(response, out output));

```

## تایید و بستن در یک مرحله
با فراخوانی سرویس زیر، می‌توانید همزمان تایید و بستن فاکتور را انجام دهید.

``` csharp
var output = new ResultSrv<InvoiceSrv>();
var verifyAndCloseInvoiceVo = VerifyAndCloseInvoiceVo.ConcreteBuilder
                    .SetId({put your id})
                    .Build();
billingService.VerifyAndCloseInvoice(verifyAndCloseInvoiceVo,response => Listener.GetResult(response, out output));

```

## ابطال فاکتور
در صورتی که فاکتور باطل شود، دیگر قابل پرداخت نیست و در صورتی که قبلا پرداخت شده باشد، مبلغ آن به پرداخت کننده برگشت خواهد خورد. 
توجه: در صورتی که فاکتور با شرایط safe=true صادر شده باشد، فقط پرداخت  کننده می تواند فاکتور را کنسل کند و اگر safe نباشد فقط issuer فاکتور  مجاز به کنسلی فاکتور می باشد. 

``` csharp
var output = new ResultSrv<bool>();
var cancelInvoiceVo = CancelInvoiceVo.ConcreteBuilder
                    .SetId({put your id})
                    .Build();
billingService.CancelInvoice(cancelInvoiceVo, response => Listener.GetResult(response, out output));
```

## دریافت فاکتور
با فراخوانی سرویس زیر می توانید فاکتورهایی که کسب و کار شما صادر نموده و همچنین وضعیت آنها را مشاهده نمایید.

``` csharp
var output = new ResultSrv<List<InvoiceSrv>>();
var getInvoiceListVo = GetInvoiceListVo.ConcreteBuilder
                    .SetSize({Put your size})
                    .SetOffset({Put your offset})
                    //.SetGuildCode("{put your guildCode}")
                    .Build();
billingService.GetInvoiceList(getInvoiceListVo, response => Listener.GetResult(response, out output));

```

## دریافت فاکتور با متا دیتا
از طریق این سرویس می توانید تمام فاکتورهایی که برای آنها متادیتا تعریف کرده اید دریافت کنید. 
در قسمت metaQuery مقادیر درخواستی خود را به فرم json با استفاده از توصیحات جستجوی متادیتا ارسال نمایید.
https://docs.pod.land/v1.0.8.0/Developer/CustomPost/400/SearchMetadata

``` csharp
var output = new ResultSrv<List<InvoiceSrv>>();
var getInvoiceListByMetadataVo = GetInvoiceListByMetadataVo.ConcreteBuilder
                    //.SetMetaQuery("{Put your metaQuery}")
                    //.SetSize({Put your size})
                    //.SetOffset({Put your offset})
                    //.SetIsCanceled({put your value})
                    //.SetIsPayed({put your value})
                    .Build();
billingService.GetInvoiceListByMetadata(getInvoiceListByMetadataVo, response => Listener.GetResult(response, out output));
```

## دریافت لیست فاکتورها در قالب فایل
از طریق سرویس زیر امکان دریافت لیست فاکتورها در قالب فایل وجود دارد. 
وارد کردن یکی از فیلدهای زیر ضروری است : lastNRows,fromDate,toDate

``` csharp
var output = new ResultSrv<InvoiceSrv>();
var getInvoiceListAsFileVo = GetInvoiceListAsFileVo.ConcreteBuilder
                    .SetLastNRows({Put your LastNRows})
                    //.SetFromDate({Put your FromDate})
                    //.SetToDate({Put your ToDate})
                    //.SetGuildCode("{Put your GuildCode}")
                    //.SetId({Put your Id})
                    //.SetBillNumber("{Put your BillNumber}")
                    //.SetUniqueNumber("{Put your UniqueNumber}")
                    //.SetTrackerId({Put your TrackerId})
                    //.SetIsCanceled({Put your IsCanceled})
                    //.SetIsClosed({Put your IsClosed})
                    //.SetIsPayed({Put your IsPayed})
                    //.SetIsWaiting({Put your IsWaiting})
                    //.SetReferenceNumber("{Put your ReferenceNumber}")
                    //.SetUserId({Put your UserId})
                    //.SetQuery("{Put your Query}")
                    //.SetProductIdList({Put your ProductIdList})
                    //.SetCallbackUrl("{Put your CallbackUrl}")
                    .Build();
billingService.GetInvoiceListAsFile(getInvoiceListAsFileVo,response => Listener.GetResult(response, out output));

```

## کاهش فاکتور
در مواردی ممکن است نیاز به تغییری در بندهای فاکتور داشته باشید. در صورتی که فاکتور پرداخت نشده است، فاکتور قبلی را باطل (cancel) نمایید و فاکتور جدیدی صادر کنید. اگر فاکتور پرداخت شده است(در صورتی که باید پول بیشتری از مشتری دریافت نمایید)، لازم است فاکتوری جداگانه به مبلغ افزوده شده، با ذکر دلیل صادر نموده و مشتری را مجددا برای پرداخت هدایت نمایید. در برخی مواقع لازم است مبلغی از فاکتور پرداخت شده به مشتری بازگردانده شود. برای این منظور از API زیر برای اصلاح فاکتور پرداخت شده استفاده نمایید.

``` csharp
var output = new ResultSrv<InvoiceSrv>();
var reduceInvoiceVo = ReduceInvoiceVo.ConcreteBuilder
                    .SetId({Put your id})
                    .SetInvoiceItemsInfo(new List<InvoiceItemInfoVo>
                    {
                        InvoiceItemInfoVo.ConcreteBuilder.SetInvoiceItemId({Put your id}).SetItemDescription("{Put your description}").SetPrice({Put your price}).SetQuantity({Put your quantity}).Build(),
                        InvoiceItemInfoVo.ConcreteBuilder.SetInvoiceItemId({Put your id}).SetItemDescription("{put your description}").SetPrice({Put your price}).SetQuantity({Put your quantity}).Build()
                    })
                    //.SetPreferredTaxRate({Put your PreferredTaxRate})
                    .Build();
billingService.ReduceInvoice(reduceInvoiceVo, response => Listener.GetResult(response, out output));

```

## دریافت لینک دانلود فایل های اکسل
جهت مشاهده وضعیت هریک از سرویس های درخواست داده شده خود برای دریافت فایل خروجی فاکتورها  میتوانید از سرویس
زیر استفاده نمایید.
در صورتی که وضعیت سرویس موفقیت آمیز بوده باشد از طریق تابع GetLink  میتوانید به لینک فایل ایجاد شده توسط سیستم دسترسی داشته باشید.مقادیر hashCode و fileId را پس از دریافت از سرویس GetExportList در تابع GetLink جایگذاری نمایید.

``` csharp
var output = new ResultSrv<List<ExportServiceSrv>>();
var getExportListVo = GetExportListVo.ConcreteBuilder
                    .SetOffset({Put your Offset})
                    //.SetSize({Put your Size})
                    //.SetId({Put your Id})
                    //.SetStatusCode({Put your StatusCode})
                    //.SetServiceUrl("{Put your ServiceUrl}")
                    .Build();
billingService.GetExportList(getExportListVo, response => Listener.GetResult(response, out output));
var link=getExportListVo.GetLink({Put your FileId}, "{Put your HashCode}");
```

## پرداخت فاکتور خارج از پلتفرم پاد
در صورتی که فاکتور به هر شکلی بجز امکانات موجود در پلتفرم پادپرداخت شد، میتوانید با استفاده از سرویس زیر، وضعیت آن را به حالت پرداخت شده ببرید. در این روش هیچ گونه سند مالی در پلتفرم ثبت نشده و به اعتبار افزوده نمی شود. دقت نمایید که کسب و کار فقط می تواند فاکتورهایی که خودش صادر نموده را با این روش پرداخت کند.

``` csharp
var output = new ResultSrv<bool>();
var payInvoiceVo = PayInvoiceVo.ConcreteBuilder
                    .SetInvoiceId({Put your InvoiceId})
                    .Build();
billingService.PayInvoice(payInvoiceVo, response => Listener.GetResult(response, out output));

```

## پرداخت فاکتور با کیف پول از طریق پیامک
در صورتی که کاربر به رایانه جهت پرداخت دسترسی ندارد، یا در فروش حضوری، کسب و کار میتواند درخواست ارسال پیامک
پرداخت به کاربر دهد و کاربر با پیامک کردن کدی که دریافت کرده به همان شماره، فاکتور را از کیف پول خود پرداخت مینماید.

``` csharp
var output = new ResultSrv<bool>();
var sendInvoicePaymentSmsVo = SendInvoicePaymentSmsVo.ConcreteBuilder
                    .SetInvoiceId({Put your InvoiceId})
                    //.SetWallet("{Put your Wallet}")
                    //.SetCallbackUri("Put your CallbackUri")
                    //.SetRedirectUri("Put your RedirectUri")
                    //.SetDelegationId({Put your DelegationId})
                    //.SetForceDelegation({Put your ForceDelegation})
                    .Build();
billingService.SendInvoicePaymentSms(sendInvoicePaymentSmsVo,response => Listener.GetResult(response, out output));

```

## پرداخت فاکتور در آینده
از طریق این سرویس کسب و کار قادر خواهد بود فاکتورهایی که برایش توسط دیگران صادر شده را درتاریخ آینده یا سررسید توافقی از طریق مبلغی که در کیف پول یا اصناف خود دارد  پرداخت نماید.
این سرویس باید توسط کسب و کار یا کاربر بدهکار یا شخصی که فاکتور برایش صادر شده صدا زده شود در غیر این صورت با خطای "فاکتور برای شما صادر نشده است" روبرو خواهد شد.

``` csharp
var output = new ResultSrv<bool>();
var ottOutput = GetOtt();
var payInvoiceInFutureVo = PayInvoiceInFutureVo.ConcreteBuilder
                    .SetInvoiceId({Put your InvoiceId})
                    .SetDate("{Put your Date}")
                    .SetOtt(ottOutput.Ott)
                    //.SetGuildCode("{Put your GuildCode}")
                    //.SetWallet("{Put your Wallet}")
                    .Build();
billingService.PayInvoiceInFuture(payInvoiceInFutureVo,response => Listener.GetResult(response, out output));
```

## پرداخت فاکتور از طریق فاکتور
از طریق این سرویس کسب و کار قادر خواهد بود که پرداخت شدن برخی فاکتورهای خود را منوط به پرداخت شدن فاکتورهای دیگری
نماید. یا به عبارتی نوعی تهاتر را بوسیله فاکتورها انجام دهد که این امر توسط سرویس زیر قابل اجرا خواهد بود.

``` csharp
var output = new ResultSrv<bool>();
var payInvoiceByInvoiceVo = PayInvoiceByInvoiceVo.ConcreteBuilder
                    .SetCreditorInvoiceId({Put your CreditorInvoiceId})
                    .SetDebtorInvoiceId({Put your DebtorInvoiceId})
                    .Build();
billingService.PayInvoiceByInvoice(payInvoiceByInvoiceVo,response => Listener.GetResult(response, out output));

```

## نمایش پیش فاکتور
در پلتفرم کسب و کار، فاکتورهایی که پرداخت می شوند به صورت سالانه شماره سریال دریافت می نمایند، بنابرین کسب و کار می
تواند برای امور مالی خود به آن شماره سریال استناد نماید. در برخی شرایط، ممکن است کسب و کار بخواهد فاکتور تا زمانی که اقدام به پرداخت آن نشده اصلاً ثبت نگردد. بدین منظور با استفاده از سرویس زیر می تواند پیش فاکتور را ثبت نماید و با لینک بعدی آن را نمایش دهد. به محض اینکه مشتری، فاکتور را با کیف پول خود پرداخت نماید یا برای پرداخت وارد درگاه بانکی شود، فاکتور ثبت می گردد. در صورتی که مشتری پرداخت را از طریق درگاه لغو نماید یا اشکالی در پرداخت او به وجود آید، فاکتور به صورت خودکار لغو خواهد شد. 
دریافت می نمایید .
در پاسخ درخواست سرویس CreatePreInvoice یک کد hash دریافت می نمایید که  باید از طریق  ()createPreInvoiceVo.GetLink لینک را دریافت کرده و کاربر  را به آن آدرس هدایت کنید.

``` csharp
var output = new ResultSrv<string>();
var ottOutput = GetOtt();
var createPreInvoiceVo = CreatePreInvoiceVo.ConcreteBuilder
                    .SetToken({Put your ApiToken})
                    .SetOtt(ottOutput.Ott)
                    .SetProductsInfo(new List<ProductInfo>
                    {
                        ProductInfo.ConcreteBuilder.SetProductId({Put your ProductId}).SetPrice({Put your Price}).SetQuantity({Put your Quantity}).SetProductDescription("{Put your ProductDescription}").Build(),
                        ProductInfo.ConcreteBuilder.SetProductId({Put your ProductId}).SetPrice({Put your Price}).SetQuantity({Put your Quantity}).SetProductDescription("{Put your ProductDescription}").Build()
                    })
                    .SetGuildCode("{Put your GuildCode}")
                    .SetRedirectUri("{Put your RedirectUri}")
                    .SetUserId({Put your UserId})
                    //.SetBillNumber("{Put your BillNumber}")
                    //.SetCallUrl("{Put your CallUrl}")
                    //.SetCurrencyCode("{Put your CurrencyCode}")
                    //.SetDeadline("{Put your Deadline}")
                    //.SetDescription("{Put your Description}")
                    //.SetPreferredTaxRate({Put your PreferredTaxRate})
                    //.SetRedirectUri("{Put your RedirectUri}")
                    //.SetVerificationNeeded({Put your VerificationNeeded})
                    .Build();
billingService.CreatePreInvoice(createPreInvoiceVo,response => Listener.GetResult(response, out output));
var linkSrv = createPreInvoiceVo.GetLink(output.Result);

```

## پرداخت از کیف پول با ورود به SSO
مشتری برای مشاهده فاکتور خود و پرداخت آن از طریق کیف پول خود، لازم است از طریق آدرسی که تابع ()payInvoiceByWalletVo.GetLink  بعنوان خروجی می دهد هدایت شود.
مقدار invoiceId، مقداری است که از پاسخ سرویس issueInvoice با عنوان id  دریافت می‌نمایید و این مقدار از billNumber که توسط خود کسب و کار انتخاب  شده است، متمایز می‌باشد.
در این حالت، مشتری باید لاگین باشد و در صورتی که شناسه اشتباه وارد شود با خطای " فاکتور یافت نشد " مواجه می شود.

``` csharp
 var payInvoiceByWalletVo = PayInvoiceByWalletVo.ConcreteBuilder
                    .SetInvoiceId({Put your InvoiceId})
                    //.SetCallUri("{Put your CallUri}")
                    //.SetRedirectUri("{Put your RedirectUri}")
                    .Build();
var output = payInvoiceByWalletVo.GetLink();

```

## دریافت لینک پرداخت 
ممکن است لازم باشد لینک پرداخت برای مشتری با روش های مختلفی ارسال شود. این لینک قابل اشتراک گذاری خواهد بود و هر کسی که آن را داشته باشد می تواند آن را پرداخت نماید. برای دریافت لینک از سرویسGetInvoicePaymentLink استفاده نمایید.
در پاسخ سرویس فوق یک لینک دریافت خواهید کرد که در صورت تمایل، می‌توانید  پارامترهای redirectUri ، callbackUri و "gateway="PEP را به تایع ()getInvoicePaymentLinkVo.GetAdvanceLink ارسال نمایید و لینک خود را دریافت نمایید. اگر پارامتر "gateway="PEP را  بگذارید، لینک تولید شده کاربر را مستقیما به صفحه درگاه پرداخت بانک  پاسارگاد هدایت خواهد شد و در صورت ارسال پارامتر redirectUri کاربر ملزم  به تکمیل فرآیند خرید، خواهد بود. 
توجه داشته باشید که لینک فوق، شامل یک هش کد می‌باشد که مدت اعتبار آن 300 ثانیه می‌باشد؛لذا در صورتی که با پیغام خطای " کد وارد شده معتبر نمی‌باشد و یا منقضی شده است." روبه‌رو شدید ممکن است کد هش منقضی شده باشد.

``` csharp
var output = new ResultSrv<string>();
var getInvoicePaymentLinkVo = GetInvoicePaymentLinkVo.ConcreteBuilder
                    .SetInvoiceId({Put your InvoiceId})
                    .Build();
billingService.GetInvoicePaymentLink(getInvoicePaymentLinkVo,response => Listener.GetResult(response, out output));
var advanceLink = getInvoicePaymentLinkVo.GetAdvanceLink(output.Result, "PEP");

```

## پرداخت پیشرفته 
کسب و کار میتواند برای تمام مشتریان خود، بدون نیاز به ورود به سامانه احراز هویت یکپارچه، امکان خرید را از طریق لینک ()payInvoiceByUniqueNumberVo.GetLink  فراهم کند. برای این منظور لازم است کسب و کار از کد یکتا که برای فاکتور تولید می شود استفاده نماید. مراحل انجام کار به ترتیب:

1. ثبت نام کسب و کار در
https://services.pod.land

2. دریافت توکن جهت فراخوانی سرویس ها

3. ثبت فاکتور : دقت نمایید در صورت تمایل به نمایش شماره کارت های مربوط به  مشتری، در صفحه درگاه ضروری است شناسه کاربر (userId) در فاکتور ثبت شود.  این شناسه پس از ورود کاربر از طریق SSO بدست آمده یا می تواند شناسه ی  کاربر آفلاین (غیر SSO) باشد. در صورتی که شماره موبایل مربوط به هیچکدام  از این دودسته نیست، می توان با ثبت شماره موبایل (cellphoneNumber) در فاکتور، همین نتیجه را دریافت نمود.

4.  هدایت کاربر به درگاه ( از طریق  ()payInvoiceByUniqueNumberVo.GetLink لینک را دریافت نمایید )

5. تایید پرداخت

6.بستن فاکتور

7. تسویه

پارامتر redirectUri آدرسی است که بعد از پرداخت کاربر به آن هدایت می  گردد، پارامتر callUri نیز آدرسی در سرور شما میتواند باشد که در صورت موفق بودن پرداخت فراخوانی می گردد. پس از پرداخت پارمترهای زیر به صورت GET به  آدرس redirectUri برگردانده می شود. توجه: در صورتی که پارامتر gateway ارسال شود کاربر مستقیم به درگاه پرداخت بانک پاسارگاد متنقل می گردد. اگر مقدار uniqueNumber اشتباه ارسال شود، به صفحه "صفحه یافت نشد" هدایت می شوید.

``` csharp
var payInvoiceByUniqueNumberVo = PayInvoiceByUniqueNumberVo.ConcreteBuilder
                    .SetUniqueNumber("{Put your UniqueNumber}")
                    //.SetGateway("{Put your Gateway}")
                    //.SetRedirectUri("{Put your RedirectUri}")
                    //.SetCallUri("{Put your CallUri}")
                    .Build();
var output = payInvoiceByUniqueNumberVo.GetLink();

```

## تسویه از حساب مشتری (برداشت از کیف پول)
کسب و کار می تواند از طریق سرویس RequestSettlement  و ایجاد نمونه از کلاس RequestWalletSettlementVo ،
مبلغ مورد نظر خود را از کیف پولش به شماره شبای ثبت شده در پروفایل خود منتقل کند. در صورتی که شماره شبا یا نام و نام خانوادگی شخص در پروفایل ثبت نشده باشد این سرویس خطا خواهد داد. کد ارز شامل کد سه حرفی رایج برای واحدهای پولی است. مانند
IRR و USD

``` csharp
var ottOutput = GetOtt();
var output = new ResultSrv<SettlementRequestSrv>();
var requestWalletSettlementVo= RequestWalletSettlementVo.ConcreteBuilder
                    .SetAmount({Put your Amount})
                    .SetOtt(ottOutput.Ott)
                    //.SetWallet("{Put your Wallet}")
                    //.SetFirstName("{Put your FirstName}")
                    //.SetLastName("{Put your LastName}")
                    //.SetSheba("{Put your Sheba}")
                    //.SetCurrencyCode("{Put your CurrencyCode}")
                    //.SetUniqueId("{Put your UniqueId}")
                    //.SetDescription("{Put your Description}")
                    .Build();
billingService.RequestSettlement(requestWalletSettlementVo, response => Listener.GetResult(response, out output));

```

## تسویه از حساب صنفی کسب و کار
در حساب های صنفی همواره مبلغی به عنوان مبلغ قابل تسویه وجود دارد که شامل دارایی کسب و کار بجز فاکتورهای باز او یا فاکتورهایی که مبلغ آن ها هنوز واریز نشده است، می باشد. مبلغ قابل تسویه را می توان از طریق RequestSettlement و ایجاد نمونه از کلاس RequestGuildSettlementVo تسویه نمود. کد ارز شامل کد سه حرفی رایج برای واحدهای پولی است. مانند
IRR و USD

``` csharp
var ottOutput = GetOtt();
var output = new ResultSrv<SettlementRequestSrv>();
var requestGuildSettlementVo= RequestGuildSettlementVo.ConcreteBuilder
                    .SetGuildCode("{Put your GuildCode}")
                    .SetAmount({Put your Amount})
                    .SetOtt(ottOutput.Ott)
                    //.SetFirstName("{Put your FirstName}")
                    //.SetLastName("{Put your LastName}")
                    //.SetSheba("{Put your Sheba}")
                    //.SetCurrencyCode("{Put your CurrencyCode}")
                    //.SetUniqueId("{Put your UniqueId}")
                    //.SetDescription("{Put your Description}")
                    .Build();
billingService.RequestSettlement(requestGuildSettlementVo,response => Listener.GetResult(response, out output));

```

##انتقال وجه از حساب کسب و کاری به کارت بانکی (با کسر کارمزد) یا شماره شبا
کسب و کار می تواند با استفاده از سرویس زیر مبلغ مورد نظر خود را از حساب مجازی به یک شماره کارت یا یک شماره شبا بانکی منتقل نماید. بدیهی است که در صورت استفاده از ابزار کارت به کار، کارمزد بانکی از حساب کسب و کار کسر خواهد شد و در صورت استفاده از ابزار پایا، انتقال وجه در زمان مصوب بانک مرکزی انجام خواهد شد. برای پارامتر toolCode از یکی از مقادیر زیر استفاده نمایید:
SETTLEMENT_TOOL_SATNA
SETTLEMENT_TOOL_PAYA
SETTLEMENT_TOOL_CARD
   و به طور مثال، در صورتی که انتقال از طریق کارت را انتخاب نموده اید، در قسمت toolId شماره کارت مقصد را وارد نمایید و در غیر این صورت شماره شبا را وارد نمایید. کد ارز شامل کد سه حرفی رایج برای واحدهای پولی است. مانند IRR و USD

``` csharp
var ottOutput = GetOtt();
var output = new ResultSrv<SettlementRequestSrv>();
var requestSettlementByToolVo = RequestSettlementByToolVo.ConcreteBuilder
                    .SetToolCode({Put your ToolCode})
                    .SetToolId("{Put your ToolId}")
                    .SetAmount("{Put your Amount}")
                    .SetGuildCode("{Put your GuildCode}")
                    .SetOtt(ottOutput.Ott)
                    //.SetFirstName("{Put your FirstName}")
                    //.SetLastName("{Put your LastName}")
                    //.SetCurrencyCode("{Put your CurrencyCode}")
                    //.SetUniqueId("{Put your UniqueId}")
                    //.SetDescription("{Put your Description}")
                    .Build();
billingService.RequestSettlement(requestSettlementByToolVo,response => Listener.GetResult(response, out output));

```

## گزارش وضعیت تسویه
جهت دریافت لیست تسویه ها و وضعیت آن ها از سرویس ListSettlements استفاده نمایید.

``` csharp
var output = new ResultSrv<List<SettlementRequestSrv>>();
var listSettlementsVo = ListSettlementsVo.ConcreteBuilder
                    .SetOffset({Put your Offset})                    
                    //.SetSize({Put your Size})
                    //.SetStatusCode({Put your StatusCode})
                    //.SetFromAmount({Put your FromAmount})
                    //.SetToAmount({Put your ToAmount})
                    //.SetFromDate("{Put your FromDate}")
                    //.SetToDate({Put your ToDate})
                    //.SetUniqueId("{Put your UniqueId}")
                    //.SetCurrencyCode("{Put your CurrencyCode}")
                    .Build();
billingService.ListSettlements(listSettlementsVo, response => Listener.GetResult(response, out output));

```

## فعالسازی تسویه خودکار در صورتی
که تسویه خودکار برای یک کسب و کارفعال شود، مبلغ قابل تسویه آن کسب و کار به طور خودکار، یکبار در شبانه روز به شماره شبای اعلام شده در پروفایل کسب و کار یا شماره شبای اعلامی در سرویس زیر، تسویه می گردد. برای فعالسازی تسویه خودکار سرویس زیر را با توکن کسب و کار دارنده حساب فراخوانی نمایید.

``` csharp
var ottOutput = GetOtt();
var output = new ResultSrv<bool>();
var addAutoSettlementVo = AddAutoSettlementVo.ConcreteBuilder
                    .SetGuildCode("{Put your GuildCode}")
                    .SetOtt(ottOutput.Ott)
                    //.SetFirstName("{Put your FirstName}")
                    //.SetLastName("{Put your LastName}")
                    //.SetSheba("{Put your Sheba}")
                    //.SetCurrencyCode("{Put your CurrencyCode}")
                    //.SetInstant({Put your Instant})
                    .Build();
billingService.AddAutoSettlement(addAutoSettlementVo,response => Listener.GetResult(response, out output));

```

## لغو تسویه خودکار
با سرویس زیر می‌توانید تسویه خودکار را غیرفعال نمایید.

``` csharp
var output = new ResultSrv<bool>();
var registerUserVo = RemoveAutoSettlementVo.ConcreteBuilder
                    .SetGuildCode("{Put your GuildCode}")
                    //.SetCurrencyCode("{Put your CurrencyCode}")
                    .Build();
billingService.RemoveAutoSettlement(registerUserVo,response => Listener.GetResult(response, out output));

```

## اجازه ثبت فاکتور
در صورتی که بخشی از فروش شما به کسب و کار دیگری تعلق دارد و میخواهید فاکتور به نام همان کسب و کار ثبت شود، لازم است آن کسب و کار به کسب و کار شما اجازه صدور فاکتور به عنوان معامله گر را داده باشد. برای این منظور خود کسب و کار ذینفع یا کارگزار او، با استفاده از توکن که در اختیار دارد، با استفاده از سرویس زیر به کسب کار دیگر اجازه صدور فاکتور می دهد.

``` csharp
var output = new ResultSrv<BusinessDealerSrv>();
var addDealerVo = AddDealerVo.ConcreteBuilder
                    .SetDealerBizId({Put your DealerBizId})
                    //.SetAllProductAllow({Put your AllProductAllow})
                    .Build();
billingService.AddDealer(addDealerVo, response => Listener.GetResult(response, out output));

```

## دریافت لیست کسب و کارها
برای دریافت یا جستجوی لیست تمام کسب و کارهایی که به آنها مجوز معامله و صدور فاکتور داده اید، از سرویس زیر استفاده نمایید.
توجه داشته باشید در صورتی که شناسه کسب و کار را اشتباه وارد کنید، با اررور "شناسه کسب و کار یافت نشد" مواجه نخواهید شد بلکه در فایل خروجی هیچ مقداری دریافت نخواهید کرد.
(با hasError": false")

``` csharp
var output = new ResultSrv<List<BusinessDealerSrv>>();
var dealerListVo = DealerListVo.ConcreteBuilder
                    //.SetDealerBizId(0)
                    //.SetEnable(false)
                    //.SetOffset(0)
                    //.SetSize(0)
                    .Build();
billingService.DealerList(dealerListVo, response => Listener.GetResult(response, out output));
```

## فعالسازی مجوز معامله گران
برای فعالسازی مجوز معامله گران، به ترتیب از سرویس  زیر استفاده نمایید.

``` csharp
var output = new ResultSrv<BusinessDealerSrv>();
 var enableDealerVo = EnableDealerVo.ConcreteBuilder
                    .SetDealerBizId({Put your DealerBizId})
                    .Build();
billingService.EnableDealer(enableDealerVo, response => Listener.GetResult(response, out output));

```

## فعالسازی مجوز معامله گران
برای غیر فعالسازی مجوز معامله گران، از سرویس  زیر استفاده نمایید.

``` csharp
var output = new ResultSrv<BusinessDealerSrv>();
 var enableDealerVo = EnableDealerVo.ConcreteBuilder
                    .SetDealerBizId({Put your DealerBizId})
                    .Build();
billingService.EnableDealer(enableDealerVo, response => Listener.GetResult(response, out output));
```

## لیست کسب و کارهایی که واسط آن هستید
با فراخوانی سرویس زیر می توانید لیست کسب و کارهایی که واسط آن ها شده اید را دریافت نمایید.

``` csharp
var output = new ResultSrv<List<BusinessDealerSrv>>();
var businessDealingListVo = BusinessDealingListVo.ConcreteBuilder
                    .SetDealerBizId({Put your DealerBizId})
                    //.SetEnable({Put your Enable})
                    //.SetOffset({Put your Offset})
                    //.SetSize({Put your Size})
                    .Build();
billingService.BusinessDealingList(businessDealingListVo,response => Listener.GetResult(response, out output));

```

## صدور فاکتور تسهیمی
این نوع فاکتور برای زمانی مناسب است که شما بخواهید محصولات یا خدمات سایر کسب و کارها را به فروش برسانید و یا در بازی‌ها بخواهید برای طراح، برنامه‌نویس، تولید‌کننده‌ی محتوا و ... سهم‌های جداگانه در نظر بگیرید. در این شرایط می‌توانید نوعی فاکتور با قوانین تسهیم فروش صادر نمایید. ظاهراً خریدار تغییری را احساس نخواهد کرد و یک فاکتور تجمیعی را پرداخت می‌­کند. ولی در عمل، به تعداد ذینفعان با مبلغ تسهیمی، فاکتور صادر شده و مبا‌لغ مستقیماً پس از پرداخت به حساب آن‌­ها منتقل می‌شود.

کسب و کار معامله گر که لازم است فاکتور تسهیمی صادر نماید باید از جانب کسب و کارهای سهیم دارای مجوز صدور فاکتور باشد. سپس می‌تواند با استفاده از سرویس زیر تسهیم فروش انجام دهد.

``` csharp
var output = new ResultSrv<InvoiceSrv>();
var ottOutput = GetOtt();
var mainInvoiceVos = MainInvoiceVo.ConcreteBuilder
                    .SetGuildCode("{Put your GuildCode}")
                    .SetInvoiceItemVOs(new List<InvoiceItemVo>
                    {
                        InvoiceItemVo.ConcreteBuilder.SetProductId({Put your ProductId}).SetDescription("{Put your 
                        Description}").SetPrice({Put your Price}).SetQuantity({Put your Quantity}).Build()
                    })
                    //.SetBillNumber("{Put your BillNumber}")
                    //.SetDescription("{Put your Description}")
                    //.SetMetadata("{Put your Metadata}")
                    .Build();

var subInvoiceVos = new List<SubInvoiceVo>
                {
                    SubInvoiceVo.ConcreteBuilder
                        .SetBusinessId({Put your BusinessId})
                        .SetGuildCode("{Put your GuildCode}")
                        .SetInvoiceItemVOs(new List<InvoiceItemVo>
                        {
                            InvoiceItemVo.ConcreteBuilder.SetProductId({Put your ProductId}).SetDescription("{Put your 
                            Description}").SetPrice({Put your Price}).SetQuantity({Put your Quantity}).Build()
                        })
                        //.SetBillNumber("{Put your BillNumber}")
                        .SetDescription("{Put your Description}")
                        //.SetMetadata("{Put your Metadata}")
                        .Build()

                };
var customerInvoiceItems = new List<InvoiceItemVo>
                {
                    InvoiceItemVo.ConcreteBuilder.SetProductId({Put your ProductId}).SetDescription("{Put your 
                            Description}").SetPrice({Put your Price}).SetQuantity({Put your Quantity}).Build()
                };
                var multiInvoiceData = MultiInvoiceDataVo.ConcreteBuilder
                    .SetMainInvoice(mainInvoiceVos)
                    .SetSubInvoices(subInvoiceVos)
                    .SetCustomerInvoiceItemVOs(customerInvoiceItems)
                    //.SetPreview({Put your Preview})
                    //.SetCurrencyCode("Put your CurrencyCode")
                    //.SetCustomerDescription("{Put your CustomerDescription}")
                    //.SetCustomerMetadata("{Put your CustomerMetadata}")
                    //.SetPreferredTaxRate({Put your PreferredTaxRate})
                    //.SetRedirectUrl("{Put your RedirectUrl}")
                    //.SetUserId({Put your UserId})
                    //.SetVerificationNeeded({Put your VerificationNeeded})
                    //.SetVoucherHashs({Put your VoucherHashs})
                    .Build();

var issueMultiInvoiceVo = IssueMultiInvoiceVo.ConcreteBuilder
                    .SetOtt(ottOutput.Ott)
                    .SetData(multiInvoiceData)
                    //.SetDelegationHash("{Put your DelegationHash}")
                    //.SetDelegatorId("{Put your DelegatorId}")
                    //.SetForceDelegation("{Put your ForceDelegatio}")
                    .Build();
billingService.IssueMultiInvoice(issueMultiInvoiceVo, response => Listener.GetResult(response, out output));

```

## کاهش فاکتور تسهیمی
در فاکتور تسهیمی نیز مانند فاکتور عادی با لغو شدن، کل مبلغ فاکتور و با کاهش، قسمتی از مبلغ به مشتری بازگردانده می شود. ولی در فاکتور تسهیمی برای کاهش لازم است کل سهم ها مجدداً اعلام شوند تا مبلغی که کسر می شود از حساب درست برداشته شود. برای کاهش فاکتور تسهیمی از سرویس ReduceMultiInvoice استفاده نمایید.
مقدار id در تمام بخش های اطلاعات ارسالی باید مطابق با شناسه های فاکتور اصلی باشد، در غیر این صورت خطا رخ می دهد. در فاکتور اصلاح شده نیز شرایط زیر لازم است برقرار باشد:      
the share of dealer + the share of shareholder =  the price to be payed by customer

``` csharp
 var output = new ResultSrv<InvoiceSrv>();
var mainInvoiceVos = ReduceInvoiceItemVo.ConcreteBuilder
                    .SetId({Put your Id})
                    .SetReduceInvoiceItemVOs(new List<ReduceInvoiceSubItemVo>
                    {
                        ReduceInvoiceSubItemVo.ConcreteBuilder.SetId({Put your Id}).SetDescription("{Put your Description}").SetPrice({Put your Price}).SetQuantity({Put your Quantity}).Build()
                    })
                    .Build();

var subInvoiceVos = new List<ReduceInvoiceItemVo>
                {
                    ReduceInvoiceItemVo.ConcreteBuilder
                        .SetId({Put your Id})
                        .SetReduceInvoiceItemVOs(new List<ReduceInvoiceSubItemVo>
                        {
                            ReduceInvoiceSubItemVo.ConcreteBuilder.SetId({Put your Id}).SetDescription("{Put your 
                            Description}").SetPrice({Put your Price}).SetQuantity({Put your Quantity}).Build()
                        })
                        .Build()
                };
                var customerInvoiceItems = new List<ReduceInvoiceSubItemVo>
                {
                    ReduceInvoiceSubItemVo.ConcreteBuilder.SetId({Put your Id}).SetDescription("{Put your Description}").SetPrice({Put your Price}).SetQuantity({Put your Quantity})
                        .Build()
                };

var reduceMultiInvoiceDataVo = ReduceMultiInvoiceDataVo.ConcreteBuilder
                    .SetMainInvoice(mainInvoiceVos)
                    .SetSubInvoices(subInvoiceVos)
                    .SetCustomerInvoiceItemVOs(customerInvoiceItems)
                    //.SetPreferredTaxRate({Put your PreferredTaxRate})
                    .Build();

var reduceMultiInvoiceVo = ReduceMultiInvoiceVo.ConcreteBuilder
                    .SetData(reduceMultiInvoiceDataVo)
                    .Build();
billingService.ReduceMultiInvoice(reduceMultiInvoiceVo, response => Listener.GetResult(response, out output));

```

## کاهش فاکتور تسهیمی و انتقال به شبا
در صورتی که می خواهید بلافاصله بعد از کاهش فاکتور، مبلغ برگشتی به شماره شبا کاربر منتقل گردد، از سرویس زیر با همان فرمت data سرویس ReduceMultiInvoice، استفاده نمایید.

``` csharp
var output = new ResultSrv<InvoiceSrv>();
var mainInvoiceVos = ReduceInvoiceItemVo.ConcreteBuilder
                    .SetId({Put your Id})
                    .SetReduceInvoiceItemVOs(new List<ReduceInvoiceSubItemVo>
                    {
                        ReduceInvoiceSubItemVo.ConcreteBuilder.SetId({Put your Id}).SetDescription("{Put your 
                        Description}").SetPrice({Put your Price}).SetQuantity({Put your Quantity}).Build()
                    })
                    .Build();

var subInvoiceVos = new List<ReduceInvoiceItemVo>
                {
                    ReduceInvoiceItemVo.ConcreteBuilder
                        .SetId({Put your Id})
                        .SetReduceInvoiceItemVOs(new List<ReduceInvoiceSubItemVo>
                        {
                            ReduceInvoiceSubItemVo.ConcreteBuilder.SetId({Put your Id}).SetDescription("{Put your Description}").SetPrice(50)
                                .SetQuantity({Put your Quantity}).Build()
                        })
                        .Build()
                };
                var customerInvoiceItems = new List<ReduceInvoiceSubItemVo>
                {
                    ReduceInvoiceSubItemVo.ConcreteBuilder.SetId({Put your Id}).SetDescription("{Put your 
                    Description}").SetPrice({Put your Price}).SetQuantity({Put your Quantity}).Build()
                };

var reduceMultiInvoiceDataVo = ReduceMultiInvoiceDataVo.ConcreteBuilder
                    .SetMainInvoice(mainInvoiceVos)
                    .SetSubInvoices(subInvoiceVos)
                    .SetCustomerInvoiceItemVOs(customerInvoiceItems)
                    //.SetPreferredTaxRate({Put your PreferredTaxRate})
                    .Build();

var reduceMultiInvoiceAndCashoutVo = ReduceMultiInvoiceAndCashoutVo.ConcreteBuilder
                    .SetData(reduceMultiInvoiceDataVo)
                    .SetToolCode({Put your ToolCode})
                    .Build();
billingService.ReduceMultiInvoiceAndCashout(reduceMultiInvoiceAndCashoutVo, response => Listener.GetResult(response, out output));

```

## مجوز فروش محصول
همانطور که توضیح داده شد، به منظور صدور فاکتور تسهیمی (در صورت شراکت با یک کسب و کار دیگر)، فراخوانی سرویس nzh/biz/addDealer قبل از فراخوانی سرویس صدور فاکتور تسهیمی، الزامی ست. اما در صورتی که برای یک محصول خاص، بخواهید به کسب و کار دیگری مجوز صدور فاکتور عادی اعطا کنید، علاوه بر فراخوانی سرویس ذیل، باید سرویس nzh/biz/addDealer را نیز فراخوانی نمایید و سپس سرویس صدور فاکتور(nzh/issueInvoice) را  فراخوانی نمایید؛ در غیر این صورت با خطای  "کسب و کار دلال وارد شده دلال  کسب و کار مالک محصول نمی باشد" مواجه خواهید شد.
شناسه محصول(EntityId) و شناسه کسب و کار(DealerBizId) را کافی ست در در  کلاس AddDealerProductPermissionVo مقداردهی نمایید و سپس سرویس AddDealerProductPermission فراخوانی کنید.

``` csharp
var output = new ResultSrv<DealerProductPermissionSrv>();
var registerUserVo = AddDealerProductPermissionVo.ConcreteBuilder
                    .SetEntityId({Put your EntityId})
                    .SetDealerBizId({Put your DealerBizId})
                    .Build();
billingService.AddDealerProductPermission(registerUserVo, response => Listener.GetResult(response, out output));

```

## دریافت لیست مجوزها
با این سرویس می توانید لیست مجوزهای خود به کسب و کارهای واسط دیگر را به انضمام شناسه محصول، مشاهده نمایید.

``` csharp
var output = new ResultSrv<List<DealerProductPermissionSrv>>();
var registerUserVo = DealerProductPermissionListVo.ConcreteBuilder
                    //.SetSize({Put your Size})
                    //.SetDealingBusinessId({Put your DealingBusinessId})
                    //.SetEnable({Put your Enable})
                    //.SetOffset({Put your Offset})
                    //.SetEntityId({Put your EntityId})
                    .Build();
billingService.DealerProductPermissionList(registerUserVo,response => Listener.GetResult(response, out output));

```

## لیست مجوزهای صادر شده برای کسب و کار شما
لیست دسترسی هایی که شما واسط آن کسب و کار شده اید و برای آن محصول خاص مجوز صدور فاکتور گرفته اید را می توانید با سرویس
زیر مشاهده نمایید.

``` csharp
var output = new ResultSrv<List<DealerProductPermissionSrv>>();
var registerUserVo = DealingProductPermissionListVo.ConcreteBuilder
                    //.SetSize({Put your Size})
                    //.SetDealingBusinessId({Put your DealingBusinessId})
                    //.SetEnable({Put your Enable})
                    //.SetOffset({Put your Offset})
                    //.SetEntityId({Put your EntityId})
                    .Build();
billingService.DealingProductPermissionList(registerUserVo,response => Listener.GetResult(response, out output));

```

## فعال کردن دسترسی محصول
با استفاده از سرویس ذیل می توانید دسترسی محصولی به کسب و کار واسط اعطا نموده اید را فعال نمایید.

``` csharp
var output = new ResultSrv<DealerProductPermissionSrv>();
var enableDealerProductPermissionVo= EnableDealerProductPermissionVo.ConcreteBuilder
                    .SetEntityId({Put your EntityId})
                    .SetDealerBizId({Put your DealerBizId})
                    .Build();
billingService.EnableDealerProductPermission(enableDealerProductPermissionVo,response => Listener.GetResult(response, out output));
```

## غیرفعال کردن دسترسی محصول
 با استفاده از سرویس ذیل می توانید دسترسی محصولی که به کسب و کار واسط اعطا نموده اید را غیرفعال نمایید.

``` csharp
var output = new ResultSrv<DealerProductPermissionSrv>();
var registerUserVo = DisableDealerProductPermissionVo.ConcreteBuilder
                    .SetEntityId({Put your EntityId})
                    .SetDealerBizId({Put your DealerBizId})
                    .Build();
billingService.DisableDealerProductPermission(registerUserVo,response => Listener.GetResult(response, out output));
```

# [PHP#](#tab/PHP)

[http://docs.pod.land/v1.0.8.0/Developer/Invoice/158/Index](http://docs.pod.land/vv.1.0.0.0/PODSDKs/PHPSDKs/2780/خرید در یک نگاه)
**نصب** **پکیج** **pod-billing-service**
پکیج ارائه شده برای  عملیات خرید، pod-billing-service، از طریق دستور زیر قابل نصب می باشد.

  
    ``` PHP
    composer require pod-sdk/pod-billing-service
    ```

## تنظیمات اولیه

قبل از استفاده از سرویس های خرید ابتدا با تنظیم serverType  مشخص کنید که در حالت تست هستید یا production  تا به سرور مورد نظر وصل شوید. همچنین  در تمام سرویس های خرید نیاز به تنظیم این دو پارامتر داریم : 

1. (توکنی که بعد از ورود به سیستم یا از پنل کسب و کار دریافت شده است و می توان به عنوان پارامتر هم وارد نمود) api_ token . 
2.  (مرجع صادرکننده توکن 0: توکن های داخلی (پیشفرض). 1: توکن های دریافت شده از sso) token_issuer.

با استفاده از کلاس baseInfo می توانید این سه پارامتر را تنظیم کنید:

 ``` PHP
    # required classes
    use Pod\Billing\Service\BillingService;
    use Pod\Base\Service\BaseInfo;
    use Pod\Base\Service\Exception\ValidationException;
    use Pod\Base\Service\Exception\PodException;
    
    const API_TOKEN = '{PUT API TOKEN}';
    const TOKEN_ISSUER = 1;
    # set serverType to BillingService::PRODUCTION_SERVER or BillingService::SANDBOX_SERVER
    putenv("SERVER_TYPE=". BillingService::PRODUCTION_SERVER);
    
    $baseInfo = new BaseInfo();
    $baseInfo->setToken(API_TOKEN);
    $baseInfo->setTokenIssuer(TOKEN_ISSUER);
    
    #  instantiates a BillingService
    $BillingService = new BillingService($baseInfo);
    ```

## توکن یکبار مصرف
برای استفاده از برخی از API ها که تعداد دفعات اجرای آنها مهم است، لازم است پارامتر ott در هدر ارسال شود. این پارامتر در هر درخواست که به سرور ارسال می گردد تغییر می کند و ott جدید در پاسخ در خواست صادر می گردد.
اکثر عملیات مربوط به فاکتور نیاز به ott دارند که میتوانید آن را از آخرین درخواست به پلتفرم یا از طریق متد getOtt کلاس BillingService دریافت نمایید. فقط دقت نمایید که توکنی که با آن ott می گیرید با توکنی که در درخواست بعدی باید استفاده شود، یکی باشد. در کد زیر نمونه استفاده از این متد آورده شده است. 
مقدار ott را میتوانید از جواب سرویس issueInvoice هم دریافت نمایید و مجددا در سرویس صدور فاکتور فراخوانی نمایید.


     ``` PHP
    try {
        $result = $BillingService->getOtt();
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }
     ```


## صدور فاکتور توسط کسب و کار
برای صدور فاکتور با استفاده از توکن کسب و کار از تابع issueInvoice استفاده کنید. شبه کد زیر یک فاکتور با دو بند فاکتور را شامل می شود:
دقت کنید برای هر بند فاکتور مقدارهای مربوط به هر محصول(شناسه محصول، قیمت، تعداد و توضیح هر محصول) را در آرایه ای جداگانه وارد کنید.
  
    ``` PHP
      $param =
            [
                ## ============================ *Required Parameters  =========================
                "productList"   	=> [
                    [
                        # شناسه محصول . در صورتی که بند فاکتور محصول مرتبط ندارد مقدار آن 0 وارد شود
                        "productId"         => "{put product id}",
                        # مبلغ بند فاکتور. برای استفاده از قیمت محصول وارد شده از مقدار auto استفاده نمایید
                        "price"             => "{put product price, type: decimal}",
                        #تعداد محصول
                        "quantity"          => "{put product price, type: integer}",
                        # توضیحات
                        "productDescription"=> "{put description}",
                    ],
                    // اطلاعات محصولات دیگر
                ],
                # کد صنف فاکتور
                "guildCode"			=> "{put guild code}", # *Required
    
                ## =========================== Optional Parameters  ===========================
                # توکن یک بار مصرف اگر وارد نشود در متد issueInvoice از api دریافت می شود
                "ott" 				=> "{put ott}",
                # آدرس فراخوانی صادر کننده فاکتور
                "redirectURL" 		=> "{put redirect uri}",
                # شناسه کاربر مربوط به مشتری برای بدست آورن این شناسه می توانید پروفایل کاربر را دریافت نمایید.
                "userId" 			=> "{put user id}",
                # شماره قبض
                "billNumber" 		=> "{put bill number}",
                # توضیحات فاکتور
                "description" 		=> "{put description}",
                # تاریخ سررسید شمسی yyyy/mm/dd
                "deadline" 			=> "yyyy/mm/dd",
                # کد ارز
                "currencyCode" 		=> "{put currency code like IRR}",  # default : IRR
                # شناسه یکی از آدرس های موجود کاربر
                "addressId" 		=> "{put address id of customer}",
                # لیست کد بن تخفیف
                "voucherHash" 		=> [],
                # نرخ مالیات برای این خرید که برای تمام آیتم های فاکتور اعمال می شود.
                #اگر مقداری ارسال نشود مقدار مالیات بر ارزش افزوده پیش فرض محاسبه می شود
                "preferredTaxRate" 	=> "{put tax, default 0.09}",
                # پرداخت دومرحله ای true/false
                "verificationNeeded"=> "{true/false}",
                # تایید خودکار فاکتور در پرداخت دومرحله ای true/false
                "verifyAfterTimeout"=> "{true/false}",
                # پیش نمایش فاکتور (در سیستم ثبت نمی گردد) true/false
                "preview" 			=> "{true/false}",
                # پرداخت فاکتور به روش امن
                "safe"				=> "{true/false}",
                # امکان اضافه کردن ووچر بعد از صدور فاکتور
                "postVoucherEnabled"=> "{true/false}",
                # آیا فاکتور رویداد دارد
                "hasEvent"			=> "{true/false}",
                # عنوان رویداد
                "eventTitle"		=> "{put event title}",
                # منطقه زمانی رویداد
                "eventTimeZone"		=> "{put event time zone}",
                # توضیحات رویداد
                "eventDescription"	=> "{put event description}",
                # متادیتا برای فاکتور
                "metadata"			=> '{put json format like {"name":"test"}}',
                #  اطلاعات جانبی رویداد format = json
                # example 1 : {bussinessName=’test’, bussinessURL=’www.test.com’, bussinessIcon=’null’,
                # actionList=[{command=’GET https://www.googleapis.com/calendar/v3/calendars/calendarId/events?privateExtendedProperty=petsAllowed%3Dyes
                # &sharedExtendedProperty=createdBy%3DmyApp’, commandType={code=’1’, value=’GET’}}], metaData={"petsAllowed":"yes"}}
                "eventMetadata"		=> [],
                # یادآورهای رویداد format = json
                # example 1 : {"id":0,"numOfDaysBefore":3,"alarmTime":1511789309821,"alarmType":"Email"}"
                # example 2 : {"id":0,"minute":15,"alarmType":"Notification"}
                "eventReminders"	=> [],
            ];
    
        try {
            $result = $BillingService->issueInvoice($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
    ```

## نمایش پیش فاکتور
در پلتفرم کسب و کار، فاکتورهایی که پرداخت می شوند به صورت سالانه شماره سریال دریافت می نمایند، بنابرین کسب و کار می تواند برای امور مالی خود به آن شماره سریال استناد نماید. در برخی شرایط، ممکن است کسب و کار بخواهد  فاکتور تا زمانی که اقدام به پرداخت آن نشده اصلاً ثبت نگردد. بدین منظور با استفاده از سرویس زیر می تواند پیش فاکتور را ثبت نماید و با لینک بعدی آن را نمایش دهد. به محض اینکه مشتری، فاکتور را با کیف پول خود پرداخت  نماید یا برای پرداخت وارد درگاه بانکی شود، فاکتور ثبت می گردد. در صورتی  که مشتری پرداخت را از طریق درگاه لغو نماید یا اشکالی در پرداخت او به وجود آید، فاکتور به صورت خودکار لغو خواهد شد. 

 تابع createPreInvoice در پاسخ و در کلید preInvoiceUri یک url برای نمایش پیش فاکتور برمیگرداند که برای نمایش آن کاربر را به این صفحه هدایت کنید.
   
   
      ``` PHP
      $param = [
            ## ============================ *Required Parameters  =========================
            "ott"         => "bbfdcf363bec5774", # private-call-address توکن یک بار مصرف دریافتی از سرور
            "productList"   => [
                [
                    # شناسه محصول . در صورتی که بند فاکتور محصول مرتبط ندارد مقدار آن 0 وارد شود
                    "productId"         => "{put product id}",
                    # مبلغ بند فاکتور. برای استفاده از قیمت محصول وارد شده از مقدار auto استفاده نمایید
                    "price"             => "{put product price, type: decimal}",
                    #تعداد محصول
                    "quantity"          => "{put product price, type: integer}",
                    # توضیحات
                    "productDescription"=> "{put description}",
                ],
                //اطلاعات محصولات دیگر
            ],
            "guildCode"                 => "{put guild code}", # *			کد صنف فاکتور
            "redirectUri"               => "{put redirect uri}",
            "userId"               => "{put customer user id}",  # the id of customer
            ## =========================== Optional Parameters  ===========================
            # "billNumber"=> "{put bill numer}", #                              شماره قبض منحصر به فرد کسب و کار
            # "redirectUri" => "{put redrect uri}",
            #"callUrl"=>  "{put call uri}", #در صورت پرداخت موفق این آدرس صدا خواهد شد#
            # "preferredTaxRate" => "vat; default 0.09", # نرخ مالیات برای این خرید که برای تمام آیتم های فاکتور اعمال می شود.
            # "verificationNeeded" => "{true/false}",         # پرداخت دومرحله ای true/false
            # "currencyCode"=> "{put currency code}", #   کد ارز
            #  "description" => "{put description}", # توضیحات فاکتور
            # "deadline" => "yyyy/mm/dd",             # تاریخ سررسید شمسی yyyy/mm/dd
        ];
    
        try {
            $result = $BillingService->createPreInvoice($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## پرداخت فاکتور
1. پرداخت با کیف پول

تابع  getPayInvoiceByWalletLink لینک مشاهده فاکتور و پرداخت آن را تولید می‌کند. می توانید مشتری را به این آدرس برای پرداخت از طریق کیف پول و یا درگاه بانکی هدایت کنید.

``` PHP
      $param =
            [
                ## ============================ Required Parameters  =========================
                "invoiceId"     => "{put invoice id}",            # شناسه فاکتور
                ## ============================ Optional Parameters ==========================
                "redirectUri"   => "{put redirect uri}",
                "callUri"       => "{put call uri}",          # The function that will be called at the end of payment
            ];
    
        try {
            echo ($BillingService->getPayInvoiceByWalletLink($param)) . PHP_EOL;
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```


2. پرداخت فاکتور خارج از پلتفرم پاد

با تابع issuInvoice می توانید پرداخت های غیر متعارف (خارج از پلتفرم) راکنترل کنید. به عنوان مثال اگر مبلغ فاکتور را به صورت حضوری از مشتری دریافت کردید می توانید با صدا زدن این تابع وضعیت فاکتور مورد نظر خود را به صورت پرداخت شده ببرید.

``` PHP
    $param =
        [
            ## ============================ *Required Parameters  =========================
            "invoiceId"     => "{put invoice id}",             # شناسه فاکتور
            ## =========================== Optional Parameters  ===========================
            "redirectUri"   => "{put redirect uri}",
            "callUri"       => "{put call uri}",
        ];
    try {
        $result = $BillingService->payInvoice($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }
```


3. پرداخت فاکتور با کیف پول از طریق پیامک

در صورتی که کاربر به رایانه جهت پرداخت دسترسی ندارد، یا در فروش حضوری، کسب و کار میتواند درخواست ارسال پیامک پرداخت به کاربر دهد و کاربر با پیامک کردن کدی که دریافت کرده به همان شماره، فاکتور را از کیف پول خود پرداخت مینماید.


``` PHP     
    $param =
        [
            ## ============================ *Required Parameters  =========================
            "invoiceId"          => "{put invoice id}" , # شناسه فاکتور
            ## =========================== Optional Parameters  ===========================
            "wallet"             => "{put wallet code}",          # کد کیف پول PODLAND_WALLET
            "callbackUri"        => "{put call back uri}",         # آدرس جهت فراخوانی پس از پرداخت
            "redirectUri"        => "{put redirect uri}",          # آدرس جهت انتقال کاربر پس از پرداخت
            "delegationId"       => "{put delegation id}",        # شناسه اعتبار
            "forceDelegation"    => "{put force delegation}",   # پرداخت فقط از طریق اعتبار
        ];
    try {
        $result = $BillingService->sendInvoicePaymentSMS($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }
```

## جستجو در متادیتای ثبت شده برای فاکتور
در هنگام ثبت فاکتور می توانید اطلاعات دلخواه خود را در کلید metadata  قرار دهید. در صورتی که بخواهید در بین متا دیتای فاکتورهای خود جستجو کنید می توانید از تابع  استفاده کنید.
   
``` PHP
     $param =
            [
                ## =========================== Optional Parameters  ===========================
                "metaQuery" =>  ["key"=>"value"],
                "offset" => "{put offset}",
                "size" => "{put size}",
                "isPayed" => "true/false",      # true/false
                "isCanceled" => "true/false",   # true/false
            ];
    
        try {
            $result = $BillingService->getInvoiceListByMetadata($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## دریافت فایل خروجی فاکتورها
از طریق تابع می توانید بر اساس پارامترهای مختلف فاکتورها را فیلتر کنید و از نتیجه حاصل یک فایل اکسل تولید کنید. خروجی این تابع دارای خصیصه id است که در ادامه برای دانلود فایل اکسل مورد نیاز است. ساخت فایل اکسل مدت زمانی طول می کشید و برای دریافت آن باید از تابع getExportList و id گرفته شده در این مرحله استفاده کرد.

``` PHP
     $param =
            [
                ## ============================ *Required Parameters  =========================
                "guildCode" => "{put guild code}", # کد صنف
                "lastNRows" => "{put last n rows}", # n ردیف آخر فاکتور
                ## =========================== Optional Parameters  ===========================
                "id" => "{put invoice id}",
                "billNumber" => "{put bill number}", # شماره قبض که به تنهایی با آن می توان جستجو نمود
                "uniqueNumber" => "{put unique number}", # شماره کد شده ی قبض که به تنهایی با آن می توان جستجو نمود
                "trackerId" => "{put tracker id}",
                "fromDate" => "yyyy/mm/dd hh:mi:ss",          # تاریخ شمسی صدور فاکتور yyyy/mm/dd hh:mi:ss
                "toDate" => "yyyy/mm/dd hh:mi:ss",            # تاریخ شمسی صدور فاکتور yyyy/mm/dd hh:mi:ss
                "isCanceled" => "{true/false}",
                "isPayed" => "{true/false}",
                "isClosed" => "{true/false}",
                "isWaiting" => "{true/false}",
                "referenceNumber" => "{put reference number}",               # شماره ارجاع
                "userId" => "{put user id}",                          # شناسه کاربری مشتری
                "query" => "{put query}",                               # عبارت برای جستجو
                "productIdList" => [],  # لیست شماره محصولات
                "callbackUrl" => "{put call back url}",    # آدرس فراخوانی پس از اتمام تولید گزارش
            ];
        try {
            $result = $BillingService->getInvoiceListAsFile($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## تایید پرداخت فاکتور
اگر در هنگام صدور فاکتور کلید verificationNeeded را برابر با true قرار دهیم. فاکتور سه مرحله ایجاد شده و با استفاده از تابع verifyInvoice بعد از پرداخت فاکتور، می توانید پرداخت شدن آن را تایید کنید.   

     $param =
            [
                ## =========================== Optional Parameters  ===========================
                "id" => "{invoice id}",
                "billNumber" => "billNumber",
            ];
        try {
            $result = $BillingService->verifyInvoice($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
        

## ابطال فاکتور
با استفاده از تابع cancelInvoice می توانید یک فاکتور را ابطال کنید.

``` PHP
       $param =
        [
            ## ============================ *Required Parameters  =========================
            "id" => "{put invoice id}", # شناسه فاکتور
        ];
    try {
        $result = $BillingService->cancelInvoice($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }
```

## کاهش فاکتور
در مواردی ممکن است نیاز به تغییری در بندهای فاکتور داشته باشید. در  صورتی که فاکتور پرداخت نشده است، فاکتور قبلی را باطل (cancel) نمایید و فاکتور جدیدی صادر کنید. اگر فاکتور پرداخت شده است(در صورتی که باید پول بیشتری از مشتری دریافت نمایید)، لازم است فاکتوری جداگانه به مبلغ افزوده شده، با ذکر دلیل صادر نموده و مشتری را مجددا برای پرداخت هدایت نمایید. در برخی مواقع لازم است مبلغی از فاکتور پرداخت شده به مشتری بازگردانده شود. برای این منظور از  تابع reduceInvoice استفاده کنید.

   
``` PHP
     $param =
            [
                ## ============================ *Required Parameters  =========================
                "id" => "{put invoice id}", # شناسه فاکتور
                "invoiceItemList" => [
                    [
                        "invoiceItemId" => "{put invoice id of item 1}",    # شناسه بند فاکتور
                        "price" => "{put price of item 1}", # مبلغ بند فاکتور
                        "quantity" => "{put quantity of item 1}",  # لیست تعداد محصول در هر بند فاکتور
                        "itemDescription" => "reduce invoice", # لیست توضیحات بند فاکتور
                    ],
                    [
                        "invoiceItemId" => "{put invoice id of item 2}",    # شناسه بند فاکتور
                        "price" => "{put price of item 2}", # مبلغ بند فاکتور
                        "quantity" => "{put quantity of item 2}",  # لیست تعداد محصول در هر بند فاکتور
                        "itemDescription" => "reduce invoice", # لیست توضیحات بند فاکتور
                    ],
                ],
                ## =========================== Optional Parameters  ===========================
                "preferredTaxRate" => "{put tax, default 0.09}", # نرخ مالیات برای این خرید که برای تمام آیتم های فاکتور اعمال می شود. اگر مقداری ارسال نشود مقدار مالیات بر ارزش افزوده پیش فرض محاسبه می شود
            ];
        try {
            $result = $BillingService->reduceInvoice($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## تایید و بستن فاکتور در یک مرحله
اگر در هنگام صدور فاکتور کلید verificationNeeded را برابر با true قرار دهیم. فاکتور سه مرحله ایجاد شده و با استفاده از تابع verifyAndCloseInvoice بعد از پرداخت فاکتور، می توانید پرداخت شدن آن را تایید کنید و همزمان فاکتور را نیز ببندید.

``` PHP
      $param =
            [
                ## ============================ *Required Parameters  =========================
                "id" => "{put invoice id}" # شناسه فاکتور
                ## =========================== Optional Parameters  ===========================
            ];
        try {
            $result = $BillingService->verifyAndCloseInvoice($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## بستن فاکتور
با استفاده از تابع closeInvoice می توانید یک فاکتور را ببندید. دقت داشته باشید برای تسویه باید فاکتورها را بسته باشید.
  
``` PHP
      $param =
            [
                ## ============================ *Required Parameters  =========================
                "id" => "{put invoice id}", # شناسه فاکتور
            ];
        try {
            $result = $BillingService->closeInvoice($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## دریافت لینک پرداخت
با استفاده از تابع getInvoicePaymentLink می توانید لینک پرداخت یک فاکتور را دریافت کنید و کاربر را به این آدرس جهت پرداخت از طریق درگاه بانکی هدایت کنید.
   
``` PHP
     $param =
            [
                ## ============================ *Required Parameters  =========================
                "invoiceId"     => "{put invoice id}",                       # شناسه فاکتور
                ## ============================  Optional Parameters ==========================
                "redirectUri"   => "{put redirect uri}",
                "callbackUri"   => "{put callback uri}",      # The function that will be called at the end of payment
                "gateway"       => "PEP",
            ];
        try {
            $result = $BillingService->getInvoicePaymentLink($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## پرداخت فاکتور از طریق فاکتور
از طریق تابع این سرویس کسب و کار قادر خواهد بود که پرداخت شدن برخی فاکتورهای خود را منوط به پرداخت شدن فاکتورهای دیگری نماید. یا به عبارتی نوعی تهاتر را بوسیله فاکتورها انجام دهد. با استفاده از تابع payInvoiceByInvoice  می‌توانید این عملیات را انجام دهید.
 
 ``` PHP
     $param =
            [
                ## ============================ *Required Parameters  =========================
                "creditorInvoiceId" => "", # شناسه فاکتور بستانکار
                "debtorInvoiceId" => "", # شناسه فاکتور بدهکار
                ## =========================== Optional Parameters  ===========================
            ];
        try {
            $result = $BillingService->payInvoiceByInvoice($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## پرداخت فاکتور در آینده
از طریق تابع payInvoiceInFuture کسب و کار قادر خواهد بود فاکتورهایی که برایش توسط دیگران صادر شده را درتاریخ آینده یا سررسید توافقی از طریق مبلغی که در کیف پول یا اصناف خود دارد پرداخت نماید .این سرویس باید توسط کسب و کار یا کاربر بدهکار یا شخصی که فاکتور برایش صادر شده صدا زده شود.
   
``` PHP
     $param =
            [
                ## ============================ *Required Parameters  =========================
                "_ott_" => "" , # one time token - این توکن را در سرویس قبلی دریافت کرده اید.
                "invoiceId" => "{put invoice id}",                     # شناسه فاکتور
                "date" => "yyyy/mm/dd",# تاریخ شمسی سررسید
                ## =========================== Optional Parameters  ===========================
                # یکی و فقط یکی از فیلدهای زیر را باید پر کنید
                "guildCode" => "put guild code", # کد صنف
                "wallet" => "PODLAND_WALLET",  # کد کیف پول
            ];
        try {
            $result = $BillingService->payInvoiceInFuture($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## دریافت لینک دانلود فایل های اکسل فاکتورها
تابع getExportList لینک دانلود فایل های اکسل تولید شده را به شما خواهد داد. همچنین  با داشتن id ای که تابع getInvoiceListAsFile در خروجی می دهد می توانید تنها لینک دانلود فایل مورد نظر خود را استخراج کنید.
   
``` PHP
     $param =
            [
                ## ============================ *Required Parameters  =========================
                "offset" => "{put offset}",
                "size" => "{put size}",   # اندازه خروجی
                "id" => "{put request id}",  # شناسه درخواست
                ## =========================== Optional Parameters  ===========================
                "statusCode" => "{put status code}", # کد وضعیت
                "serviceUrl" => "{put server url}",           # آدرس سرویس
            ];
        try {
            $result = $BillingService->getExportList($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## پرداخت پیشرفته
کسب و کار میتواند برای تمام مشتریان خود، بدون نیاز به ورود به سامانه احراز هویت یکپارچه، امکان خرید را از طریق لینک پرداخت فراهم کند. برای این منظور لازم است کسب و کار از کد یکتا که برای فاکتور تولید می شود استفاده نماید. تابع getPayInvoiceByUniqueNumberLink لینک پرداخت را با استفاده از uniqueNumber تولید می کند.
   
``` PHP
     $param =
            [
                ## ============================ *Required Parameters  =========================
                "uniqueNumber"  => "{put unique number of invoice}",
                ## ============================  Optional Parameters ==========================
                "redirectUri"   => "{put redirect uri}",
                "callUri"       => "{put call uri}",          # The function that will be called at the end of payment
                "gateway"       => "PEP",
            ];
    
        try{
            echo ($BillingService->getPayInvoiceByUniqueNumberLink($param)).PHP_EOL;
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```        

[http://docs.pod.land/v1.0.8.0/Developer/Invoice/680/AdvancedPayment](http://docs.pod.land/vv.1.0.0.0/PODSDKs/PHPSDKs/2780/راهنمای مراحل پرداخت پیشرفته)


## درخواست تسویه
کسب و کار می تواند با استفاده از تابع requestWalletSettlement  درخواست انتقال وجه قابل تسویه موجود در حساب مجازی خود را بدهد. عملیات تسویه از طریق پنل نیز قابل انجام و پیگیری می باشد. همچنین میتوانید از طریق پنل کسب و کار خود یا وب سرویس برای یک حساب صنفی خاص یا کیف پول، تسویه  اتوماتیک را فعال نمایید. به این ترتیب پایان هر شب مبلغ قابل تسویه موجود در آن حساب، به شماره شبای ثبت شده واریز می گردد.

**تسویه از طریق پنل کسب و کار**
		تسویه از حساب مشتری (برداشت از کیف پول)
		تابع requestWalletSettlement انتقال پول از کیف پول به حساب بانکی را انجام می دهد. به عبارت دیگر مبلغ مورد نظر خود را با استفاده از این تابع می توانید از کیف پول خود به حساب بانکی منتقل کنید. در صورتی که شماره شبایا نام و نام خانوادگی شخص در پروفایل ثبت نشده باشد این سرویس خطا خواهد داد.
		  
``` PHP
      $param =
            [
                ## ============================ *Required Parameters  =========================
                "_ott_"         => "{Put ott here}" , # one time token - این توکن را در سرویس قبلی دریافت کرده اید.برای دریافت مجدد می توانید سرویس /nzh/ott/ را صدا کنید
                "amount"        => "{put amount}", # مبلغ برداشت
                ## =========================== Optional Parameters  ===========================
                "wallet"        => "{put wallet code}",          # کد کیف پول PODLAND_WALLET
                "firstName"     => "{put first name}",  # نام صاحب حسابی که تسویه به آن واریز می گردد
                "lastName"      => "{put last name}",  # نام خانوادگی صاحب حسابی که تسویه به آن واریز می گردد
                "sheba"         => "{put sheba}",  # شماره شبا حسابی که تسویه به آن واریز می گردد
                "currencyCode"  => "{put currency code}",  # کد ارز پیش فرض IRR
                "uniqueId"      => "{put unique id}",          # شناسه یکتا
                "description"   => "{put description}",          # شرح دلخواه
            ];
        try {
            $result = $BillingService->requestWalletSettlement($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## تسویه از حساب صنفی کسب و کار
در حساب های صنفی همواره مبلغی به عنوان مبلغ قابل تسویه وجود دارد که شامل دارایی کسب و کار بجز فاکتورهای باز او یا فاکتورهایی که مبلغ آن ها هنوز واریز نشده است، می باشد. مبلغ قابل تسویه را می توانید از طریق تابع requestGuildSettlement تسویه کنید.
 
``` PHP
       $param =
            [
                ## ============================ *Required Parameters  =========================
                "_ott_"         => "{put ott}" , # one time token - این توکن را در سرویس قبلی دریافت کرده اید.برای دریافت مجدد می توانید سرویس /nzh/ott/ را صدا کنید
                "amount"        => "{put amount}",                      # مبلغ برداشت
                "guildCode"     => "{put guild code}",                # کد صنف
                ## =========================== Optional Parameters  ===========================
                "wallet"        => "{put wallet code}",           # کد کیف پول
                "firstName"     => "{put first name}",  # نام صاحب حسابی که تسویه به آن واریز می گردد
                "lastName"      => "{put last name}",  # نام خانوادگی صاحب حسابی که تسویه به آن واریز می گردد
                "sheba"         => "{put sheba}",  # شماره شبا حسابی که تسویه به آن واریز می گردد
                "currencyCode"  => "{put currency code}",  # کد ارز پیش فرض IRR
                "uniqueId"      => "{put unique id}",             # شناسه یکتا
                "description"   => "{put description}",           # شرح دلخواه
            ];
        try {
            $result = $BillingService->requestGuildSettlement($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## انتقال وجه از حساب کسب و کاری به کارت بانکی (با کسر کارمزد) یا شماره شبا
کسب و کار می تواند با استفاده از سرویس زیر مبلغ مورد نظر خود را از حساب مجازی به یک شماره کارت یا یک شماره شبا بانکی منتقل نماید. بدیهی است که در صورت استفاده از ابزار کارت به کار، کارمزد بانکی از حساب کسب و کار کسرخواهد شد و در صورت استفاده از ابزار پایا، انتقال وجه در زمان مصوب بانک مرکزی انجام خواهد شد.
برای پارامتر toolCode از یکی از مقادیر زیر استفاده نمایید:
SETTLEMENT_TOOL_SATNA
SETTLEMENT_TOOL_PAYA
SETTLEMENT_TOOL_CARD
و به طور مثال، در صورتی که انتقال از طریق کارت را انتخاب نموده اید، در قسمت toolId شماره کارت مقصد را وارد نمایید و در غیر این صورت شماره شبا را وارد نمایید.
   
``` PHP
     $param =
            [
                ## ============================ *Required Parameters  =========================
                "_ott_"         => "{put ott}" , # one time token - این توکن را در سرویس قبلی دریافت کرده اید.برای دریافت مجدد می توانید سرویس /nzh/ott/ را صدا کنید
                "amount"        => "{put amount}",                       # مبلغ برداشت
                "guildCode"     => "{put guild code}",                    # کد صنف
                "toolId"        => "{put tool id}",           # شماره ابزاری که تسویه به آن واریز می گردد
                "toolCode"      => "{put tool code}",# نوع ابزار برای تسویه کارت به کارت،پایا،ساتنا
                # [SETTLEMENT_TOOL_SATNA | SETTLEMENT_TOOL_PAYA | SETTLEMENT_TOOL_CARD]
                ## =========================== Optional Parameters  ===========================
                "firstName"     => "{put first name}",  # نام صاحب حسابی که تسویه به آن واریز می گردد
                "lastName"      => "{put last name}",  # نام خانوادگی صاحب حسابی که تسویه به آن واریز می گردد
                "currencyCode"  => "{put currency code}",       # کد ارز پیش فرض IRR
                "uniqueId"      => "{put unique id}",          # شناسه یکتا
                "description"   => "{put description}",          # شرح دلخواه
            ];
        try {
            $result = $BillingService->requestSettlementByTool($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## گزارش وضعیت تسویه
با استفاده از تابع listSettlements می توانید لیست تسویه حساب های خود را ببینید یا در میان آن ها جست و جو کنید.
  
``` PHP
      $param =
            [
                ## ============================ *Required Parameters  =========================
                "offset"        => "{put offset}",      # مبلغ برداشت
                "size"          => "{put size}",        # اندازه خروجی
                ## =========================== Optional Parameters  ===========================
                "statusCode"    => "",  # کد وضعیت درخواست SETTLEMENT_REQUESTED، SETTLEMENT_SENT ، SETTLEMENT_DONE
                "currencyCode"  => "",  # کد ارز پیش فرض IRR
                "fromAmount"    => "",  # حد پایین مبلغ درخواست شده
                "toAmount"      => "",  # حد بالای مبلغ درخواست شده
                "fromDate"      => "",  # حد پایین تاریخ درخواست شمسی yyyy/mm/dd
                "toDate"        => "",  # حد بالای تاریخ درخواست شمسی yyyy/mm/dd
                "uniqueId"      => "",          # شناسه یکتا
            ];
        try {
            $result = $BillingService->listSettlements($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## فعالسازی تسویه خودکار 
در صورتی که تسویه خودکار برای یک کسب و کار فعال شود، مبلغ قابل تسویه آن کسب و کار به طور خودکار، یکبار در شبانه روز به شماره شبای اعلام شده در پروفایل کسب و کار یا شماره شبای اعلامی در سرویس زیر، تسویه می گردد.  با تابع addAutoSettlement می توانید تسویه خودکار را بر روی هر کدام از حساب‌های صنفی خود فعال کنید.
 
``` PHP
       $param =
            [
                ## ============================ *Required Parameters  =========================
                "guildCode"     => "{put guild code}",              # کد صنف
                ## =========================== Optional Parameters  ===========================
                "firstName"     => "",  # نام صاحب حسابی که تسویه به آن واریز می گردد
                "lastName"      => "",  # نام خانوادگی صاحب حسابی که تسویه به آن واریز می گردد
                "currencyCode"  => "",  # کد ارز پیش فرض IRR
                "instant"       => "true/false",  # در صورت true بودن تسویه حساب خودکار فوری و در صورت false بودن تسویه حساب خودکار فعال می شود .
                "sheba"         => "",          # شماره شبا حسابی که تسویه به آن واریز می گردد
            ];
        try {
            $result = $BillingService->addAutoSettlement($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
## لغو تسویه خودکار
با استفاده از تابع removeAutoSettlement می توانید تسویه حساب خودکار را از روی هر کدام از حساب های صنفی غیر فعال کنید.
   

     $param =
            [
                ## ============================ *Required Parameters  =========================
                "guildCode"     => "{put guild code}",              # کد صنف
                ## =========================== Optional Parameters  ===========================
                "currencyCode"  => "{like USD or IRR}",  # کد ارز پیش فرض IRR
            ];
        try {
            $result = $BillingService->removeAutoSettlement($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```        

## تسهیم فروش
در صورتی که بخشی از فروش شما به کسب و کار دیگری تعلق دارد و می خواهید فاکتور به نام همان کسب و کار ثبت شود، لازم است آن کسب و کار، به کسب و کار شما اجازه صدور فاکتور به عنوان معامله گر را داده باشد. با در اختیار داشتن شناسه کسب و کار دیگر با استفاده از تابع  addDealer می توانید این اجازه را صادر کنید.

``` PHP
      $param =
            [
                ## ============================ *Required Parameters  =========================
                "dealerBizId"     => "{put dealer business id}",              # شناسه کسب و کار واسط
                ## =========================== Optional Parameters  ===========================
                "allProductAllow"  => true,             # دسترسی به همه محصولات
            ];
        try {
            $result = $BillingService->addDealer($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## لیست کسب و کارهایی که به آنها مجوز معامله داده شده
برای دریافت یا جستجوی لیست تمام کسب و کارهایی که به آنها مجوز معامله و صدور فاکتور داده اید  می توانید از تابع dealerList استفاده کنید.
   
``` PHP
     $param =
            [
                ## =========================== Optional Parameters  ===========================
                'dealerBizId'   => "{put dealer business id}",            # The id of business to be a dealer
                'enable'        => true,            # [true/false]
                'size'          => "{put size}",              # pagination size, default: 50
                'offset'        => "{put offset}",               # pagination offset, default: 0
            ];
        try {
            $result = $BillingService->dealerList($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## فعالسازی و غیر فعالسازی مجوز معامله گران
با استفاده از تابع enableDealer می توانید کسب کارهای واسط را فعال کنید.
  
``` PHP
      $param =
            [
                ## ============================ *Required Parameters  =========================
                "dealerBizId"     => "{put dealer business id}",  # The id of dealer business *that is a number*
            ];
        try {
            $result = $BillingService->enableDealer($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

با استفاده از تابع disableDealer می توانید کسب کارهای واسط را غیر فعال کنید.
   
``` PHP
     $param =
            [
                ## ============================ *Required Parameters  =========================
                "dealerBizId"     => "{put business id}",  # The id of dealer business that is a number
            ];
        try {
            $result = $BillingService->disableDealer($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## لیست کسب و کارهایی که واسط آن هستید
با فراخوانی سرویس businessDealingList می توانید لیست کسب و کارهایی که واسط آن ها شده اید را دریافت نمایید.

``` PHP
    $param =
   

     [
            ## =========================== Optional Parameters  ===============================
            'dealingBusinessId' => "{put dealer business id}",            # The id of dealing business
            'enable'            => true,            # [true/false]
            'size'              => "{put size}",              # pagination size, default: 50
            'offset'            => "{put offset}",               # pagination offset, default: 0
        ];
    try {
        $result = $BillingService->businessDealingList($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }
```

## صدور فاکتور تسهیمی
کسب و کار معامله گر که لازم است فاکتور تسهیمی صادر نماید باید از جانب کسب و کارهای سهیم دارای مجوز صدور فاکتور باشد. برای صدور فاکتور تسهیمی می توانید از متد issueMultiInvoice مشابه تابع زیر استفاده کنید:

   
``` PHP
     $param =
            [
                ## ============================ *Required Parameters  =========================
                "_ott_" => "put ott" ,                      # one time token - این توکن را در سرویس قبلی دریافت کرده اید.
                # آرایه حاوی اطلاعات فاکتورها
                "data" =>                       ## commented rows are optional parameters ##
                    [
                        // 'redirectURL' => 'put redirect url',
                        // 'userId' => 11111,               # userId of customer
                        // 'currencyCode' => 'like EUR or IRR',
                        // 'voucherHashs' => [],            # array of vouchers  اگر وجود ندارد این پارامتر ارسال نشود
                        // 'preferredTaxRate' => "{put tax, default 0.09}" ,     # tax to be added between 0 and 1 default is 0.09
                        // 'verificationNeeded' => 'true/false',
                        // 'preview' => '',
                        'mainInvoice'=>
                            [
                                // 'billNumber' => 'put bill number',       # business unique bill number
                                'guildCode' => 'put guild code',
                                // 'metadata' => 'extra data in form of json',
                                // 'description' => 'put description',
                                'invoiceItemVOs' =>
                                    [
                                        [
                                            'productId' => "{put product id or 0}",   # the id of product or 0 if no product
                                            'price' => "{put price}",     # the share of dealer
                                            'quantity' => "{put quantity}",    # count
                                            'description' => 'put description'
                                        ],
                                    ],
                            ],
                        'subInvoices' =>
                            [
                                [
                                    'businessId' => "{put business id}",       # the id of shareholder business
                                    'guildCode' => 'put guild code',
                                    // 'billNumber' => 'put bill number',       # business unique bill number
                                    // 'metadata' => 'extra data in form of json',
                                    'description' => 'put description',
                                    'invoiceItemVOs' =>
                                        [
                                            [
                                                'productId' => "{put product id or 0}",
                                                'price' => "{put price}",         # the share of shareholder
                                                'quantity' => "{put quantity}",
                                                'description' => 'put description'
                                            ],
                                        ],
                                ]
                            ],
                        // customerDescription => 'put customer description',
                        // customerMetadata => 'extra data for customer in form of json',
                        'customerInvoiceItemVOs' =>
                            [
                                [
                                    'productId' => "{put product id or 0}",       # the id of product or 0 if no product,
                                    'price' => "{put price}",         # the price to be payed by customer
                                    'quantity' => "{put quantity}",       # count
                                    'description' => 'put description'
                                ]
                            ]
                    ],
    
                ## =========================== Optional Parameters  ===============================
                'delegatorId'       => [],            # شناسه تفویض کنندگان، ترتیب اولویت را مشخص می کند
                'delegationHash'    => [],            # کد تفویض برای اشاره به یک تفویض مشخص
                'forceDelegation'   => false,              # پرداخت فقط از طریق تفویض
            ];
        try {
            $result = $BillingService->issueMultiInvoice($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## کاهش فاکتور تسهیمی
همانند فاکتورهای عادی اگر نیاز به کاهش فاکتور و بر گردادن وجهی به مشتری باشد می توانید از تابع  reduceMultiInvoice استفاده کنید
 
``` PHP
    $param =
            [
                ## ============================ *Required Parameters  =========================
                # ***** NOTE : the share of dealer + the share of shareholder = the price to be payed by customer  **** #
                'data' =>
                    [
                        'preferredTaxRate' => "{put tax, default 0.09}",            # tax to be added between 0 and 1 default is 0.09
                        'mainInvoice' =>                             # فاکتور به نام خود معامله گر
                            [
                                'id' => "{put invoice id}",                # id of main invoice to be edited
                                'reduceInvoiceItemVOs' =>       # بندهای فاکتور مربوط به سهم معامله گر
                                    [
                                        [
                                            'id' => "{put invoice item id}",                 # the id of item in invoice
                                            'price' => "{put price}",                 # the share of dealer
                                            'quantity' => "{put quantity}",                # count
                                            'description' => 'put description of item'
                                        ]
                                    ]
                            ],
                        'subInvoices' =>            # فاکتورهای مربوط به سهم سایر کسب و کارهای ذینفع
                            [
                                [
                                    'id' => 222222,
                                    'reduceInvoiceItemVOs' =>       # بندهای فاکتور مربوط به سهم ذینفعان
                                        [
                                            [
                                                'id' => "{put invoice item id}",         # the id of item in invoice
                                                'price' => "{put price}",         # the share of shareholder
                                                'quantity' => "{put quantity}",        # count
                                                'description' => 'put description of item'
                                            ]
                                        ]
                                ]
                            ],
                        'customerInvoiceItemVOs' =>         # بندهایی که به مشتری نمایش داده می شوند
                            [
                                [
                                    'id' => "{put invoice item id}",         # the id of item in invoice
                                    'price' => "{put price}",         # he price to be payed by customer
                                    'quantity' => "{put quantity}",       # count
                                    'description' => 'put description of item'
                                ]
    
                            ],
                    ]
            ];
    
        try {
            $result = $BillingService->reduceMultiInvoice($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

 با استفاده از تابع reduceMultiInvoiceAndCacheOut علاوه بر کاهش فاکتور تسهیمی بلافاصله مبلغ برگشتی به شماره شبا کاربر منتقل گردد. ورودی و خروجی این تابع مشابه با تابع reduceInvoice است
 
 ``` PHP
        $param =
                        [
                            ## ============================ *Required Parameters  =========================
                            # ***** NOTE : the share of dealer + the share of shareholder = the price to be payed by customer  **** #
                            'data' =>
                                [
                                    'preferredTaxRate' => "{put tax, default 0.09}",            # tax to be added between 0 and 1 default is 0.09
                                    'mainInvoice' =>                             # فاکتور به نام خود معامله گر
                                        [
                                            'id' => "{put id of main invoice}",                # id of main invoice to be edited
                                            'reduceInvoiceItemVOs' =>       # بندهای فاکتور مربوط به سهم معامله گر
                                                [
                                                    [
                                                        'id' => "{put invoice item id}",                 # the id of item in invoice
                                                        'price' => "{put price}",                 # the share of dealer
                                                        'quantity' => "{put quantity}",                # count
                                                        'description' => 'put description of item'
                                                    ]
                                                ]
                                        ],
                                    'subInvoices' =>            # فاکتورهای مربوط به سهم سایر کسب و کارهای ذینفع
                                        [
                                            [
                                                'id' => 222222,
                                                'reduceInvoiceItemVOs' =>       # بندهای فاکتور مربوط به سهم ذینفعان
                                                    [
                                                        [
                                                            'id' => "{put invoice item id}",         # the id of item in invoice
                                                            'price' => "{put price}",         # the share of shareholder
                                                            'quantity' => "{put quantity}",        # count
                                                            'description' => 'put description of item'
                                                        ]
                                                    ]
                                            ]
                                        ],
                                    'customerInvoiceItemVOs' =>         # بندهایی که به مشتری نمایش داده می شوند
                                        [
                                            [
                                                'id' => "{put invoice item id}",         # the id of item in invoice
                                                'price' => "{put price}",         # he price to be payed by customer
                                                'quantity' => "{put quantity}",       # count
                                                'description' => 'put description of item'
                                            ]
                
                                        ],
                                ]
                        ];
                    try {
                        $result = $BillingService->reduceMultiInvoiceAndCashOut($param);
                        print_r($result);
                    } catch (ValidationException $e) {
                        print_r($e->getResult());
                        print_r($e->getErrorsAsArray());
                    } catch (PodException $e) {
                        print_r($e->getResult());
            
```

## مجوز فروش محصول
            با استفاده از تابع addDealerProductPermission به یک کسب و کار دیگر اجازه صدور فاکتور عادی را می توان داد
            
 ``` PHP
              $param =
                    [
                        ## =========================== Optional Parameters  ===============================
                        'productId'         => "{put product id}",            # شناسه محصول
                        'dealerBizId'       => "{put dealer business id}",            # شناسه کسب و کار واسط
                    ];
                try {
                    $result = $BillingService->addDealerProductPermission($param);
                    print_r($result);
                } catch (ValidationException $e) {
                    print_r($e->getResult());
                    print_r($e->getErrorsAsArray());
                } catch (PodException $e) {
                    print_r($e->getResult());
                }
 ```
 
  با استفاده از تابع dealerProductPermissionList می توانید لیست مجوزهای خود به کسب و کارهای واسط دیگر را به انضمام شناسه محصول مشاهد نمایید.
  
``` PHP
      $param =
                    [
                        ## =========================== Optional Parameters  ===============================
                        'productId'     => "{put product id}",                     # شناسه محصول
                        'dealerBizId'   => "{put dealer business id}",                     # شناسه کسب و کار واسط
                        'enable'        => "true/false",              # فعال بودن واسط
                        'offset'        => "{put offset}",                         # شناسه کسب و کار واسط
                        'size'          => "{put size}",                        # اندازه خروجی
            
            
                    ];
                try {
                    $result = $BillingService->dealerProductPermissionList($param);
                    print_r($result);
                } catch (ValidationException $e) {
                    print_r($e->getResult());
                    print_r($e->getErrorsAsArray());
                } catch (PodException $e) {
                    print_r($e->getResult());
                }
        
```

 هم چنین لیست دسترسی هایی که شما واسط آن کسب و کار شده اید و برای آن محصول خاص مجوز صدور فاکتور گرفته اید را می توانید با 
    سرویس dealingProductPermissionList  مشاهده نمایید.

``` PHP
        $param =
            [
                ## =========================== Optional Parameters  ==========================
                'productId'     => "{put product id}",                     # شناسه محصول
                'dealingBusinessId'   => "{put dealer business id}",                # شناسه کسب و کار واسط
                'enable'        => "true/false",              # فعال بودن واسط
                'offset'        => "{put offset}",                         # شناسه کسب و کار واسط
                'size'          => "{put size}",                        # اندازه خروجی
            ];
        try {
            $result = $BillingService->dealingProductPermissionList($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## غیر فعال سازی دسترسی محصول برای کسب و کار
 با استفاده از تابع زیر می توانید دسترسی محصولی که به کسب و کار واسط اعطا نموده اید را غیرفعال نمایید

``` PHP
      $param =
            [
                ## ============================ *Required Parameters  =========================
                'productId'     => "{put product id}",               # شناسه محصول
                'dealerBizId'   => "{put dealer business id}",                # شناسه کسب و کار واسط
            ];
        try {
            $result = $BillingService->disableDealerProductPermission($param);
            print_r($result);
        } catch (ValidationException $e) {
            print_r($e->getResult());
            print_r($e->getErrorsAsArray());
        } catch (PodException $e) {
            print_r($e->getResult());
        }
```

## فعال سازی مجدد دسترسی محصول برای کسب و کار
با استفاده از تابع زیر می توانید دسترسی محصولی که به کسب و کار واسط اعطا نموده اید را در صورت غیر فعال بودن، مجدد فعال نمایید.
 
 ``` PHP
    $param =
        [
            ## ============================ *Required Parameters  =========================
            'productId'     => "{put product id}",            # شناسه محصول
            'dealerBizId'   => "{put dealer business id}",                # شناسه کسب و کار واسط
    
    
        ];
    try {
        $result = $BillingService->enableDealerProductPermission($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }
```

# [Java#](#tab/Java)

## توکن یکبار مصرف

[ابتدا jar فایل مربوطه را دانلود و در پروژه خود قرار دهید.](https://github.com/FanapSoft/pod-java-sdk/tree/master/pod-billing-service-java/Sample%20Code/release)

برای استفاده از برخی از تابع ها که تعداد دفعات اجرای آنها مهم است، لازم است پارامتر ott در به تابع داده شود. این پارامتر در هر درخواست که به سرور ارسال می گردد تغییر می کند و ott جدید در پاسخ درخواست صادر می گردد. برای دریافت این پارامتر از تابع زیر استفاده کنید:

```java
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            OttVo ottVo = new OttVo.Builder(baseInfoVo)
                    .build();
            billingService.ott(ottVo, new OnGetResponseListener<String>() {
                @Override
                public void onResponse(ResultVo<String> result) {
                    System.out.println(result.getOtt());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

## ‌صدور فاکتور توسط کسب و کار
هرگونه پرداخت در پلتفرم پاد، از طریق فاکتور صورت می گیرد. در این بخش صدور فاکتور با استفاده از توکن کسب و کار شرح داده شده و می توان با خروجی حاصل از این متد، کاربر را به راحتی به درگاه پرداخت هدایت نمود. برای صدور فاکتور از سرویس زیر استفاده نمایید.

مقدار api_token را از پنل مدیریت کسب و کار دریافت نمایید.

اگر محصولی که برای آن فاکتور ثبت می کنید در سیستم ثبت شده نیست، ProductId را با مقدار صفر وارد نمایید.

```java
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                .setOtt(OTT)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        List<ProductInfo> productInfos = new ArrayList<>();
        ProductInfo productInfo = new ProductInfo();
        productInfo
                .setProductId(0L)
                .setPrice(new BigDecimal(1))
                .setQuantity(new BigDecimal(1))
                .setProductDescription("test");
        productInfos.add(productInfo);

        try {
            IssueInvoiceVo issueInvoiceVo = new IssueInvoiceVo.Builder(baseInfoVo)
                    .setProductInfos(productInfos)
//                    .setUserId(123L)
                    .setGuildCode(SAMPLE_GUILD_CODE)
                    .build();
            billingService.issueInvoice(issueInvoiceVo, new OnGetResponseListener<InvoiceSrv>() {
                @Override
                public void onResponse(ResultVo<InvoiceSrv> result) {
                    System.out.println(result.getResult().getId());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

اکثر عملیات مربوط به فاکتور نیاز به ott دارند که میتوانید آن را از آخرین درخواست به پلتفرم یا از طریق تابع زیر دریافت نمایید. فقط دقت نمایید که توکنی که با آن ott می گیرید با توکنی که در درخواست بعدی باید استفاده شود، یکی باشد.

توجه داشته باشید مقدار ott از api_token متفاوت است، مقدار ott را میتوانید از تابع issueInvoice  هم دریافت نمایید و مجددا در سرویس صدور فاکتور فراخوانی نمایید.

```java
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            OttVo ottVo = new OttVo.Builder(baseInfoVo)
                    .build();
            billingService.ott(ottVo, new OnGetResponseListener<String>() {
                @Override
                public void onResponse(ResultVo<String> result) {
                    System.out.println(result.getOtt());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

## نمایش پیش فاکتور
در پلتفرم کسب و کار، فاکتورهایی که پرداخت می شوند به صورت سالانه شماره سریال دریافت می نمایند، بنابرین کسب و کار می تواند برای امور مالی خود به آن شماره سریال استناد نماید. در برخی شرایط، ممکن است کسب و کار بخواهد فاکتور تا زمانی که اقدام به پرداخت آن نشده اصلاً ثبت نگردد. بدین منظور با استفاده از دستور زیر می تواند پیش فاکتور را ثبت نماید و با لینک بعدی آن را نمایش دهد. به محض اینکه مشتری، فاکتور را با کیف پول خود پرداخت نماید یا برای پرداخت وارد درگاه بانکی شود، فاکتور ثبت می گردد. در صورتی که مشتری پرداخت را از طریق درگاه لغو نماید یا اشکالی در پرداخت او به وجود آید، فاکتور به صورت خودکار لغو خواهد شد.

```java
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                .setOtt(OTT)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        List<ProductInfo> productInfos = new ArrayList<>();
        ProductInfo productInfo = new ProductInfo();
        productInfo
                .setProductId(0L)
                .setPrice(new BigDecimal(1))
                .setQuantity(new BigDecimal(1))
                .setProductDescription("test");
        productInfos.add(productInfo);

        try {
            CreatePreInvoiceVo createPreInvoiceVo = new CreatePreInvoiceVo.Builder(baseInfoVo)
                    .setRedirectURL(RIDERECT_URI)
                    .setUserId(513304L)
                    .setProductInfos(productInfos)
                    .setGuildCode(SAMPLE_GUILD_CODE)
                    .build();

            billingService.createPreInvoice(createPreInvoiceVo, new OnGetResponseListener<String>() {
                @Override
                public void onResponse(ResultVo<String> result) {
                    System.out.println(result.getResult());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

## دریافت فاکتور

برای مشاهده فاکتورهایی که کسب و کار شما صادر نموده و وضعیت آنها می توانید به پنل مدیریت کسب و کار خود به آدرس https://gw.pod.land مراجعه نمایید و از منوی << مالی ، فاکتورها >> آنها را مشاهده نمایید. این قسمت امکان فیلتر یا جستجو در شرح فاکتورها را نیز دارد.

همچنین می توانید برای استفاده در برنامه خود، از تابع زیر استفاده نمایید تا از پرداخت آن توسط کاربر اطمینان پیدا کنید:

```java
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            GetInvoiceListVo getInvoiceListVo = new GetInvoiceListVo.Builder(baseInfoVo)
                    .setOffset(0L)
                    .setSize(10L)
                    .build();
            billingService.getInvoiceList(getInvoiceListVo, new OnGetResponseListener<List<InvoiceSrv>>() {
                @Override
                public void onResponse(ResultVo<List<InvoiceSrv>> result) {
                    System.out.println(result.getResult().get(0).getId());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

همچنین برای جستجو در متادیتای ثبت شده برای فاکتور می توانید از تابع زیر استفاده نمایید:

```java
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            GetInvoiceListByMetadataVo getInvoiceListByMetadataVo = new GetInvoiceListByMetadataVo.Builder(baseInfoVo)
                    .build();
            billingService.getInvoiceListByMetadata(getInvoiceListByMetadataVo,
                    new OnGetResponseListener<List<InvoiceSrv>>() {
                        @Override
                        public void onResponse(ResultVo<List<InvoiceSrv>> result) {
                            System.out.println(result.getResult().size());
                        }

                        @Override
                        public void onFailed(PodException e) {
                            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                        }
                    });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

در قسمت metaQuery مقادیر درخواستی خود را به فرم json با استفاده از توصیحات [جستجوی متادیتا](https://docs.pod.land/document/Developer-CustomPost-SearchMetadata) ارسال نمایید.

کد خطاهای رایج در سرویس " **دریافت فاکتور**"

| ستون 1        | ستون 2                   | ستون 3            |
| ------------- | ------------------------ | ----------------- |
| **errorCode** | **دلیل خطا**             | **شرح**           |
| 21            | client not authenticated | ارسال توکن اشتباه |
| 999           | UNKHOWN                  | خطای داخلی        |


هم‌چنین امکان دریافت لیست فاکتورها در قالب فایل نیز وجود دارد.

در بین پارامترهای ارسالی یکی از پارامترهای lastNRows و یا بازه زمانی اجباری است.

```java
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            GetInvoiceListAsFileVo getInvoiceListAsFileVo = new GetInvoiceListAsFileVo.Builder(baseInfoVo)
                    .setLastNRows(10L)
                    .build();
            billingService.getInvoiceListAsFile(getInvoiceListAsFileVo, new OnGetResponseListener<ExportServiceSrv>() {
                @Override
                public void onResponse(ResultVo<ExportServiceSrv> result) {
                    System.out.println(result.getResult().getId());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

## ابطال فاکتور
در صورتی که فاکتور باطل شود، دیگر قابل پرداخت نیست و در صورتی که قبلا پرداخت شده باشد، مبلغ آن به پرداخت کننده برگشت خواهد خورد.
توجه: در صورتی که فاکتور با شرایط safe=true صادر شده باشد، فقط پرداخت کننده می تواند فاکتور را کنسل کند و اگر safe نباشد فقط   issuer  فاکتور مجاز به کنسلی فاکتور می باشد. 

```java
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            CancelInvoiceVo cancelInvoiceVo = new CancelInvoiceVo.Builder(baseInfoVo)
                    .setId(3581653L)
                    .build();
            billingService.cancelInvoice(cancelInvoiceVo, new OnGetResponseListener<Boolean>() {
                @Override
                public void onResponse(ResultVo<Boolean> result) {
                    System.out.println(result.getResult());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

در صورتی که فاکتور مورد نظر تسهیمی است، شناسه ای که باید به این سرویس ارسال گردد، معادل result -> id موجود در خروجی فاکتور تسهیمی می باشد. در این صورت تمام فاکتورهای ثبت شده برای یک تسهیم مرجوع می گردند.

**خطاهای سرویس کنسل نمودن فاکتور** **:**

| ستون 1        | ستون 2                   | ستون 3                                                                 |
| ------------- | ------------------------ | ---------------------------------------------------------------------- |
| **errorCode** | **دلیل خطا**             | **شرح**                                                                |
| 4             | PERMISSION_DENIED        | اگر مجوز برای برگشت زدن فاکتور نداشته باشید این خطا را دریافت می کنید. |
| 21            | client not authenticated | مقدار توکن اشتباه ارسال شده است.                                       |
| 32            | INVOICE_IS_CANCELED      | فاکتور کنسل شده است.                                                   |
| 45            | BILL_ALREADY_CLOSED      | فاکتور بسته شده قابل ابطال نیست.                                       |
| 999           | UNKNOWN                  | خطای داخلی                                                             |

## تایید و بستن فاکتور در یک مرحله
با فراخوانی تابع زیر، می‌توانید همزمان تایید و بستن فاکتور را انجام دهید:
<br>

```java
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            VerifyAndCloseInvoiceVo verifyAndCloseInvoiceVo = new VerifyAndCloseInvoiceVo.Builder(baseInfoVo)
                    .setId(3581653L)
                    .build();
            billingService.verifyAndCloseInvoice(verifyAndCloseInvoiceVo, new OnGetResponseListener<InvoiceSrv>() {
                @Override
                public void onResponse(ResultVo<InvoiceSrv> result) {
                    System.out.println(result.getResult().getId());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

هنگام استفاده از این وب سرویس به نکات زیر دقت نمایید:
1. 	مبلغ فاکتور بعد از واریز شاپرک قابل برداشت خواهد بود
2. 	بعد از فراخوانی این سرویس امکان کاهش فاکتور یا لغو فاکتور وجود ندارد
3. 	جهت واریز وجه به مشتری پرداخت کننده فاکتور، لازم است از تابع transferByInvoice استفاده نمایید که شامل کارمزد می باشد.
4. 	بعد از فراخوانی این سرویس وضعیت فاکتور دیگر تغییر نخواهد کرد

## بستن فاکتور
فاکتور هایی که بسته شوند دیگر قابل ابطال نیستند. برای اینکه بتوانید مبالغ فروش خود را تسویه نمایید لازم است حتما فاکتورها را ببندید.
چنان چه فاکتورها به صورت **safe=true**  صادر شده باشد و یا فاکتور متعلق به کسب و کار شما نباشد پیغام خطای " **اجازه بستن این فاکتور را ندارید** " دریافت خواهید کرد.

```java
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            CloseInvoiceVo closeInvoiceVo = new CloseInvoiceVo.Builder(baseInfoVo)
                    .setId(3360466L)
                    .build();
            billingService.closeInvoice(closeInvoiceVo, new OnGetResponseListener<Boolean>() {
                @Override
                public void onResponse(ResultVo<Boolean> result) {
                    System.out.println(result.getResult());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

در صورتی که فاکتور مورد نظر تسهیمی است، شناسه ای که باید به این سرویس ارسال گردد، معادل result -> id موجود در خروجی فاکتور تسهیمی می باشد. تا زمانی که فاکتور بسته نشود هیچکدام از ذینفعان قادر به تسویه و برداشت سهم خود نیستند.

**خطای سرویس "بستن فاکتور** **":**

| ستون 1        | ستون 2                           | ستون 3                                                                      |
| ------------- | -------------------------------- | --------------------------------------------------------------------------- |
| **errorCode** | **دلیل خطا**                     | **شرح**                                                                     |
| 21            | client not authenticated         | ارسال مقدار اشتباه برای توکن                                                |
| 45            | BILL_ALREADY_CLOSED              | فاکتور بسته شده است.                                                        |
| 55            | BILL_NOT_PAYED                   | اگر فاکتوری که پرداخت نشده است را بخواهید ببندید این خطا را دریافت می کنید. |
| 58            | BILL_IS_WAITING_FOR_VERIFICATION | فاکتور تا قبل از تایید شدن قابل بستن نمی باشد.                              |
| 999           | UNKHOWN                          | خطای داخلی                                                                  |
| 4             | PERMISSION_DENIED                | اجازه بستن این فاکتور را ندارید                                             |

## دریافت لینک پرداخت
ممکن است لازم باشد لینک پرداخت برای مشتری با روش های مختلفی ارسال شود. این لینک قابل اشتراک گذاری خواهد بود و هر کسی که آن را داشته باشد می تواند آن را پرداخت نماید. برای دریافت لینک از تابع زیر استفاده نمایید:

```java
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            GetInvoicePaymentLinkVo getInvoicePaymentLinkVo = new GetInvoicePaymentLinkVo.Builder(baseInfoVo)
                    .setInvoiceId(3581653L)
                    .build();
            billingService.getInvoicePaymentLink(getInvoicePaymentLinkVo, new OnGetResponseListener<String>() {
                @Override
                public void onResponse(ResultVo<String> result) {
                    System.out.println(result.getResult());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```



در پاسخ سرویس فوق، لینک ذیل را دریافت خواهید کرد: 

[private-call-address]/v1/pbc/PayInvoiceDispatcher/?h=[hashCode]

که در صورت تمایل، می‌توانید پارامترهای redirectUri ، callbackUri  و "gateway="PEP را نیز ارسال نمایید. اگر پارامتر "gateway="PEP را در لینک بگذارید، کاربر مستقیما به صفحه درگاه پرداخت بانک پاسارگاد هدایت خواهد شد و در صورت ارسال پارامتر redirectUri کاربر ملزم به تکمیل فرآیند خرید، خواهد بود.

توجه داشته باشید که لینک فوق، شامل یک هش کد می‌باشد که مدت اعتبار آن 300 ثانیه می‌باشد؛ لذا در صورتی که با پیغام خطای " کد وارد شده معتبر نمی‌باشد و یا منقضی شده است." روبه‌رو شدید ممکن است کد هش منقضی شده باشد.

##  دریافت فایل خروجی فاکتورها
توسط تابع زیر امکان جستجو و دریافت **فایل**فاکتورهای صادر شده توسط کسب و کار قابل انجام خواهد بود و میتوانید ازخروجی این تابع یک **فایل اکسل** با فیلترهای متنوع دریافت کنید.

```java
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            GetInvoiceListAsFileVo getInvoiceListAsFileVo = new GetInvoiceListAsFileVo.Builder(baseInfoVo)
                    .setLastNRows(10L)
                    .build();
            billingService.getInvoiceListAsFile(getInvoiceListAsFileVo, new OnGetResponseListener<ExportServiceSrv>() {
                @Override
                public void onResponse(ResultVo<ExportServiceSrv> result) {
                    System.out.println(result.getResult().getId());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

بدیهی است در تابع بالا با توجه به اختیاری بودن اکثر فیلدها اگر هیچ یک از پارامترهای اختیاری ارسال نشود گزارش حجیم تر و کاملتری در اکسل خواهید داشت و هرچه تعداد فیلترها بیشتر باشد گزارش دقیق تر و سبک تری در اختیار خواهید داشت.

در صورت موفقیت آمیز بودن سرویس یک شناسه (**ID**) برای فایل ایجاد شده صادر خواهد شد و **statusCode ** برابر با مقدار **EXPORT_SERVICE_STATUS_CREATED **قرار خواهد گرفت در این مرحله باید حدود **1**  تا **2**  دقیقه منتظر بمانید تا **statusCode ** به **EXPORT_SERVICE_STATUS_SUCCESSFUL**  تغییر وضعیت بدهد.

کدهای وضعیتی که ممکن است در حین کار با این تابع مشاهده کنید به شرح زیر میباشد.

EXPORT_SERVICE_STATUS_CREATED // سرویس در حال ایجاد فایل میباشد

EXPORT_SERVICE_STATUS_RUNNING  // فایل در حال آماده سازی میباشد

EXPORT_SERVICE_STATUS_SUCCESSFUL   //  فایل با موفقیت ایجاد شد

EXPORT_SERVICE_STATUS_FAILED // خطایی در ایجاد فایل اتفاق افتاده است


## پرداخت فاکتور خارج از پلتفرم پاد

در صورتی که فاکتور به هر شکلی بجز امکانات موجود در پلتفرم پاد پرداخت شد، می‎‌توانید با استفاده از سرویس زیر، وضعیت آن را به حالت پرداخت شده ببرید. در این روش هیچ‌گونه سند مالی در پلتفرم ثبت نشده و به اعتبار افزوده نمی‌شود.

دقت نمایید که کسب و کار فقط می‌تواند فاکتورهایی که خودش صادر نموده را با این روش پرداخت کند.

```java
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken({token})
                .setToken_issuer(1)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            PayInvoiceVo payInvoiceVo = new PayInvoiceVo.Builder(baseInfoVo)
                    .setInvoiceId({invoiceId})
                    .build();
            billingService.payInvoice(payInvoiceVo, new OnGetResponseListener<Boolean>() {
                @Override
                public void onResponse(ResultVo<Boolean> result) {
                    System.out.println(result.getResult());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

## پرداخت از کیف پول کسب و کار با توکن کسب و کاری

جهت پرداخت فاکتور با حساب کیف پول کسب و کار در صورتی که فاکتور مشخصا برای شما صادر شده باشد می‌توانید از سرویس زیر استفاده نمایید:

```java
 BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken({token})
                .setToken_issuer(1)
                .setOtt({ott})
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            PayInvoiceByCreditVo payInvoiceByCreditVo = new PayInvoiceByCreditVo.Builder(baseInfoVo)
                    .setInvoiceId({invoiceId})
                    .build();
            billingService.payInvoiceByCredit(payInvoiceByCreditVo, new OnGetResponseListener<Boolean>() {
                @Override
                public void onResponse(ResultVo<Boolean> result) {
                    System.out.println(result.getResult());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```



در صورتی که فاکتور برای شما صادر نشده یا اصلا کاربر ندارد، جهت پرداخت آن از سرویس زیر استفاده نمایید:

```java
 BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken({token})
                .setToken_issuer(1)
                .setOtt({ott})
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            PayAnyInvoiceByCreditVo payAnyInvoiceByCreditVo = new PayAnyInvoiceByCreditVo.Builder(baseInfoVo)
                    .setInvoiceId({invoiceId})
                    .setWallet("{walletCode}")
                    .build();
            billingService.payAnyInvoiceByCredit(payAnyInvoiceByCreditVo, new OnGetResponseListener<Boolean>() {
                @Override
                public void onResponse(ResultVo<Boolean> result) {
                    System.out.println(result.getResult());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

## پرداخت از طریق درگاه

کسب و کار می‌تواند برای تمام مشتریان خود، بدون نیاز به ورود به سامانه احراز هویت یکپارچه، امکان خرید را از طریق لینک زیر فراهم کند. برای این منظور لازم است کسب و کار از کد یکتا که برای فاکتور تولید می‌شود استفاده نماید.

مراحل انجام کار به ترتیب:

1. [ثبت نام کسب و کار](https://docs.pod.land/document/Business-Requirements-BusinessRegister) در [https://services.pod.land](https://panel.pod.land/Home/AddBusiness)
2. [دریافت توکن جهت فراخوانی سرویس ها](http://docs.pod.land/document/Business-Keys-Add)
3. [ثبت فاکتور](https://docs.pod.land/document/Developer-Invoice-IssueInvoiceByBiz): دقت نمایید در صورت تمایل به نمایش شماره کارت های مربوط به مشتری، در صفحه درگاه ضروری است شناسه کاربر (userId) در فاکتور ثبت شود. این شناسه پس از ورود کاربر از طریق SSO بدست آمده یا می تواند شناسه ی کاربر آفلاین (غیر SSO) باشد. در صورتی که شماره موبایل مربوط به هیچکدام از این دودسته نیست، می توان با ثبت شماره موبایل (cellphoneNumber) در فاکتور، همین نتیجه را دریافت نمود.
4. هدایت کاربر به درگاه (توسط لینک زیر)
5. [تایید پرداخت](https://docs.pod.land/document/Developer-Invoice-VerifyInvoice)
6. [بستن فاکتور](https://docs.pod.land/document/Developer-Invoice-CloseInvoice)
7. [تسویه](https://docs.pod.land/document/Developer-WalletOperation-SettlementRequest)

```java
   BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken({token})
                .setToken_issuer(1)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        try {
            PayInvoiceByUniqueNumberVo payInvoiceByUniqueNumberVo = new PayInvoiceByUniqueNumberVo.Builder(baseInfoVo)
                    .setUniqueNumber({uniqueNumber})
                    .setGateway("PEP")
                    .setRedirectUri("{redirectUri}")
                    .build();
            return payInvoiceByUniqueNumberVo.getLink();

        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
        return null;

    }
```

## پرداخت فاکتور با کیف پول از طریق پیامک
در صورتی که کاربر به رایانه جهت پرداخت دسترسی ندارد، یا در فروش حضوری، کسب و کار میتواند درخواست ارسال پیامک پرداخت به کاربر دهد و کاربر با پیامک کردن کدی که دریافت کرده به همان شماره، فاکتور را از کیف پول خود پرداخت مینماید.

```java
 BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken({token})
                .setToken_issuer(1)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            SendInvoicePaymentSmsVo sendInvoicePaymentSMSVo = new SendInvoicePaymentSmsVo.Builder(baseInfoVo)
                    .setInvoiceId({invoiceId})
                    .build();
            billingService.sendInvoicePaymentSMS(sendInvoicePaymentSMSVo, new OnGetResponseListener<Boolean>() {
                @Override
                public void onResponse(ResultVo<Boolean> result) {
                    System.out.println(result.getResult());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

## پرداخت فاکتور از طریق فاکتور
از طریق این سرویس کسب و کار قادر خواهد بود که پرداخت شدن برخی فاکتورهای خود را منوط به پرداخت شدن فاکتورهای دیگری نماید. یا به عبارتی نوعی تهاتر را بوسیله فاکتورها انجام دهد که این امر توسط سرویس زیر قابل اجرا خواهد بود

```java
 BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken({token})
                .setToken_issuer(1)
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            PayInvoiceByInvoiceVo payInvoiceByInvoiceVo = new PayInvoiceByInvoiceVo.Builder(baseInfoVo)
                  .setCreditorInvoiceId({creditorInvoiceId})
                    .setDebtorInvoiceId({debtorInvoiceId})
                    .build();
            billingService.payInvoiceByInvoice(payInvoiceByInvoiceVo, new OnGetResponseListener<Boolean>() {
                @Override
                public void onResponse(ResultVo<Boolean> result) {
                    System.out.println(result.getResult());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

## پرداخت فاکتور در آینده
از طریق این سرویس کسب و کار قادر خواهد بود فاکتورهایی که برایش توسط دیگران صادر شده را درتاریخ آینده یا سررسید توافقی از طریق مبلغی که در کیف پول یا اصناف خود دارد  پرداخت نماید .

این سرویس باید توسط کسب و کار یا کاربر بدهکار یا شخصی که فاکتور برایش صادر شده صدا زده شود در غیر این صورت با خطای زیر روبرو خواهد شد

```java
 BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken({token})
                .setToken_issuer(1)
                .setOtt({ott})
                .setServerType(Enum_Server_type.PRODUCTION)
                .build();

        BillingService billingService = new BillingService();

        try {
            PayInvoiceInFutureVo payInvoiceInFutureVo = new PayInvoiceInFutureVo.Builder(baseInfoVo)
                    .setDate()
                    .setInvoiceId({invoiceId})
                    .setGuildCode({guildCode})
                    .build();
            billingService.payInvoiceInFuture(payInvoiceInFutureVo, new OnGetResponseListener<Boolean>() {
                @Override
                public void onResponse(ResultVo<Boolean> result) {
                    System.out.println(result.getResult());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
```

# [NodeJS](#tab/nodejs)


# فاکتور - NodeJS

**ماژول** **pod-billing-service**

توابع این ماژول قابلیت های زیر را در اختیار شما قرار می دهد:

* 	تمامی چرخه مربوط به فاکتور از ایجاد، پرداخت، تایید تا ابطال آن
* 	روش های پرداخت (لینک های پرداخت کیف پول و درگاه، پرداخت نامتعارف)
* 	ایجاد و مدیریت فاکتورهای تسهیمی
* 	تسویه حساب کسب و کار

با توجه به نیاز خود می توانید از هر کدام از قابلیت های ذکر شده استفاده کنید.

**دریافت ماژول **

``` nodejs
npm install pod-billing-service
```


**ایجاد یک نمونه از ماژول:**

در هنگام ایجاد شی از این سرویس حتما باید توکن دسترسی کسب و کار خود (API TOKEN) را به سازنده ماژول ارسال کنید. همچنین اگر بخواهید به سرور تست (sandbox) وصل شوید باید از حالت دوم ایجاد سرویس استفاده کنید و مقدار پارامتر serverType را برابر با sandbox قرار دهید.
<br>

``` nodejs
const PodBillingService = require('pod-billing-service');
let podBillingService = new PodBillingService({
  apiToken: 'API TOKEN'
});
/* let podBillingService = new PodBillingService({
  apiToken: 'API TOKEN',
  serverType: 'sandboxs'
}); */
```


**توابع:**

1. getOtt
2. issueInvoice
3. createPreInvoice
4. getInvoiceList
5. payInvoice
6. sendInvoicePaymentSMS
7. getInvoiceListByMetadata
8. getInvoiceListAsFile
9. verifyInvoice
10. cancelInvoice
11. reduceInvoice
12. verifyAndCloseInvoice
13. closeInvoice
14. getInvoicePaymentLink
15. payInvoiceByInvoice
16. payInvoiceInFuture
17. getExportList
18. requestWalletSettlement
19. requestGuildSettlement
20. requestSettlementByTool
21. listSettlements
22. addAutoSettlement
23. removeAutoSettlement
24. getPayInvoiceByWalletLink
25. getPayInvoiceByUniqueNumberLink
26. guildList
27. addDealer
28. dealerList
29. enableDealer
30. disableDealer
31. businessDealingList
32. issueMultiInvoice
33. reduceMultiInvoice
34. addDealerProductPermission
35. dealerProductPermissionList
36. dealingProductPermissionList
37. disableDealerProductPermission
38. enableDealerProductPermission


## گرفتن توکن یکبارمصرف
1. getOtt: برای گرفتنott (توکن یک بار مصرف) از این تابع استفاده می شود


``` nodejs
let getOttData = {
  // ------ REQUIRED ------
  // ------ OPTIONAL ------
};

podBillingService.getOtt(getOttData)
  .then(function (result) {
    console.log('function: getOtt ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error getOtt ============>', error);
  });
```

نمونه خروجی:

```
{ hasError: false,
  messageId: 0,
  referenceNumber: '234890294',
  errorCode: 0,
  count: 0,
  ott: 'e3b3e04303a09500' }
```


## ایجاد فاکتور
2. issueInvoice: با این تابع می توانید یک فاکتور ایجاد کنید. ott مورد نیاز را از تابع  getOtt دریافت کنید. مقدار پیش فرض مالیات برابر با 0.09  است.

``` nodejs
let issueInvoiceData = {
  // ------ REQUIRED ------
  _ott_: 'OTT', // get the ott from getOtt API
  productList: [
    { productId: 0, price: 0, quantity: 0, productDescription: 'DESCRIPTION' },
    { productId: 0, price: 0, quantity: 0, productDescription: 'DESCRIPTION' }
  ],
  guildCode: 'GUILD CODE'

  // ------ OPTIONAL ------
  // redirectURL: 'REDIRECT URL'
  // userId: USER ID
  // billNumber: 'BILL NUMBER'
  // description: 'DESCRIPTION'
  // deadline: 'DEADLINE'
  // currencyCode: 'CURRENCY CODE'
  // addressId: ADDRESS ID
  // voucherHash: 'VOUCHER HASH'
  // preferredTaxRate: TAX RATE
  // verificationNeeded: true | false
  // verifyAfterTimeout: true | false
  // preview: true | false
  // metadata: OBJECT
  // safe: 'SAFE'
  // postVoucherEnabled: 'POST VOUCHER ENABLED'
  // hasEvent: 'HAS EVENT'
  // eventTitle: 'EVENT TITLE'
  // eventTimeZone: 'TIME ZONE'
  // eventReminders: ARRAY OF OBJECTS
  // eventDescription: 'DESCRIPTION'
  // eventMetadat: OBJECT
};
podBillingService.issueInvoice(issueInvoiceData)
  .then(function (result) {
    console.log('function: issueInvoice ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error issueInvoice ============>', error);
  });
```

نمونه خروجی:

```
{ hasError: false,
  messageId: 0,
  referenceNumber: '234895676',
  errorCode: 0,
  count: 0,
  ott: 'd88757b1f3e9a198',
  result:
   { id: 3523363,
     totalAmountWithoutDiscount: 2200,
     delegationAmount: 0,
     totalAmount: 2200,
     payableAmount: 2398,
     vat: 198,
     issuanceDate: 1563105877970,
     deliveryDate: 0,
     paymentBillNumber: '6043042',
     uniqueNumber: 'ca7c5292f173673c',
     paymentDate: 0,
     payed: false,
     serial: 0,
     canceled: false,
     cancelDate: 0,
     business:
      { id: 3605,
        name: '&#x641;&#x646;&#x627;&#x67E; &#x62A;&#x633;&#x62A; &#x645;&#x634;&#x647;&#x62F;',
        numOfProducts: 3,
        rate: [Object],
        sheba: '080570100611513898506001' },
     invoiceItemSrvs: [ [Object], [Object] ],
     guildSrv:
      { id: 47,
        name: '&#x641;&#x646;&#x627;&#x648;&#x631;&#x6CC; &#x627;&#x637;&#x644;&#x627;&#x639;&#x627;&#x62A;',
        code: 'INFORMATION_TECHNOLOGY_GUILD' },
     userSrv:
      { id: 1453911,
        name: '&#x627;&#x62D;&#x633;&#x627;&#x646; &#x634;&#x6A9;&#x627;&#x631;&#x6CC;',
        ssoId: '6253140',
        ssoIssuerCode: 1,
        profileImage: 'https://core.pod.land:443/nzh/image/?imageId=104132&width=409&height=409&hashCode=16afd4e69b5-0.30817062367834125' },
     phoneNumber: '05138945234',
     cellphoneNumber: '09155234338',
     closed: false,
     verificationNeeded: false,
     metadata: '{"name":"ehsan"}',
     safe: false,
     postVoucherEnabled: false,
     referenceNumber: '234895676',
     issuerSrv:
      { id: 1454449,
        name: '&#x627;&#x62D;&#x633;&#x627;&#x646; &#x634;&#x6A9;&#x627;&#x631;&#x6CC;',
        ssoId: '6254762',
        ssoIssuerCode: 1,
        profileImage: 'https://core.pod.land:443/nzh/image/?imageId=69962&width=498&height=498&hashCode=16a679c6ad9-0.3413974672033351' },
     willBeBlocked: false,
     willBePaid: false,
     edited: false,
     waiting: false,
     subInvoice: false } }
```



## ایجاد پیش‌فاکتور
3. createPreInvoice: با استفاده از این تابع می توانید یک پیش فاکتور ایجاد کنید. از خروجی این تابع می توانید لینک نمایش این پیش فاکتور را دریافت کنید. با ورود کاربر به صفحه پرداخت این فاکتور برای شما ثبت خواهد شد.

``` nodejs
let createPreInvoiceData = {
  // ------ REQUIRED ------
  _ott_: 'OTT',
  productList: [
    { productId: 0, price: 0, quantity: 0, productDescription: 'My first product!' },
    { productId: 0, price: 0, quantity: 0, productDescription: 'My Second Product!' }
  ],
  guildCode: 'GUILD CODE',
  redirectURL: 'REDIRECT URL',
  userId: 0

  // ------ OPTIONAL ------
  // callUrl: 'CALL URL'
  // billNumber: 'BILL NUMBER'
  // description: 'DESCRIPTION'
  // deadline: 'DEADLINE'
  // currencyCode: 'CURRENCY CODE'
  // addressId: ADDRESS ID
  // preferredTaxRate: TAX RATE
  // verificationNeeded: true | false
};
podBillingService.createPreInvoice(createPreInvoiceData)
  .then(function (result) {
    console.log('function: createPreInvoice ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error createPreInvoice ============>', error);
  });
```


نمونه خروجی:


```
{ Ott: 'ZMwBqgyu7W',
  ErrorCode: 0,
  Count: 0,
  Result:
   { hash: 'YqKvIug6fuvqgj8P',
     url: 'https://pay.pod.land/v1/pbc/preinvoice/YqKvIug6fuvqgj8P' },
  ErrorMessage: null,
  HasError: false }
```


## گرفتن لیست فاکتورها

4. getInvoiceList: با این تابع می توانید لیست فاکتورهای خود را ببنید و در آن ها بر اساس معیارهای مختلف همانند وضعیت و تاریخ جست و جو کنید

``` nodejs
let getInvoiceListData = {
  // ------ REQUIRED ------
  offset: 0

  // ------ OPTIONAL ------
  // size: SIZE
  // id: ID
  // billNumber: 'BILL NUMBER'
  // uniqueNumber: 'UNIQUE NUMBER'
  // trackerId: ID
  // fromDate: 'FROM DATE'
  // toDate: 'TO DATE'
  // isCanceled: true | false
  // isPayed: true | false
  // isClosed: true | false
  // isWaiting: true | false
  // guildCode: 'GUILD CODE'
  // referenceNumber: 'REFERENCE NUMBER'
  // userId: ID
  // issuerId: ID
  // query: 'QUERY'
  // firstId: ID
  // lastId: ID
  // productIdList: ARRAY OF INTEGERS
};

podBillingService.getInvoiceList(getInvoiceListData)
  .then(function (result) {
    console.log('function: getInvoiceList ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error getInvoiceList ============>', error);
  });
```

نمونه خروجی:

```
{ hasError: false,
  messageId: 0,
  referenceNumber: '234905523',
  errorCode: 0,
  count: 412,
  ott: '38a87663be64292e',
  result:
   [ { id: 3523587,
       totalAmountWithoutDiscount: 2200,
       delegationAmount: 0,
       totalAmount: 2200,
       payableAmount: 2398,
       vat: 198,
       issuanceDate: 1563106619707,
       deliveryDate: 0,
       paymentBillNumber: '6043350',
       uniqueNumber: '5d5bebef79ea180',
       paymentDate: 0,
       payed: false,
       serial: 0,
       canceled: false,
       cancelDate: 0,
       business: [Object],
       invoiceItemSrvs: [Object],
       guildSrv: [Object],
       userSrv: [Object],
       phoneNumber: '05138945234',
       cellphoneNumber: '09155234338',
       closed: false,
       verificationNeeded: false,
       metadata: '{"name":"ehsan"}',
       safe: false,
       postVoucherEnabled: false,
       referenceNumber: '234905206',
       issuerSrv: [Object],
       willBeBlocked: false,
       willBePaid: false,
       waiting: false,
       edited: false,
       subInvoice: false } ],
  aggregations:
   { payableAmountSum: 393306599.7,
     delegationAmountSum: 0,
     totalAmountSum: 361229841 } }
```


## پرداخت فاکتور 
5. payInvoice: با این تابع می توانید پرداخت های غیر متعارف (خارج از پلتفرم را کنترل کنید) به عنوان مثال اگر مبلغ فاکتور را به صورت حضوری از مشتری دریافت کردید می توانید با صدا زدن این تابع وضعیت فاکتور مورد نظر خود را به صورت پرداخت شده ببرید.

``` nodejs
let payInvoiceData = {
  // ------ REQUIRED ------
  invoiceId: 0

  // ------ OPTIONAL ------
};

podBillingService.payInvoice(payInvoiceData)
  .then(function (result) {
    console.log('function: payInvoice ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error payInvoice ============>', error);
  });
```


نمونه خروجی:


```
{ hasError: false,
  messageId: 0,
  referenceNumber: '234910992',
  errorCode: 0,
  count: 0,
  ott: 'c1c25f4661687649',
  result: true }
```


## ارسال پیامک پرداخت فاکتور
6. sendInvoicePaymentSMS: با استفاده از این تابع می توانید پیامک پرداخت فاکتور را برای کاربر ارسال کنید و در صورت تایید او فاکتور پرداخت خواهد شد.

``` nodejs
let sendInvoicePaymentSMSData = {
  // ------ REQUIRED ------
  invoiceId: 0

  // ------ OPTIONAL ------
  // wallet: 'WALLET NAME'
  // callbackUri: 'CALLBACK URI'
  // redirectUri: 'REDIRECT URI'
  // delegationId: ARRAY OF INTEGERS
  // forceDeligation: 'FORCE DELIGATION'
};

podBillingService.sendInvoicePaymentSMS(sendInvoicePaymentSMSData)
  .then(function (result) {
    console.log('function: sendInvoicePaymentSMS ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error sendInvoicePaymentSMS ============>', error);
  });
```


نمونه خروجی

```
{ hasError: false,
  messageId: 0,
  referenceNumber: '234913357',
  errorCode: 0,
  count: 0,
  ott: 'de229e25d169d116',
  result: true }
```


## گرفتن لیست فاکتورها بر اساس متادیتا
7. getInvoiceListByMetadata: در هنگام ثبت فاکتور می توانید اطلاعات دلخواه خود را در کلید metadata قرار دهید. در صورتی که بخواهید در بین متا دیتای فاکتورهای خود جستجو کنید می توانید از این تابع استفاده کنید.

``` nodejs
let getInvoiceListByMetadataData = {
  // ------ REQUIRED ------

  // ------ OPTIONAL ------
  // metaQuery: OBJECT
  // offset: OFFSET
  // size: SIZE
  // isPayed: true | false
  // isCancelled: true | false
};

podBillingService.getInvoiceListByMetadata(getInvoiceListByMetadataData)
  .then(function (result) {
    console.log('function: getInvoiceListByMetadata ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error getInvoiceListByMetadata ============>', error);
  });
```

نمونه خروجی

```
{ hasError: false,
  messageId: 0,
  referenceNumber: '234915872',
  errorCode: 0,
  count: 206,
  ott: '38f43a3dac677549',
  result:
   [ { id: 3523723,
       totalAmountWithoutDiscount: 2200,
       delegationAmount: 0,
       totalAmount: 2200,
       payableAmount: 2398,
       vat: 198,
       issuanceDate: 1563107220446,
       deliveryDate: 0,
       paymentBillNumber: '6043554',
       uniqueNumber: 'f4428c9d7d82595f',
       paymentDate: 0,
       payed: false,
       serial: 0,
       canceled: false,
       cancelDate: 0,
       business: [Object],
       invoiceItemSrvs: [Object],
       guildSrv: [Object],
       userSrv: [Object],
       phoneNumber: '05138945234',
       cellphoneNumber: '09155234338',
       closed: false,
       verificationNeeded: false,
       metadata: '{"name":"ehsan"}',
       safe: false,
       postVoucherEnabled: false,
       referenceNumber: '234913356',
       issuerSrv: [Object],
       willBeBlocked: false,
       willBePaid: false,
       edited: false,
       waiting: false,
       subInvoice: false } ],
  aggregations: { totalAmountSum: 39762160 } }
```


## گرفتن لیست فاکتورها به صورت فایل

8. getInvoiceListAsFile: ا این تابع می توانید بر اساس پارامترهای مختلف فاکتورها را فیلتر کنید و از نتیجه حاصل یک فایل اکسل تولید کنید. خروجی این تابع دارای خصیصه id ساخت که در ادامه برای دانلود فایل اکسل مورد نیاز است. ساخت فایل اکسل مدت زمانی طول می کشید و برای دریافت آن باید از تابع getExportList و id گرفته شده در این مرحله استفاده کرد.

``` nodejs
let getInvoiceListAsFileData = {
  // ------ REQUIRED (One of these fields is required) ------
  lastNRows: 0,
  fromDate: 'YYYY/MM/DD HH:MM:SS', // or 'YYYY/MM/DD'
  toDate: 'YYYY/MM/DD HH:MM:SS' // or 'YYYY/MM/DD'

  // ------ OPTIONAL ------
  // id: ID
  // billNumber: 'BILL NUMBER'
  // uniqueNumber: 'UNIQUE NUMBER'
  // trackerId: ID
  // isCancelled: true | false
  // isPayed: true | false
  // isClosed: true | false
  // isWaiting: true | false
  // guildCode: 'GUILD CODE'
  // referenceNumber: 'REFERENCE NUMBER'
  // query: 'QUERY'
  // productIdList: ARRAY OF INTEGERS
  // callbackUrl: 'CALL BACK URL'
};

podBillingService.getInvoiceListAsFile(getInvoiceListAsFileData)
  .then(function (result) {
    console.log('function: getInvoiceListAsFile ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error getInvoiceListAsFile ============>', error);
  });
```

نمونه خروجی

```
{ hasError: false,
  messageId: 0,
  referenceNumber: '234922848',
  errorCode: 0,
  count: 0,
  ott: '6597da3e76c88f4f',
  result:
   { id: 1714,
     statusCode: 'EXPORT_SERVICE_STATUS_CREATED',
     creationDate: 1563107956237,
     service: '/nzh/biz/getInvoiceList/' } }
```


## تایید فاکتور
9. verifyInvoice: اگر در هنگام صدور فاکتور کلید verificationNeeded را برابر با true قرار دهیم. فاکتور سه مرحله ایجاد شده و با استفاده از این تابع بعد از پرداخت فاکتور، می توانید پرداخت شدن آن را تایید کنید.

``` nodejs
let verifyInvoiceData = {
  // ------ REQUIRED (One of these fields is required) ------
  id: 0, // Invoice ID
  billNumber: 'BILLNUMBER'

  // ------ OPTIONAL ------
};
podBillingService.verifyInvoice(verifyInvoiceData)
  .then(function (result) {
    console.log('function: verifyInvoice ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error verifyInvoice ============>', error);
  });
```


## ابطال فاکتور
10. cancelInvoice: با استفاده از این تابع می توانید یک فاکتور را ابطال کنید.

``` nodejs
let cancelInvoiceData = {
  // ------ REQUIRED ------
  id: 0 // Invoice ID

  // ------ OPTIONAL ------
};
podBillingService.cancelInvoice(cancelInvoiceData)
  .then(function (result) {
    console.log('function: cancelInvoice ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error cancelInvoice ============>', error);
  });
```

نمونه خروجی:

```
{ hasError: false,
  messageId: 0,
  referenceNumber: '234931814',
  errorCode: 0,
  count: 0,
  ott: 'f8db5afde57bfdb1',
  result: true }
```


## کاهش فاکتور
11. reduceInvoice: در مواردی ممکن است نیاز به تغییری در بندهای فاکتور داشته باشید. در صورتی که فاکتور پرداخت نشده است، فاکتور قبلی را باطل (cancel) نمایید و فاکتور جدیدی صادر کنید. اگر فاکتور پرداخت شده است(در صورتی که باید پول بیشتری از مشتری دریافت نمایید)، لازم است فاکتوری جداگانه به مبلغ افزوده شده، با ذکر دلیل صادر نموده و مشتری را مجددا برای پرداخت هدایت نمایید. <u>در برخی مواقع لازم است مبلغی از فاکتور پرداخت شده به مشتری بازگردانده شود. برای این منظور از این تابع استفاده کنید.</u>

``` nodejs
let reduceInvoiceData = {
  // ------ REQUIRED ------
  id: 0, // INVOICE ID
  invoiceItemList: [
    { productId: 0, price: 0, quantity: 0, productDescription: 'DESCRIPTION' },
    { productId: 0, price: 0, quantity: 0, productDescription: 'DESCRIPTION' }
  ]

  // ------ OPTIONAL ------
  // preferredTaxRate: TAX RATE

};
podBillingService.reduceInvoice(reduceInvoiceData)
  .then(function (result) {
    console.log('function: reduceInvoice ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error reduceInvoice ============>', error);
  });
```

نمونه خروجی:

```
{ hasError: false,
  messageId: 0,
  referenceNumber: '234937866',
  errorCode: 0,
  count: 0,
  ott: 'd853f7108a9ecf2f',
  result:
   { id: 3524200,
     totalAmountWithoutDiscount: 30,
     delegationAmount: 0,
     totalAmount: 30,
     payableAmount: 30,
     vat: 0,
     issuanceDate: 1563109099536,
     deliveryDate: 0,
     paymentBillNumber: '6044300',
     uniqueNumber: '14b6d913730ea2d7',
     paymentDate: 0,
     payed: false,
     serial: 0,
     canceled: false,
     cancelDate: 0,
     business:
      { id: 3605,
        name: '&#x641;&#x646;&#x627;&#x67E; &#x62A;&#x633;&#x62A; &#x645;&#x634;&#x647;&#x62F;',
        numOfProducts: 3,
        rate: [Object],
        sheba: '080570100611513898506001' },
     invoiceItemSrvs: [ [Object], [Object] ],
     guildSrv:
      { id: 47,
        name: '&#x641;&#x646;&#x627;&#x648;&#x631;&#x6CC; &#x627;&#x637;&#x644;&#x627;&#x639;&#x627;&#x62A;',
        code: 'INFORMATION_TECHNOLOGY_GUILD' },
     userSrv:
      { id: 1453911,
        name: '&#x627;&#x62D;&#x633;&#x627;&#x646; &#x634;&#x6A9;&#x627;&#x631;&#x6CC;',
        ssoId: '6253140',
        ssoIssuerCode: 1,
        profileImage: 'https://core.pod.land:443/nzh/image/?imageId=104132&width=409&height=409&hashCode=16afd4e69b5-0.30817062367834125' },
     phoneNumber: '05138945234',
     cellphoneNumber: '09155234338',
     closed: false,
     verificationNeeded: false,
     editedInvoiceId: 3524198,
     metadata: '{"name":"ehsan"}',
     safe: false,
     postVoucherEnabled: false,
     referenceNumber: '234937866',
     issuerSrv:
      { id: 1454449,
        name: '&#x627;&#x62D;&#x633;&#x627;&#x646; &#x634;&#x6A9;&#x627;&#x631;&#x6CC;',
        ssoId: '6254762',
        ssoIssuerCode: 1,
        profileImage: 'https://core.pod.land:443/nzh/image/?imageId=69962&width=498&height=498&hashCode=16a679c6ad9-0.3413974672033351' },
     willBeBlocked: false,
     willBePaid: false,
     waiting: false,
     edited: false,
     subInvoice: false } }
```


## تایید و بستن فاکتور
12. verifyAndCloseInvoice: اگر در هنگام صدور فاکتور کلید verificationNeeded را برابر با true قرار دهیم. فاکتور سه مرحله ایجاد شده و با استفاده از این تابع بعد از پرداخت فاکتور، می توانید پرداخت شدن آن را تایید کنید و همزمان فاکتور را نیز ببندید.

``` nodejs
let verifyAndCloseInvoiceData = {
  // ------ REQUIRED ------
  id: 0 // INVOICE ID

  // ------ OPTIONAL ------
};

podBillingService.verifyAndCloseInvoice(verifyAndCloseInvoiceData)
  .then(function (result) {
    console.log('function: verifyAndCloseInvoice ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error verifyAndCloseInvoice ============>', error);
  });
```


## بستن فاکتور
13. closeInvoice: با این تابع می توانید یک فاکتور را ببندید. دقت داشته باشید برای تسویه باید فاکتورها را بسته باشید.

``` nodejs
let closeInvoiceData = {
  // ------ REQUIRED ------
  id: 0 // INVOICE ID

  // ------ OPTIONAL ------
};

podBillingService.closeInvoice(closeInvoiceData)
  .then(function (result) {
    console.log('function: closeInvoice ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error closeInvoice ============>', error);
  });
```


نمونه خروجی
<br>

```
{ hasError: false,
  messageId: 0,
  referenceNumber: '234953365',
  errorCode: 0,
  count: 0,
  ott: '9407b53648854388',
  result: true }
```


## گرفتن لینک پرداخت فاکتور
14. getInvoicePaymentLink: با این تابع می توانید لینک پرداخت یک فاکتور را دریافت کنید و فاکتور را از طریق درگاه بانکی پرداخت کنید

``` nodejs
let getInvoicePaymentLinkData = {
  // ------ REQUIRED ------
  invoiceId: 0 // INVOICE ID

  // ------ OPTIONAL ------
  // callbackUri: 'CALLBACK URI'
  // redirectUri: 'REDIRECT URI'
  // gateway: 'PEP'
};

podBillingService.getInvoicePaymentLink(getInvoicePaymentLinkData)
  .then(function (result) {
    console.log('function: getInvoicePaymentLink ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error getInvoicePaymentLink ============>', error);
  });
```


نمونه خروجی
<br>

```
{ hasError: false,
  messageId: 0,
  referenceNumber: '234959959',
  errorCode: 0,
  count: 0,
  ott: 'dcdfd6a89be5232e',
  result: 'https://gw.pod.land/v1/pbc/PayInvoiceDispatcher/?h=a2c55acb239f4ef184222ce4662bb6bc&' }
```


## پرداخت فاکتور به وسیله‌ی فاکتور
15. payInvoiceByInvoice: از طریق این سرویس کسب و کار قادر خواهد بود که پرداخت شدن برخی فاکتورهای خود را منوط به پرداخت شدن فاکتورهای دیگری نماید. یا به عبارتی نوعی تهاتر را بوسیله فاکتورها انجام دهد.

``` nodejs
let payInvoiceInFutureData = {
  // ------ REQUIRED ------
  invoiceId: 0, // INVOICE ID
  date: 'YYYY/MM/DD'

  // ------ OPTIONAL (Use just one of them) ------
  // guildCode: 'GUILD CODE'
  // wallet: 'WALLET'
};

podBillingService.payInvoiceInFuture(payInvoiceInFutureData)
  .then(function (result) {
    console.log('function: payInvoiceInFuture ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error payInvoiceInFuture ============>', error);
  });
```


## پرداخت فاکتور در آینده
16. payInvoiceInFuture: از طریق این تابع کسب و کار قادر خواهد بود فاکتورهایی که برایش توسط دیگران صادر شده را درتاریخ آینده یا سررسید توافقی از طریق مبلغی که در کیف پول یا اصناف خود دارد پرداخت نماید .این سرویس باید توسط کسب و کار یا کاربر بدهکار یا شخصی که فاکتور برایش صادر شده صدا زده شود.

``` nodejs
let payInvoiceInFutureData = {
  // ------ REQUIRED ------
  invoiceId: 0, // INVOICE ID
  date: 'YYYY/MM/DD'

  // ------ OPTIONAL (Use just one of them) ------
  // guildCode: 'GUILD CODE'
  // wallet: 'WALLET'
};

podBillingService.payInvoiceInFuture(payInvoiceInFutureData)
  .then(function (result) {
    console.log('function: payInvoiceInFuture ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error payInvoiceInFuture ============>', error);
  });
```


## گرفتن لیست خروجی
17. getExportList: این تابع لینک دانلود فایل های اکسل تولید شده را به شما خواهد داد. همچنین  با داشتن id ای که تابع getInvoiceListAsFile در خروجی می دهد می توانید تنها لینک دانلود فایل مورد نظر خود را استخراج کنید.

``` nodejs
let getExportListData = {
  // ------ REQUIRED ------
  offset: 0,
  sie: 0

  // ------ OPTIONAL ------
  // id: ID
  // statusCode: 'EXPORT_SERVICE_STATUS_CREATED' | 'EXPORT_SERVICE_STATUS_RUNNING' |'EXPORT_SERVICE_STATUS_SUCCESSFUL' | 'EXPORT_SERVICE_STATUS_FAILED'
  // serviceUrl: 'SERVICE URL'
};

podBillingService.getExportList(getExportListData)
  .then(function (result) {
    console.log('function: getExportList ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error getExportList ============>', error);
  });
```


نمونه خروجی
<br>

```
{ hasError: false,
  messageId: 0,
  referenceNumber: '234993235',
  errorCode: 0,
  count: 49,
  ott: '46d38b30c28d1985',
  result:
   [ { id: 1714,
       statusCode: 'EXPORT_SERVICE_STATUS_SUCCESSFUL',
       creationDate: 1563107956237,
       resultFile: [Object],
       service: '/nzh/biz/getInvoiceList/' } ] }
```


## درخواست تسویه‌حساب کیف پول
18. requestWalletSettlement: این تابع انتقال پول از کیف پول به حساب بانکی را انجام می دهد. به عبارت دیگر مبلغ مورد نظر خود را با استفاده از این تابع می توانید از کیف پول خود به حساب بانکی منقل کنید.

``` nodejs
let requestWalletSettlementData = {
  // ------ REQUIRED ------
  _ott_: 'OTT',
  amount: 0

  // ------ OPTIONAL ------
  // wallet: 'WALLET'
  // firstName: 'FIRST NAME'
  // lastName: 'LAST NAME'
  // sheba: 'SHEBA WITHOUT IR'
  // currencyCode: 'CURRENCY'
  // uniqueId: ID
  // description: 'DESCRIPTION'
};

podBillingService.requestWalletSettlement(requestWalletSettlementData)
  .then(function (result) {
    console.log('function: requestWalletSettlement ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error requestWalletSettlement ============>', error);
  });
```


## درخواست تسویه‌حساب صنف
19. requestGuildSettlement: این تابع انتقال پول ازهر یک از حساب های صنفی را به حساب بانکی انجام می دهد.

``` nodejs
let requestGuildSettlementData = {
  // ------ REQUIRED ------
  _ott_: 'OTT',
  amount: 0,
  guildCode: 'GUILD CODE'

  // ------ OPTIONAL ------
  // firstName: 'FIRST NAME'
  // lastName: 'LAST NAME'
  // sheba: 'SHEBA WITHOUT IR'
  // currencyCode: 'CURRENCY'
  // uniqueId: ID
  // description: 'DESCRIPTION'
};

podBillingService.requestGuildSettlement(requestGuildSettlementData)
  .then(function (result) {
    console.log('function: requestGuildSettlement ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error requestGuildSettlement ============>', error);
  });
```


## درخواست تسویه‌حساب با ابزار
20. requestSettlementByTool: این تابع انتقال پول از هر یک از حساب های صنفی را به حساب بانکی انجام می دهد. علاوه بر این با استفاده از این تابع می توانید انتخاب  کنید که به چه روشی و به کدام حساب پول (کارت یا شبا) منتقل شود. در صورت استفاده از ابزار کارت به کارت، کارمزد بانکی از حساب کسب و کار کسر خواهد شد و در صورت استفاده از ابزار پایا، انتقال وجه در زمان مصوب بانک مرکزی انجام خواهد شد.

``` nodejs
let requestSettlementByToolData = {
  // ------ REQUIRED ------
  _ott_: 'OTT',
  amount: 0,
  guildCode: 'GUILD CODE',
  toolCode: 'TOLL CODE', // 'SETTLEMENT_TOOL_SATNA' | 'SETTLEMENT_TOOL_PAYA' |'SETTLEMENT_TOOL_CARD'
  toolId: 'TOOL ID'

  // ------ OPTIONAL ------
  // firstName: 'FIRST NAME'
  // lastName: 'LAST NAME'
  // currencyCode: 'CURRENCY'
  // uniqueId: ID
  // description: 'DESCRIPTION'
};

podBillingService.requestSettlementByTool(requestSettlementByToolData)
  .then(function (result) {
    console.log('function: requestSettlementByTool ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error requestSettlementByTool ============>', error);
  });
```


## لیست تسویه‌حساب‌ها
21. listSettlements: با استفاده از این تابع می توانید لیست تسویه حساب های خود را ببینید یا در میان آن ها جست و جو کنید.

``` nodejs
let listSettlementsData = {
  // ------ REQUIRED ------
  offset: 0

  // ------ OPTIONAL ------
  // size: SIZE
  // statusCode: 'SETTLEMENT_REQUESTED' | 'SETTLEMENT_SENT' | 'SETTLEMENT_DONE'
  // currencyCode: 'CURRENCY'
  // fromAmount: 'FROM AMOUNT'
  // toAmount: 'TO AMOUNT'
  // fromDate: 'YYYY/MM/DD'
  // toDate: 'YYYY/MM/DD'
  // uniqueId: ID
};

podBillingService.listSettlements(listSettlementsData)
  .then(function (result) {
    console.log('function: listSettlements ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error listSettlements ============>', error);
  });
```


نمونه خروجی
<br>

```
{ hasError: false,
  messageId: 0,
  referenceNumber: '235007513',
  errorCode: 0,
  count: 13,
  ott: 'c32730a6480962f8',
  result:
   [ { id: 107627,
       amount: 100,
       requestDate: 1562944712133,
       customerProfileSrv: [Object],
       settleDate: 1562944717025,
       status: 'SETTLEMENT_DONE',
       currency: [Object],
       toolCode: 'SETTLEMENT_TOOL_PAYA',
       toolId: '080570100611513898506001',
       firstName: '&#x627;&#x62D;&#x633;&#x627;&#x646;',
       lastName: '&#x634;&#x6A9;&#x627;&#x631;&#x6CC;',
       referenceId: '464674555',
       settlementLogSrvs: [Object],
       wallet: 'PODLAND_WALLET',
       instant: false,
       sendToBankDate: 1562944713414 } ] }
```


## تسویه‌حساب خودکار
22. addAutoSettlement: در صورتی که تسویه خودکار برای یک کسب و کار فعال شود، مبلغ قابل تسویه آن کسب و کار به طور خودکار، یکبار در شبانه روز به شماره شبای اعلام شده در پروفایل کسب و کار یا شماره شبای اعلامی در سرویس زیر، تسویه می گردد.  با این تابع می توانید تسویه خودکار را بر روی هر کدام از حساب های صنفی خود فعال کنید.

``` nodejs
let addAutoSettlementData = {
  // ------ REQUIRED ------
  guildCode: 'GUILD CODE'

  // ------ OPTIONAL ------
  // firstName: 'FIRST NAME'
  // lastName: 'LAST NAME'
  // sheba: 'SHEBA WITHOUT IR'
  // currencyCode: 'CURRENCY'
  // instant:  true | false
};

podBillingService.addAutoSettlement(addAutoSettlementData)
  .then(function (result) {
    console.log('function: addAutoSettlement ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error addAutoSettlement ============>', error);
  });
```


نمونه خروجی
<br>

```
{ hasError: false,
  messageId: 0,
  referenceNumber: '235010223',
  errorCode: 0,
  count: 0,
  ott: 'b3f16ddae760abcf',
  result: true }
```


## حذف تسویه‌حساب خودکار
23. removeAutoSettlement: با استفاده از این تابع می توانید تسویه حساب خودکار را از روی هر کدام از حساب های صنفی غیر فعال کنید

``` nodejs
let removeAutoSettlementData = {
  // ------ REQUIRED ------
  guildCode: 'GUILD CODE'

  // ------ OPTIONAL ------
  // currencyCode: 'CURRENCY'
};

podBillingService.removeAutoSettlement(removeAutoSettlementData)
  .then(function (result) {
    console.log('function: addAutoSettlement ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error addAutoSettlement ============>', error);
  });
```


نمونه خروجی
<br>

```
{ hasError: false,
  messageId: 0,
  referenceNumber: '235012100',
  errorCode: 0,
  count: 0,
  ott: '2abe8672df8a35a6',
  result: true }
```


## گرفتن لینک پرداخت فاکتور با کیف پول
24. getPayInvoiceByWalletLink: با این تابع می توانید لینک پرداخت یک فاکتور را دریافت کنید و فاکتور را از طریق  کیف پول و یا درگاه بانکی پرداخت کنید

``` nodejs
let getPayInvoiceByWalletLinkData = {
  // ------ REQUIRED ------
  invoiceId: 0 // INVOICEID

  // ------ OPTIONAL ------
  // redirectUri: 'REDIRECT URI'
  // callUri: 'CALL URI'
};

try {
  let url = podBillingService.getPayInvoiceByWalletLink(getPayInvoiceByWalletLinkData);
  console.log('function: addAutoSettlement ============>', url, '\n');
}
catch (error) {
  console.log('error getPayInvoiceByWalletLink ============>', error);
}
```


نمونه خروجی
<br>

```
https://pay.pod.land/v1/pbc/payInvoice/?invoiceid=3526061&redirectUri=http://www.google.com/&callUri=http://www.google.com/
```


## گرفتن لینک پرداخت فاکتور
25. getPayInvoiceByUniqueNumberLink: با این تابع می توانید لینک پرداخت یک فاکتور را دریافت کنید و فاکتور را از درگاه بانکی پرداخت کنید

``` nodejs
let getPayInvoiceByUniqueNumberLinkData = {
  // ------ REQUIRED ------
  uniqueNumber: 'UNIQUE NUMBER'

  // ------ OPTIONAL ------
  // redirectUri: 'REDIRECT URI'
  // callUri: 'CALL URI'
  // gateway: 'PEP'
};

try {
  let url = podBillingService.getPayInvoiceByUniqueNumberLink(getPayInvoiceByUniqueNumberLinkData);
  console.log('function: addAutoSettlement ============>', url, '\n');
}
catch (error) {
  console.log('error getPayInvoiceByWalletLink ============>', error);
}
```


نمونه خروجی
<br>

```
https://pay.pod.land/v1/pbc/payInvoiceByUniqueNumber/?uniqueNumber=7d85b52c6b4b9b32&redirectUri=http://www.google.com/&callUri=http://www.google.com/&gateway=PEP
```


## لیست اصناف
26. guildList: با این تابع لیست اصناف را در اختیار شما قرار می دهد

``` nodejs
let guildListData = {
  // ------ REQUIRED ------

  // ------ OPTIONAL ------
  // offset: OFFSET
  // size: SIZE
};

podBillingService.guildList(guildListData)
  .then(function (result) {
    console.log('function: addAutoSettlement ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error addAutoSettlement ============>', error);
  });
```


نمونه خروجی
<br>

```
{ hasError: false,
  messageId: 0,
  referenceNumber: '235022387',
  errorCode: 0,
  count: 43,
  ott: 'b5287d57d6bbf5b3',
  result:
   [ { id: 44, name: '&#x622;&#x631;&#x627;&#x6CC;&#x634; &#x648; &#x632;&#x6CC;&#x628;&#x627;&#x6CC;&#x6CC;', code: 'TOILETRIES_GUILD' },
     { id: 45, name: '&#x628;&#x647;&#x62F;&#x627;&#x634;&#x62A; &#x648; &#x62F;&#x631;&#x645;&#x627;&#x646;', code: 'HEALTH_GUILD' } ] }
```


## افزودن کسب‌وکار واسط
27. addDealer: در صورتی که بخشی از فروش شما به کسب و کار دیگری تعلق دارد و می خواهید فاکتور به نام همان کسب و کار ثبت شود، لازم است آن کسب و کار، به کسب و کار شما اجازه صدور فاکتور به عنوان معامله گر را داده باشد. با در اختیار داشتن شناسه کسب و کار دیگر با استفاده از این تابع می توانید این اجازه را صادر کنید.

``` nodejs
let addDealerData = {
  // ------ REQUIRED ------
  dealerBizId: 0 // ID

  // ------ OPTIONAL ------
  // allProductAllow: true | false
};
podBillingService.addDealer(addDealerData)
  .then(function (result) {
    console.log('function: addDealer ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error addDealer ============>', error);
  });
```


نمونه خروجی
<br>

```
   { business:
      { id: 3605,
        name: '&#x641;&#x646;&#x627;&#x67E; &#x62A;&#x633;&#x62A; &#x645;&#x634;&#x647;&#x62F;',
        numOfProducts: 3,
        rate: [Object],
        sheba: '080570100611513898506001' },
     dealer:
      { id: 3612,
        name: '&#x6A9;&#x634;&#x62A; &#x6AF;&#x631;',
        image: 'https://core.pod.land/nzh/image?imageId=69973&hashCode=16a67f0bab0-0.2094907373026107',
        numOfProducts: 0,
        rate: [Object],
        sheba: '980570100680013557234101' },
     enable: true,
     allProductAllow: false } }
```


## لیست کسب‌وکارهای واسط
28. dealerList: برای دریافت یا جستجوی لیست تمام کسب و کارهایی که به آنها مجوز معامله و صدور فاکتور داده اید  می توانید از این تابع استفاده کنید

``` nodejs
let dealerListData = {
  // ------ REQUIRED ------

  // ------ OPTIONAL ------
  // dealerBizId: ID
  // enable: true | false
  // offset: OFFSET
  // size: SIZE
};

podBillingService.dealerList(dealerListData)
  .then(function (result) {
    console.log('function: dealerList ============>', JSON.stringify(result, null, 2), '\n');
  })
  .catch(function (error) {
    console.log('error dealerList ============>', error);
  });
```


نمونه خروجی
<br>

```
{
  "hasError": false,
  "messageId": 0,
  "referenceNumber": "235031199",
  "errorCode": 0,
  "count": 1,
  "ott": "403e86f6ae633517",
  "result": [
    {
      "business": {
        "id": 3605,
        "name": "&#x641;&#x646;&#x627;&#x67E; &#x62A;&#x633;&#x62A; &#x645;&#x634;&#x647;&#x62F;",
        "numOfProducts": 3,
        "rate": {
          "rate": 0,
          "rateCount": 0
        },
        "sheba": "080570100611513898506001"
      },
      "dealer": {
        "id": 3612,
        "name": "&#x6A9;&#x634;&#x62A; &#x6AF;&#x631;",
        "image": "https://core.pod.land/nzh/image?imageId=69973&hashCode=16a67f0bab0-0.2094907373026107",
        "numOfProducts": 0,
        "rate": {
          "rate": 0,
          "rateCount": 0
        },
        "sheba": "980570100680013557234101"
      },
      "enable": true,
      "allProductAllow": false
    }
  ]
}
```


## فعالسازی کارگزار
29. enableDealer: با استفاده از این تابع می توانید کسب کارهای واسط را فعال کنید

``` nodejs
let enableDealerData = {
  // ------ REQUIRED ------
  dealerBizId: 0 // ID

  // ------ OPTIONAL ------
};
podBillingService.enableDealer(enableDealerData)
  .then(function (result) {
    console.log('function: enableDealer ============>', JSON.stringify(result, null, 2), '\n');
  })
  .catch(function (error) {
    console.log('error enableDealer ============>', error);
  });
```


نمونه خروجی
<br>

```
{
  "hasError": false,
  "messageId": 0,
  "referenceNumber": "235035141",
  "errorCode": 0,
  "count": 0,
  "ott": "753c508ef245852a",
  "result": {
    "business": {
      "id": 3605,
      "name": "&#x641;&#x646;&#x627;&#x67E; &#x62A;&#x633;&#x62A; &#x645;&#x634;&#x647;&#x62F;",
      "numOfProducts": 3,
      "rate": {
        "rate": 0,
        "rateCount": 0
      },
      "sheba": "080570100611513898506001"
    },
    "dealer": {
      "id": 3612,
      "name": "&#x6A9;&#x634;&#x62A; &#x6AF;&#x631;",
      "image": "https://core.pod.land/nzh/image?imageId=69973&hashCode=16a67f0bab0-0.2094907373026107",
      "numOfProducts": 0,
      "rate": {
        "rate": 0,
        "rateCount": 0
      },
      "sheba": "980570100680013557234101"
    },
    "enable": true,
    "allProductAllow": false
  }
}
```


## غیرفعالسازی کسب‌وکار واسط
30. disableDealer: با استفاده از این تابع می توانید کسب کارهای واسط را غیر فعال کنید

``` nodejs
let disableDealerData = {
  // ------ REQUIRED ------
  dealerBizId: 0 // ID

  // ------ OPTIONAL ------
};
podBillingService.disableDealer(disableDealerData)
  .then(function (result) {
    console.log('function: disableDealer ============>', JSON.stringify(result, null, 2), '\n');
  })
  .catch(function (error) {
    console.log('error disableDealer ============>', error);
  });
```


نمونه خروجی
<br>

```
{
  "hasError": false,
  "messageId": 0,
  "referenceNumber": "235036062",
  "errorCode": 0,
  "count": 0,
  "ott": "135f86428674bb26",
  "result": {
    "business": {
      "id": 3605,
      "name": "&#x641;&#x646;&#x627;&#x67E; &#x62A;&#x633;&#x62A; &#x645;&#x634;&#x647;&#x62F;",
      "numOfProducts": 3,
      "rate": {
        "rate": 0,
        "rateCount": 0
      },
      "sheba": "080570100611513898506001"
    },
    "dealer": {
      "id": 3612,
      "name": "&#x6A9;&#x634;&#x62A; &#x6AF;&#x631;",
      "image": "https://core.pod.land/nzh/image?imageId=69973&hashCode=16a67f0bab0-0.2094907373026107",
      "numOfProducts": 0,
      "rate": {
        "rate": 0,
        "rateCount": 0
      },
      "sheba": "980570100680013557234101"
    },
    "enable": false,
    "allProductAllow": false
  }
}
```


## لیست کسب‌وکارهایی که واسط آن‌ها شده‌اید
31. businessDealingList: با فراخوانی سرویس ذیل می توانید لیست کسب و کارهایی که واسط آن ها شده اید را دریافت نمایید.

``` nodejs
let businessDealingListData = {
  // ------ REQUIRED ------

  // ------ OPTIONAL ------
  // dealingBusinessId: ID
  // enable: true | false
  // offset: OFFSET
  // size: SIZE
};

podBillingService.businessDealingList(businessDealingListData)
  .then(function (result) {
    console.log('function: businessDealingList ============>', JSON.stringify(result, null, 2), '\n');
  })
  .catch(function (error) {
    console.log('error businessDealingList ============>', error);
  });
```


نمونه خروجی
<br>

```
{
  "hasError": false,
  "messageId": 0,
  "referenceNumber": "235040226",
  "errorCode": 0,
  "count": 2,
  "ott": "2617cb9af8c4b908",
  "result": [
    {
      "business": {
        "id": 3612,
        "name": "&#x6A9;&#x634;&#x62A; &#x6AF;&#x631;",
        "image": "https://core.pod.land/nzh/image?imageId=69973&hashCode=16a67f0bab0-0.2094907373026107",
        "numOfProducts": 0,
        "rate": {
          "rate": 0,
          "rateCount": 0
        },
        "sheba": "980570100680013557234101"
      },
      "dealer": {
        "id": 3605,
        "name": "&#x641;&#x646;&#x627;&#x67E; &#x62A;&#x633;&#x62A; &#x645;&#x634;&#x647;&#x62F;",
        "numOfProducts": 3,
        "rate": {
          "rate": 0,
          "rateCount": 0
        },
        "sheba": "080570100611513898506001"
      },
      "enable": false,
      "allProductAllow": false
    },
    {
      "business": {
        "id": 3615,
        "name": "&#x62A;&#x633;&#x62A; &#x627;&#x646;&#x648;&#x631;&#x6CC;",
        "numOfProducts": 0,
        "rate": {
          "rate": 0,
          "rateCount": 0
        },
        "sheba": "290570100680013555510101"
      },
      "dealer": {
        "id": 3605,
        "name": "&#x641;&#x646;&#x627;&#x67E; &#x62A;&#x633;&#x62A; &#x645;&#x634;&#x647;&#x62F;",
        "numOfProducts": 3,
        "rate": {
          "rate": 0,
          "rateCount": 0
        },
        "sheba": "080570100611513898506001"
      },
      "enable": false,
      "allProductAllow": false
    }
  ]
}
```

## صدور فاکتور تسهیمی
32. issueMultiInvoice: کسب و کار معامله گر می تواند با استفاده از این تابع یک فاکتور تسهیمی ثبت نماید

``` nodejs
let issueMultiInvoiceData = {
  // ------ REQUIRED ------
  data: {
    // redirectURL: 'REDIRECT URL',
    // userId: 0, // USER ID
    // currencyCode: 'CURRENCY', // OPTIONAL
    // voucherHashs: ARRAY OF STRINGS,
    // preferredTaxRate: 0, // OPTIONAL
    // verificationNeeded: true | false, // OPTIONAL
    // preview: true | false, // OPTIONAL
    mainInvoice: {
      // billNumber: 'BILL NUMBER', // OPTIONAL
      guildCode: 'GUILD CODE',
      // metadata: OBJECT, // OPTIONAL
      // description: 'DESCRIPTION', // OPTIONAL
      invoiceItemVOs: [{
        productId: 0,
        price: 0,
        quantity: 0,
        description: 'DESCRIPTION'
      }]
    },
    subInvoices: [{
      businessId: 0, // ID
      guildCode: 'GUILD CODE',
      // billNumber: 'BILL NUMBER', // OPTIONAL
      // metadata: OBJECT, // OPTIONAL
      // description: 'DESCRIPTION', // OPTIONAL
      invoiceItemVOs: [{
        productId: 0,
        price: 0,
        quantity: 0,
        description: 'DESCRIPTION'
      }]
    }],
    // customerDescription: 'DESCRIPTION', // OPTIONAL
    // customerMetadata: OBJECT, // OPTIONAL
    customerInvoiceItemVOs: [{
      productId: 0,
      price: 0,
      quantity: 0,
      description: 'DESCRIPTION'
    }]
  }

  // ------ OPTIONAL ------
  // delegatorId: ARRAY OF INTEGERS
  // delegationHash: ARRAY OF STRING
  // forceDelegation: 'FORCE DELIGATION'
};

podBillingService.issueMultiInvoice(issueMultiInvoiceData)
  .then(function (result) {
    console.log('function: issueMultiInvoice ============>', JSON.stringify(result, null, 2), '\n');
  })
  .catch(function (error) {
    console.log('error issueMultiInvoice ============>', error);
  });
```


نمونه خروجی
<br>

```
{
  "hasError": false,
  "messageId": 0,
  "referenceNumber": "235044247",
  "errorCode": 0,
  "count": 0,
  "ott": "2889093d560c9894",
  "result": {
    "id": 3526913,
    "totalAmountWithoutDiscount": 0,
    "delegationAmount": 0,
    "totalAmount": 0,
    "payableAmount": 0,
    "vat": 0,
    "issuanceDate": 1563115794187,
    "deliveryDate": 0,
    "paymentBillNumber": "6047257",
    "uniqueNumber": "c176e2f840842d3a",
    "paymentDate": 0,
    "payed": false,
    "serial": 0,
    "canceled": false,
    "cancelDate": 0,
    "business": {
      "id": 3605,
      "name": "&#x641;&#x646;&#x627;&#x67E; &#x62A;&#x633;&#x62A; &#x645;&#x634;&#x647;&#x62F;",
      "numOfProducts": 3,
      "rate": {
        "rate": 0,
        "rateCount": 0
      },
      "sheba": "080570100611513898506001"
    },
    "invoiceItemSrvs": [
      {
        "id": 3564753,
        "amount": 0,
        "description": "ss",
        "quantity": 0,
        "voucherUsageSrvs": []
      }
    ],
    "guildSrv": {
      "id": 47,
      "name": "&#x641;&#x646;&#x627;&#x648;&#x631;&#x6CC; &#x627;&#x637;&#x644;&#x627;&#x639;&#x627;&#x62A;",
      "code": "INFORMATION_TECHNOLOGY_GUILD"
    },
    "closed": false,
    "verificationNeeded": false,
    "customerInvoice": {
      "id": 3526912,
      "totalAmountWithoutDiscount": 1100,
      "delegationAmount": 0,
      "totalAmount": 1100,
      "payableAmount": 1199,
      "vat": 99,
      "issuanceDate": 1563115794186,
      "deliveryDate": 0,
      "paymentBillNumber": "6047257",
      "uniqueNumber": "1963cf87a2de34d3",
      "paymentDate": 0,
      "payed": false,
      "serial": 0,
      "canceled": false,
      "cancelDate": 0,
      "business": {
        "id": 3605,
        "name": "&#x641;&#x646;&#x627;&#x67E; &#x62A;&#x633;&#x62A; &#x645;&#x634;&#x647;&#x62F;",
        "numOfProducts": 3,
        "rate": {
          "rate": 0,
          "rateCount": 0
        },
        "sheba": "080570100611513898506001"
      },
      "invoiceItemSrvs": [
        {
          "id": 3564752,
          "amount": 110,
          "description": "Hello",
          "quantity": 10,
          "voucherUsageSrvs": []
        }
      ],
      "guildSrv": {
        "id": 47,
        "name": "&#x641;&#x646;&#x627;&#x648;&#x631;&#x6CC; &#x627;&#x637;&#x644;&#x627;&#x639;&#x627;&#x62A;",
        "code": "INFORMATION_TECHNOLOGY_GUILD"
      },
      "closed": false,
      "verificationNeeded": false,
      "safe": false,
      "postVoucherEnabled": false,
      "referenceNumber": "235044247",
      "issuerSrv": {
        "id": 1454449,
        "name": "&#x627;&#x62D;&#x633;&#x627;&#x646; &#x634;&#x6A9;&#x627;&#x631;&#x6CC;",
        "ssoId": "6254762",
        "ssoIssuerCode": 1,
        "profileImage": "https://core.pod.land:443/nzh/image/?imageId=69962&width=498&height=498&hashCode=16a679c6ad9-0.3413974672033351"
      },
      "willBeBlocked": false,
      "willBePaid": false,
      "edited": false,
      "waiting": false,
      "subInvoice": false
    },
    "subInvoices": [
      {
        "id": 3526914,
        "totalAmountWithoutDiscount": 1100,
        "delegationAmount": 0,
        "totalAmount": 1100,
        "payableAmount": 1199,
        "vat": 99,
        "issuanceDate": 1563115794188,
        "deliveryDate": 0,
        "paymentBillNumber": "6047257",
        "uniqueNumber": "34a30224cfc63c2d",
        "paymentDate": 0,
        "payed": false,
        "serial": 0,
        "canceled": false,
        "cancelDate": 0,
        "business": {
          "id": 3605,
          "name": "&#x641;&#x646;&#x627;&#x67E; &#x62A;&#x633;&#x62A; &#x645;&#x634;&#x647;&#x62F;",
          "numOfProducts": 3,
          "rate": {
            "rate": 0,
            "rateCount": 0
          },
          "sheba": "080570100611513898506001"
        },
        "invoiceItemSrvs": [
          {
            "id": 3564754,
            "amount": 110,
            "description": "Hello",
            "quantity": 10,
            "voucherUsageSrvs": []
          }
        ],
        "guildSrv": {
          "id": 47,
          "name": "&#x641;&#x646;&#x627;&#x648;&#x631;&#x6CC; &#x627;&#x637;&#x644;&#x627;&#x639;&#x627;&#x62A;",
          "code": "INFORMATION_TECHNOLOGY_GUILD"
        },
        "closed": false,
        "verificationNeeded": false,
        "safe": false,
        "postVoucherEnabled": false,
        "referenceNumber": "235044247",
        "issuerSrv": {
          "id": 1454449,
          "name": "&#x627;&#x62D;&#x633;&#x627;&#x646; &#x634;&#x6A9;&#x627;&#x631;&#x6CC;",
          "ssoId": "6254762",
          "ssoI
```

<div class="tab-end">
</div>

