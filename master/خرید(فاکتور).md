- [خرید در یک نگاه](#menu)
- [صدور فاکتور](#menu)
- [نمایش پیش فاکتور](#menu)
- [لیست فاکتورها](#menu)
- [جستجو در متادیتا فاکتورها](#menu)
- [تایید پرداخت فاکتور](#menu)
- [بستن فاکتور](#menu)
- [تایید و بستن فاکتور در یک مرحله](#menu)
- [ابطال فاکتور](#menu)
- [کاهش فاکتور](#menu)
- [دریافت فایل لیست فاکتورها](#menu)
- [دریافت فایل خروجی فاکتورها](#menu)
- [دریافت وضعیت خروجی فاکتورها](#menu)
- [خرید امن](#menu)
- [لینک‌های مرتبط](#menu)


## خرید در یک نگاه

**تمام امکانات عملیات خرید در پکیج billing قرار دارد.برای اطلاعات بیشتر به [پکیج سرویس‌ها](/documents/packages/) مراجعه کنید**

خرید فعالیتی است که مشتری، محصول یا خدماتی را که توسط کسب‌و‌کاری ارائه شده است را جستجو و در ازای پرداخت هزینه استفاده می‌کند. در خرید آنلاین، فرآیند جستجو، تعامل فروشنده و مشتری، پرداخت و رهگیری در بستر شبکه اینترنت انجام می‌شود. مراحل خرید پس از انتخاب محصول توسط مشتری تا اتمام فرآیند توسط فروشنده به طور اجمالی شامل این مراحل است.

<div class="mermaid">
graph TD  
A((شروع))  
A-.->B  
B(صدور فاکتور)-.->C  
C(پرداخت)-.->D  
D(استعلام پرداخت)-.->E  
E{عملیات فاکتور} 
E-.->F  
E-.->G  
E-.->H   
F(ابطال فاکتور)-.->I
G(کاهش فاکتور)-.->I
H(بستن فاکتور)-.->I
I(تسویه حساب)-.->K
K((پایان))
</div>


<div class="box-end">
</div>

## صدور فاکتور

هرگونه پرداخت در پلتفرم پاد، از طریق فاکتور صورت می گیرد. در این بخش صدور فاکتور با استفاده از توکن کسب و کار شرح داده شده و می توان با خروجی حاصل از این متد، کاربر را به راحتی به درگاه پرداخت هدایت نمود. برای صدور فاکتور از سرویس issueInvoice استفاده نمایید.

<br/>
  
مقدار api_token (توکن کسب و کار) را از پنل مدیریت کسب و کار دریافت نمایید.

#### نکته

- اگر محصولی که برای آن فاکتور ثبت می کنید در سیستم ثبت شده نیست، ProductId را با مقدار صفر وارد نمایید.
- برای بدست آوردن لیست اصناف می توانید از سرویس guildList استفاده نمایید.
- اکثر عملیات مربوط به فاکتور نیاز به ott دارند که میتوانید آن را از آخرین درخواست به پلتفرم یا از طریق سرویس دریافت نمایید. فقط دقت نمایید که توکنی که با آن ott می گیرید با توکنی که در درخواست بعدی باید استفاده شود، یکی باشد.
- توجه داشته باشید مقدار ott از api_token متفاوت است، مقدار ott را میتوانید از تابع issueInvoice هم دریافت نمایید و مجددا در سرویس صدور فاکتور فراخوانی نمایید.

<br/>
فاکتورهایی که در این حالت صادر می شوند، عادی هستند و پس از پرداخت توسط مشتری، اعتبار کسب و کار افزایش می یابد. با دریافت لیست فاکتورها می توانید وضعیت آنها را مشاهده نمایید. 

<br/>
  
در هنگام فراخوانی سرویس صدور فاکتور، ممکن است با خطاهایی مواجه شوید که در مستند ذیل به رایج ترین آن ها اشاره شده است:

<br/>

| errorCode  |                         دلیل خطا  |    شرح   | 
|----------------|-------------------------------|-----------------------------|
|10          | INVALID_DATE                      |ارسال فرمت اشتباه تاریخ در پارامتر deadLine        |
|19          |DUPLICATE_BILLNUMBER               |  شماره صورتحساب تکراری می باشد.     |
|21          |  client not authenticated         |ارسال اشتباه مقدار توکن|
|25          |  DUPLICATE_CANCELED_BILLNUMBER    | اگر شماره قبض لحاظ شده، متعلق به فاکتور کنسل شده ای با همین شماره قبض باشد، این خطا را دریافت خواهید نمود.|
|37          |  INVALID_ELEMENT_CODE             |کد صنف با فرمت صحیح موجود در پنل مدیریت کسب و کار، وارد نشده است.|
|39          |  PERMISSION_ACCESS_DENIED         | در صورت عدم ارسال پارامتر ott با این خطا رو به رو می شوید. به منظور بازنشانی کردن ott ، سرویس دریافت توکن یکبار مصرف فراخوانی نمایید.|
|53          |  INVALID_BUSINESS_GUILD           |  اگر صنف انتخابی در پنل کسب و کار نباشد این خطا را دریافت خواهید نمود. ابتدا باید آن صنف را از پنل مدیریت کسب و کار، اضافه نمایید. |
|56          |  INVALID_GUILD_AMOUNT             |پارامتر کد صنف به درستی ارسال نشده است. |
|66          |  INVOICE_SAME_BIZ_AND_CUSTOMER    | اگر توکن(_token_) و شناسه ی کاربر(userId) ای که استفاده می نمایید متعلق به یک کسب و کار باشد، این خطا را دریافت می کنید. چرا که صدور فاکتور از کسب و کار خودتان برای خودتان امکان پذیر نیست. <br/> به مستند افزودن کسب و کار واسط مراجعه نمایید. کسب و کار جدیدی ثبت نمایید، و به این کسب وکار مجوز صدور فاکتور برای یک محصول خاص(ارجاع به مستند مجوز فروش محصول)، اعطا نمایید و سپس نسبت به صدور فاکتور اقدام نمایید.|
|999         |  UNKNOWN                          | خطای داخلی|



<div class="tab-start">
</div>

# [C#](#tab/csharp)

``` csharp
try
    {
        var internalServiceCallVo = InternalServiceCallVo.ConcreteBuilder
            .SetToken("{Put your ApiToken}")
            //.SetScVoucherHash({Put your VoucherHash})
            //.SetScApiKey("{Put your ApiKey}")
            .Build();
            var output = new ResultSrv<InvoiceSrv>();
            var invoiceSrv = IssueInvoiceVo.ConcreteBuilder
                                .SetServiceCallParameters(internalServiceCallVo)
                                .SetGuildCode("{put your guildCode}")
                                .SetProductsInfo(new List<ProductInfo>
                                {                         
                           ProductInfo.ConcreteBuilder.SetProductId(0).SetPrice(1000).SetQuantity(3).SetProductDescription("tst1").Build(),                         
                            ProductInfo.ConcreteBuilder.SetProductId(0).SetPrice(1000).SetQuantity(3).SetProductDescription("tst1").Build()
                                })
                                .SetOtt("{Put your ott}")
                                //.SetPreview({put your preview})
                                //.SetMetadata("{put your metadata}")
                                //.SetUserId({put user id})
                                //.SetAddressId("{put your addressId}")
                                .Build(); // Create new instance 
             BillingService.IssueInvoice(invoiceSrv, response => Listener.GetResult(response, out output));
    }
catch (PodException podException)
    {
        Console.WriteLine($"-- {podException.Code}-an error has occured : 
                              {Environment.NewLine{podException.Message}");
        throw;
    }
catch (Exception exception)
    {
        Console.WriteLine(exception.Message);
        throw;
    }
```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/issueInvoice</div>

# [Java](#tab/java)

``` java
//List<String> scVoucherHashs =new ArrayList<>();
//scVoucherHashs.add("RFSFGDYEDYGS");
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                .setOtt(OTT)
                //.setScApiKey("SDFJKSHFJwshfJshfDJH")
                //.setScVoucherHash(scVoucherHashs)
                .build();

BillingService billingService = new BillingService();

List<ProductInfo> productInfos = new ArrayList<>();
ProductInfo productInfo = new ProductInfo();
productInfo
        .setProductId(0L)
        .setPrice(new BigDecimal(1))
        .setQuantity(new BigDecimal(1))
        .setProductDescription("test");
productInfos.add(productInfo);

try {
    IssueInvoiceVo issueInvoiceVo = new IssueInvoiceVo.Builder(baseInfoVo)
            .setProductInfos(productInfos)
            .setUserId(123L)
            .setGuildCode(SAMPLE_GUILD_CODE)
            .build();
    billingService.issueInvoice(issueInvoiceVo, new OnGetResponseListener<InvoiceSrv>() {
        @Override
        public void onResponse(ResultVo<InvoiceSrv> result) {
            System.out.println(result.getResult().getId());
        }

        @Override
        public void onFailed(PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
    });
} catch (PodException e) {
    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
}

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/issueInvoice</div>

# [PHP](#tab/php)

``` php
$param =
        [
            ## =================== *Required Parameters  ===============
            'productList'       => [
                [
                    'productId'         => '{put product id}',
                    'price'             => '{put product price, type: decimal}',
                    'quantity'          => '{put product price, type: integer}',
                    'productDescription'=> '{put description}',
                ],
                // اطلاعات محصولات دیگر
            ],
            'guildCode'         => '{put guild code}', # *Required
            'ott'               => '{put ott}',
            ## ==================== Optional Parameters  ====================
            'redirectURL'       => '{put redirect uri}',
            'userId'            => '{put user id}',
            'billNumber'        => '{put bill number}',
            'description'       => '{put description}',
            'deadline'          => 'yyyy/mm/dd',
            'currencyCode'      => '{put currency code like IRR}',  # default : IRR
            'addressId'         => '{put address id of customer}',
            'voucherHash'       => [],
            'preferredTaxRate'  => '{put tax, default 0.09}',
            'verificationNeeded'=> '{true/false}',
            'verifyAfterTimeout'=> '{true/false}',
            'preview'           => '{true/false}',
            'safe'              => '{true/false}',
            'postVoucherEnabled'=> '{true/false}',
            'hasEvent'          => '{true/false}',
            'eventTitle'        => '{put event title}',
            'eventTimeZone'     => '{put event time zone}',
            'eventDescription'  => '{put event description}',
            "metadata"          => '{put json format like {"name":"test"}}',
            'eventMetadata'     => [],
            'eventReminders'    => [],
            'scVoucherHash'     => ['{Put Service Call Voucher Hashes}'],
            'scApiKey'           => '{Put service call Api Key}',
        ];

    try {
        $result = $BillingService->issueInvoice($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/issueInvoice</div>

# [Nodejs](#tab/nodejs)

``` javascript
let issueInvoiceData = {
  // ------ REQUIRED ------
  ott: 'OTT',
  productList: [
    { productId: 0, price: 0, quantity: 0, productDescription: 'DESCRIPTION' },
    { productId: 0, price: 0, quantity: 0, productDescription: 'DESCRIPTION' }
  ],
  guildCode: 'GUILD CODE'

  // ------ OPTIONAL ------
  // redirectURL: 'REDIRECT URL'
  // userId: USER ID
  // billNumber: 'BILL NUMBER'
  // description: 'DESCRIPTION'
  // deadline: 'DEADLINE'
  // currencyCode: 'CURRENCY CODE'
  // addressId: 0
  // voucherHash: 'VOUCHER HASH'
  // preferredTaxRate: 0
  // verificationNeeded: true | false
  // verifyAfterTimeout: true | false
  // preview: true | false
  // metadata: OBJECT
  // safe: true | false
  // postVoucherEnabled: 'POST VOUCHER ENABLED'
  // hasEvent: 'HAS EVENT'
  // eventTitle: 'EVENT TITLE'
  // eventTimeZone: 'TIME ZONE'
  // eventReminders: [{},{}] // Array of objects
  // eventDescription: 'DESCRIPTION'
  // eventMetadat: OBJECT
  // scVoucherHash: ['HASH#1', 'HASH#2']
  // token: 'API TOKEN'
  // tokenIssuer: 0 | 1
  // scApiKey: ' SC API KEY'
};
podBilling.issueInvoice(issueInvoiceData)
  .then(function (result) {
    console.log('function: issueInvoice ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error issueInvoice ============>', error);
  });


```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/issueInvoice</div>

<div class="tab-end">
</div>


<div class="box-end">
</div>


## نمایش پیش فاکتور

در پلتفرم کسب و کار، فاکتورهایی که پرداخت می شوند به صورت سالانه شماره سریال دریافت می نمایند، بنابرین کسب و کار می تواند برای امور مالی خود به آن شماره سریال استناد نماید. در برخی شرایط، ممکن است کسب و کار بخواهد فاکتور تا زمانی که اقدام به پرداخت آن نشده اصلاً ثبت نگردد. بدین منظور با استفاده از سرویس createPreInvoice می تواند پیش فاکتور را ثبت نماید. به محض اینکه مشتری، فاکتور را با کیف پول خود پرداخت نماید یا برای پرداخت وارد درگاه بانکی شود، فاکتور ثبت می گردد. در صورتی که مشتری پرداخت را از طریق درگاه لغو نماید یا اشکالی در پرداخت او به وجود آید، فاکتور به صورت خودکار لغو خواهد شد.

<br/>
پارامترهای ارسالی در این درخواست و کارکرد آنها مشابه پارامترهای صدور فاکتور هستند. بنابرین در صورت نیاز میتوانید با مراجعه به بخش صدور فاکتور اطلاعات بیشتری کسب نمایید.

<br/>
در پاسخ این سرویس کد hash به شما برگشت داده می شود که شما باید کاربر را به آدرس زیر هدایت کنید


``` javascript'
https://pay.pod.ir/v1/pbc/preinvoice/{HASH}

```


<div class="tab-start">
</div>

# [C#](#tab/csharp)

``` csharp
try
    {
        var internalServiceCallVo = InternalServiceCallVo.ConcreteBuilder
            .SetToken("{Put your ApiToken}")
            //.SetScVoucherHash({Put your VoucherHash})
            //.SetScApiKey("{Put your ApiKey}")
            .Build();
            var output = new ResultSrv<ServiceCallResultSrv<PrivateCallSrv>>();
            var ottOutput = GetOtt();
            var createPreInvoiceVo = CreatePreInvoiceVo.ConcreteBuilder
                                .SetServiceCallParameters(internalServiceCallVo)
                                .SetOtt(ottOutput.Ott)
                                .SetProductsInfo(new List<ProductInfo>
                                {
                                    ProductInfo.ConcreteBuilder.SetProductId({Put your ProductId}).SetPrice({Put your Price}).SetQuantity({Put your Quantity}).SetProductDescription("{Put your ProductDescription}").Build(),
                                    ProductInfo.ConcreteBuilder.SetProductId({Put your ProductId}).SetPrice({Put your Price}).SetQuantity({Put your Quantity}).SetProductDescription("{Put your ProductDescription}").Build()
                                })
                                .SetGuildCode("{Put your GuildCode}")
                                .SetRedirectUri("{Put your RedirectUri}")
                                .SetUserId({Put your UserId})
                                //.SetBillNumber("{Put your BillNumber}")
                                //.SetCallUrl("{Put your CallUrl}")
                                //.SetCurrencyCode("{Put your CurrencyCode}")
                                //.SetDeadline("{Put your Deadline}")
                                //.SetDescription("{Put your Description}")
                                //.SetPreferredTaxRate({Put your PreferredTaxRate})
                                //.SetRedirectUri("{Put your RedirectUri}")
                                //.SetVerificationNeeded({Put your VerificationNeeded})
                                .Build();
            BillingService.CreatePreInvoice(createPreInvoiceVo,response => Listener.GetResult(response, out output));
            var linkSrv = createPreInvoiceVo.GetLink(output.Result);

    }
catch (PodException podException)
    {
        Console.WriteLine($"-- {podException.Code}-an error has occured : 
                              {Environment.NewLine{podException.Message}");
        throw;
    }
catch (Exception exception)
    {
        Console.WriteLine(exception.Message);
        throw;
    }
```

# [Java](#tab/java)

``` java
//        List<String> scVoucherHashs =new ArrayList<>();
//        scVoucherHashs.add("RFSFGDYEDYGS");
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                .setOtt(OTT)
//                .setScApiKey("SDFJKSHFJwshfJshfDJH")
//                .setScVoucherHash(scVoucherHashs)
                .build();

        BillingService billingService = new BillingService();




        List<ProductInfo> productInfos = new ArrayList<>();
        ProductInfo productInfo = new ProductInfo();
        productInfo
                .setProductId(0L)
                .setPrice(new BigDecimal(1))
                .setQuantity(new BigDecimal(1))
                .setProductDescription("test");
        productInfos.add(productInfo);

        try {
            CreatePreInvoiceVo createPreInvoiceVo = new CreatePreInvoiceVo.Builder(baseInfoVo)
                    .setRedirectURL(RIDERECT_URI)
                    .setUserId(513304L)
                    .setProductInfos(productInfos)
                    .setGuildCode(SAMPLE_GUILD_CODE)
                    .build();

            billingService.createPreInvoice(createPreInvoiceVo, new OnGetResponseListener<String>() {
                @Override
                public void onResponse(ResultVo<String> result) {
                    System.out.println(result.getResult());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }

```

# [PHP](#tab/php)

``` php
$param = [
        ## ============================ *Required Parameters  =========================
        'ott'         => 'Put ott', 
        'productList'   => [
            [
                'productId'         => '{put product id}',
                'price'             => '{put product price, type: decimal}',
                'quantity'          => '{put product price, type: integer}',
                'productDescription'=> '{put description}',
            ],
            //اطلاعات محصولات دیگر
        ],
        'guildCode'                 => '{put guild code}', 
        'redirectUri'               => '{put redirect uri}',
        'userId'               => '{put customer user id}', 
        ## =========================== Optional Parameters  ===========================
        # 'billNumber'=> '{put bill numer}',
        # 'redirectUri' => '{put redrect uri}',
        #'callUrl'=>  '{put call uri}', 
        # 'preferredTaxRate' => 'vat; default 0.09', 
        # 'verificationNeeded' => '{true/false}', 
        # 'currencyCode'=> '{put currency code}',
        #  'description' => '{put description}',
        # 'deadline' => 'yyyy/mm/dd', 
        'scVoucherHash'     => ['{Put Service Call Voucher Hashes}'],
        'scApiKey'           => '{Put service call Api Key}',
    ];
    try {
        $result = $BillingService->createPreInvoice($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }

```

# [Nodejs](#tab/nodejs)

``` javascript
let createPreInvoiceData = {
  // ------ REQUIRED ------
  ott: 'OTT',
  productList: [
    { productId: 0, price: 0, quantity: 0, productDescription: 'My first product!' },
    { productId: 0, price: 0, quantity: 0, productDescription: 'My Second Product!' }
  ],
  guildCode: 'GUILD CODE',
  redirectURL: 'REDIRECT URL',
  userId: 0

  // ------ OPTIONAL ------
  // callUrl: 'CALL URL'
  // billNumber: 'BILL NUMBER'
  // description: 'DESCRIPTION'
  // deadline: 'DEADLINE'
  // currencyCode: 'CURRENCY CODE'
  // addressId: 0
  // preferredTaxRate: 0
  // verificationNeeded: true | false
  // scVoucherHash: ['HASH#1', 'HASH#2']
  // token: 'API TOKEN'
  // tokenIssuer: 0 | 1
  // scApiKey: ' SC API KEY'
};
podBilling.createPreInvoice(createPreInvoiceData)
  .then(function (result) {
    console.log('function: createPreInvoice ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error createPreInvoice ============>', error);
  });

```

<div class="tab-end">
</div>




<div class="box-end">
</div>


## لیست فاکتورها

برای مشاهده فاکتورهایی که کسب و کار شما صادر نموده و وضعیت آنها می توانید به پنل مدیریت کسب و کار خود به آدرس https://panel.pod.ir مراجعه نمایید و از منوی « مالی ، فاکتورها » آنها را مشاهده نمایید. این قسمت امکان فیلتر یا جستجو در شرح فاکتورها را نیز دارد.

<br/>

همچنین می توانید برای استفاده در برنامه خود، از API زیر استفاده نمایید.


#### نکته

در صورتی که بخواهید وضعیت پرداخت یک فاکتور (استعلام پرداخت) را بررسی کنید، تنها کافیست تا پارامتر id را برابر با شناسه فاکتور مورد نظر قرار دهید.


<div class="tab-start">
</div>

# [C#](#tab/csharp)

``` csharp
try
    {
        var internalServiceCallVo = InternalServiceCallVo.ConcreteBuilder
            .SetToken("{Put your ApiToken}")
            //.SetScVoucherHash({Put your VoucherHash})
            //.SetScApiKey("{Put your ApiKey}")
            .Build();
            var output = new ResultSrv<List<InvoiceSrv>>();
            var getInvoiceListVo = GetInvoiceListVo.ConcreteBuilder
                                .SetServiceCallParameters(internalServiceCallVo)
                                .SetSize({Put your size})
                                .SetOffset({Put your offset})
                                //.SetGuildCode("{put your guildCode}")
                                .Build();
            BillingService.GetInvoiceList(getInvoiceListVo, response => Listener.GetResult(response, out output));
    }
    catch (PodException podException)
    {
        Console.WriteLine($"-- {podException.Code}-an error has occured : 
                              {Environment.NewLine{podException.Message}");
        throw;
    }
catch (Exception exception)
    {
        Console.WriteLine(exception.Message);
        throw;
    }
```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getInvoiceList/</div>

# [Java](#tab/java)

``` java
//List<String> scVoucherHashs =new ArrayList<>();
//scVoucherHashs.add("RFSFGDYEDYGS");

BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                //.setScApiKey("SDFJKSHFJwshfJshfDJH")
                //.setScVoucherHash(scVoucherHashs)
                .build();

BillingService billingService = new BillingService();

try {
    GetInvoiceListVo getInvoiceListVo = new GetInvoiceListVo.Builder(baseInfoVo)
            .setOffset(0L)
            .setSize(10L)
            .build();
    billingService.getInvoiceList(getInvoiceListVo, new OnGetResponseListener<List<InvoiceSrv>>() {
        @Override
        public void onResponse(ResultVo<List<InvoiceSrv>> result) {
            System.out.println(result.getResult().get(0).getId());
        }

        @Override
        public void onFailed(PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
    });
} catch (PodException e) {
    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
}

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getInvoiceList/</div>

# [PHP](#tab/php)

``` php
$param =
        [
            ## ======================== *Required Parameters one of  ===================
            # یکی از این سه فیلد ضروری است
            'offset' => '{put offset}', 
            'firstId' => 'put first id', 
            'lastId' => 'put last id',
            ## ======================== Optional Parameters  ===========================
            'size' => '{put size}',
            'guildCode' => 'put guild code', 
            'id' => 'put invoice id',
            'billNumber' => 'put bill number', 
            'uniqueNumber' => 'put unique number', 
            'trackerId' => 'put tracker id',
            'fromDate' => 'yyyy/mm/dd hh:mi:ss', 
            'toDate' => 'yyyy/mm/dd hh:mi:ss',            
            'isCanceled' => 'true/false',
            'isPayed' => 'true',
            'isClosed' => 'true/false',
            'isWaiting' => 'true/false',
            'referenceNumber' => 'put reference number',  
            'userId' => 'put user id', 
            'issuerId' => 'put issuer id', 
            'query' => 'put search query', 
            'productIdList' => [], 
            'scVoucherHash'     => ['{Put Service Call Voucher Hashes}'],
            'scApiKey'           => '{Put service call Api Key}',
        ];
    try {
        $result = $BillingService->getInvoiceList($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getInvoiceList/</div>

# [Nodejs](#tab/nodejs)

``` javascript
let getInvoiceListData = {
  // ------ REQUIRED ------
  offset: 0

  // ------ OPTIONAL ------
  // size: 1
  // id: 0
  // billNumber: 'BILL NUMBER'
  // uniqueNumber: 'UNIQUE NUMBER'
  // trackerId: 0
  // fromDate: 'FROM DATE'
  // toDate: 'TO DATE'
  // isCanceled: true | false
  // isPayed: true | false
  // isClosed: true | false
  // isWaiting: true | false
  // guildCode: 'GUILD CODE'
  // referenceNumber: 'REFERENCE NUMBER'
  // userId: ID
  // issuerId: ID
  // query: 'QUERY'
  // firstId: ID
  // lastId: ID
  // productIdList: ARRAY OF INTEGERS
  // scVoucherHash: ['HASH#1', 'HASH#2']
  // token: 'API TOKEN'
  // tokenIssuer: 0 | 1
  // scApiKey: ' SC API KEY'
};

podBillingService.getInvoiceList(getInvoiceListData)
  .then(function (result) {
    console.log('function: getInvoiceList ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error getInvoiceList ============>', error);
  });


```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getInvoiceList/</div>

<div class="tab-end">
</div>





<div class="box-end">
</div>



## جستجو در متادیتا فاکتورها

برای مشاهده فاکتورهایی که کسب و کار شما صادر نموده و وضعیت آنها می توانید به پنل مدیریت کسب و کار خود به آدرسهمچنین برای جستجو در متادیتای ثبت شده برای فاکتور می توانید از سرویس زیر استفاده نمایید

<br/>

در قسمت metaQuery مقادیر درخواستی خود را به فرم json با استفاده از توصیحات جستجوی متادیتا ارسال نمایید.


<div class="tab-start">
</div>

# [C#](#tab/csharp)

``` csharp
try
    {
        var internalServiceCallVo = InternalServiceCallVo.ConcreteBuilder
            .SetToken("{Put your ApiToken}")
            //.SetScVoucherHash({Put your VoucherHash})
            //.SetScApiKey("{Put your ApiKey}")
            .Build();
            var output = new ResultSrv<List<InvoiceSrv>>();
            var getInvoiceListByMetadataVo = GetInvoiceListByMetadataVo.ConcreteBuilder
                                .SetServiceCallParameters(internalServiceCallVo)
                                .SetMetaQuery("{Put your metaQuery}")
                                //.SetSize({Put your size})
                                //.SetOffset({Put your offset})
                                //.SetIsCanceled({put your value})
                                //.SetIsPayed({put your value})
                                .Build();
            BillingService.GetInvoiceListByMetadata(getInvoiceListByMetadataVo, response => Listener.GetResult(response, out output));
    }
    catch (PodException podException)
    {
        Console.WriteLine($"-- {podException.Code}-an error has occured : 
                              {Environment.NewLine{podException.Message}");
        throw;
    }
catch (Exception exception)
    {
        Console.WriteLine(exception.Message);
        throw;
    }
```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getInvoiceListByMetadata/</div>

# [Java](#tab/java)

``` java
//List<String> scVoucherHashs =new ArrayList<>();
//scVoucherHashs.add("RFSFGDYEDYGS");
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
                //.setScApiKey("SDFJKSHFJwshfJshfDJH")
                //.setScVoucherHash(scVoucherHashs)
                .build();

BillingService billingService = new BillingService();

try {
    GetInvoiceListByMetadataVo getInvoiceListByMetadataVo = new GetInvoiceListByMetadataVo.Builder(baseInfoVo) 

.build();
    billingService.getInvoiceListByMetadata(getInvoiceListByMetadataVo,
            new OnGetResponseListener<List<InvoiceSrv>>() {
                @Override
                public void onResponse(ResultVo<List<InvoiceSrv>> result) {
                    System.out.println(result.getResult().size());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
} catch (PodException e) {
    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
}

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getInvoiceListByMetadata/</div>

# [PHP](#tab/php)

``` php
$param =
        [
           ## ============================ *Required Parameters  =========================
            'metaQuery' =>  ['key'=>'value'],
            ## =========================== Optional Parameters  ===========================
            'offset' => '{put offset}',
            'size' => '{put size}',
            'isPayed' => 'true/false',      # true/false
            'isCanceled' => 'true/false',   # true/false
            'scVoucherHash'     => ['{Put Service Call Voucher Hashes}'],
            'scApiKey'           => '{Put service call Api Key}',
        ];

    try {
        $result = $BillingService->getInvoiceListByMetadata($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getInvoiceListByMetadata/</div>

# [Nodejs](#tab/nodejs)

``` javascript
let getInvoiceListByMetadataData = {
  // ------ REQUIRED ------
  metaQuery: OBJECT

  // ------ OPTIONAL ------
  // offset: OFFSET
  // size: SIZE
  // isPayed: true | false
  // isCancelled: true | false
  // scVoucherHash: ['HASH#1', 'HASH#2']
  // token: 'API TOKEN'
  // tokenIssuer: 0 | 1
  // scApiKey: ' SC API KEY'
};

podBillingService.getInvoiceListByMetadata(getInvoiceListByMetadataData)
  .then(function (result) {
    console.log('function: getInvoiceListByMetadata ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error getInvoiceListByMetadata ============>', error);
  });


```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getInvoiceListByMetadata/</div>

<div class="tab-end">
</div>




<div class="box-end">
</div>


## تایید پرداخت فاکتور

در صورتی که در صدور فاکتور پارامتر verificationNeeded را با مقدار true ارسال نموده باشید، پرداخت سه مرحله ای فعال شده است. به این معنی که پس از هدایت کاربر به صفحه پرداخت(فقط در صورت پرداخت فاکتور از طریق اتصال به درگاه می توانید سرویس تایید فاکتور را صدا بزنید) و دریافت پاسخ در redirectUri لازم است پرداخت توسط کسب و کار با استفاده از سرویس verifyInvoice تایید شود.
بدین ترتیب در صورتی که در فرایند پرداخت اشکالی به وجود بیاید یا به علت قطعی شبکه، عملیات به redirectUri منتقل نشود، کسب و کار نباید پرداخت را تایید نماید و اگر مبلغی توسط مشتری پرداخت شده باشد، ظرف مدت یک ساعت به حساب کیف پول او برگشت زده خواهد شد. در طول این یک ساعت، فاکتور با وضعیت «در انتظار تایید» در پنل مدیریت کسب و کار قابل مشاهده است.


<div class="mermaid">
graph TD  
A((شروع))  
A-.->B  
B(صدور فاکتور با حالت  سه مرحله ای)-.->C  
C(پرداخت از طریق درگاه)-.->E  
E{پرداخت توسط کسب و کار تایید می شود} 
E-- خیر ---F 
F( برگشت پول به مشتری در صورت کسر از حساب مشتری)
E-- بله ---G 
G(استعلام پرداخت)-.->I
I{عملیات فاکتور}
I-.->H  
H(ابطال فاکتور)-.->L
I-.->J  
J(کاهش فاکتور)-.->L
I-.->K  
K(بستن فاکتور)-.->L
L(تسویه حساب)-.->M
M((پایان))
</div>


<div class="tab-start">
</div>

# [C#](#tab/csharp)

``` csharp
try
    {
        var internalServiceCallVo = InternalServiceCallVo.ConcreteBuilder
            .SetToken("{Put your ApiToken}")
            //.SetScVoucherHash({Put your VoucherHash})
            //.SetScApiKey("{Put your ApiKey}")
            .Build();
           var output = new ResultSrv<InvoiceSrv>();
           var verifyInvoiceVo = VerifyInvoiceVo.ConcreteBuilder
                               .SetServiceCallParameters(internalServiceCallVo)
                               .SetId({put your id})
                               //.SetBillNumber("{put your billNumber}")
                               .Build();
           BillingService.VerifyInvoice(verifyInvoiceVo, response => Listener.GetResult(response, out output)); 
    }
    catch (PodException podException)
    {
        Console.WriteLine($"-- {podException.Code}-an error has occured : 
                              {Environment.NewLine{podException.Message}");
        throw;
    }
catch (Exception exception)
    {
        Console.WriteLine(exception.Message);
        throw;
    }
```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/verifyInvoice/</div>

# [Java](#tab/java)

``` java
//List<String> scVoucherHashs = new ArrayList<>();
//scVoucherHashs.add("");

BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
        .setToken(TOKEN)
        .setToken_issuer(1)
        //.setScVoucherHash("")
        //.setScApiKey("")
        .build();

BillingService billingService = new BillingService();


try {
    VerifyInvoiceVo verifyInvoiceVo = new VerifyInvoiceVo.Builder(baseInfoVo)
    //.setId({id})
            .setBillNumber({billNumber})
            .build();
    billingService.verifyInvoice(verifyInvoiceVo, new OnGetResponseListener<InvoiceSrv>() {
        @Override
        public void onResponse(ResultVo<InvoiceSrv> result) {
            System.out.println(result.getResult().getId());
        }

        @Override
        public void onFailed(PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
    });
} 
catch (
        PodException e) {
    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
}

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/verifyInvoice/</div>

# [PHP](#tab/php)

``` php
$param =
        [
            ## =========================== Optional Parameters  ===========================
            'id'                => '{invoice id}',
            'billNumber'        => 'billNumber',
            'scVoucherHash'     => ['{Put Service Call Voucher Hashes}'],
            'scApiKey'           => '{Put service call Api Key}',

        ];
    try {
        $result = $BillingService->verifyInvoice($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/verifyInvoice/</div>

# [Nodejs](#tab/nodejs)

``` javascript
let verifyInvoiceData = {
  // ------ REQUIRED (One of these fields is required) ------
  id: 0, // Invoice ID
  billNumber: 'BILLNUMBER'

  // ------ OPTIONAL ------
  // scVoucherHash: ['HASH#1', 'HASH#2']
  // token: 'API TOKEN'
  // tokenIssuer: 0 | 1
  // scApiKey: ' SC API KEY'
};
podBillingService.verifyInvoice(verifyInvoiceData)
  .then(function (result) {
    console.log('function: verifyInvoice ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error verifyInvoice ============>', error);
  });


```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/verifyInvoice/</div>

<div class="tab-end">
</div>




<div class="box-end">
</div>


## بستن فاکتور

برای مشاهده فاکتورهایی که کسب و کار شما صادر نموده و وضعیت آنها می توانید به پنل مدیریت کسب و کار خود به آدرسهمچنین برای جستجو در متادیتای ثبت شده برای فاکتور می توانید از سرویس زیر استفاده نماییدفاکتور هایی که بسته شوند دیگر قابل ابطال نیستند. برای اینکه بتوانید مبالغ فروش خود را تسویه نمایید لازم است حتما فاکتورها را ببندید.

<br/>

چنان چه فاکتورها به صورت safe=true صادر شده باشد و یا فاکتور متعلق به کسب و کار شما نباشد پیغام خطای " اجازه بستن این فاکتور را ندارید " دریافت خواهید کرد.


<div class="tab-start">
</div>

# [C#](#tab/csharp)

``` csharp
try
    {
        var internalServiceCallVo = InternalServiceCallVo.ConcreteBuilder
            .SetToken("{Put your ApiToken}")
            //.SetScVoucherHash({Put your VoucherHash})
            //.SetScApiKey("{Put your ApiKey}")
            .Build();
            var output = new ResultSrv<bool>();
            var closeInvoiceVo = CloseInvoiceVo.ConcreteBuilder
                                .SetServiceCallParameters(internalServiceCallVo)
                                .SetId({put your id})
                                .Build();
            BillingService.CloseInvoice(closeInvoiceVo, response => Listener.GetResult(response, out output));
    }
    catch (PodException podException)
    {
        Console.WriteLine($"-- {podException.Code}-an error has occured : 
                              {Environment.NewLine{podException.Message}");
        throw;
    }
catch (Exception exception)
    {
        Console.WriteLine(exception.Message);
        throw;
    }
```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/closeInvoice/</div>

# [Java](#tab/java)

``` java
//        List<String> scVoucherHashs =new ArrayList<>();
//        scVoucherHashs.add("RFSFGDYEDYGS");
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
//                .setScApiKey("SDFJKSHFJwshfJshfDJH")
//                .setScVoucherHash(scVoucherHashs)
                .build();

        BillingService billingService = new BillingService();




        try {
            CloseInvoiceVo closeInvoiceVo = new CloseInvoiceVo.Builder(baseInfoVo)
                    .setId(3360466L)
//                    .setScVoucherHash(scVoucherHashs)
                    .build();
            billingService.closeInvoice(closeInvoiceVo, new OnGetResponseListener<Boolean>() {
                @Override
                public void onResponse(ResultVo<Boolean> result) {
                    System.out.println(result.getResult());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/closeInvoice/</div>

# [PHP](#tab/php)

``` php
$param =
        [
            ## ========================= *Required Parameters  ======================
            'id' => '{put invoice id}',
            'scVoucherHash'     => ['{Put Service Call Voucher Hashes}'],
            'scApiKey'           => '{Put service call Api Key}',
        ];
    try {
        $result = $BillingService->closeInvoice($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/closeInvoice/</div>

# [Nodejs](#tab/nodejs)

``` javascript
let closeInvoiceData = {
  // ------ REQUIRED ------
  id: 0 // INVOICE ID

  // ------ OPTIONAL ------
  // scVoucherHash: ['HASH#1', 'HASH#2']
  // token: 'API TOKEN'
  // tokenIssuer: 0 | 1
  // scApiKey: ' SC API KEY'
};

podBillingService.closeInvoice(closeInvoiceData)
  .then(function (result) {
    console.log('function: closeInvoice ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error closeInvoice ============>', error);
  });


```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/closeInvoice/</div>

<div class="tab-end">
</div>




<div class="box-end">
</div>


## تایید و بستن فاکتور در یک مرحله

با فراخوانی سرویس verifyAndCloseInvoice، می‌توانید همزمان تایید و بستن فاکتور را انجام دهید

<br/>

هنگام استفاده از این وب سرویس به نکات زیر دقت نمایید:

- مبلغ فاکتور بعد از واریز شاپرک قابل برداشت خواهد بود
- بعد از فراخوانی این سرویس امکان کاهش فاکتور یا لغو فاکتور وجود ندارد
- جهت واریز وجه به مشتری پرداخت کننده فاکتور، لازم است از سرویس transferByInvoice استفاده نمایید که شامل کارمزد می باشد.
- بعد از فراخوانی این سرویس وضعیت فاکتور دیگر تغییر نخواهد کرد


<div class="tab-start">
</div>

# [C#](#tab/csharp)

``` csharp
try
    {
        var internalServiceCallVo = InternalServiceCallVo.ConcreteBuilder
            .SetToken("{Put your ApiToken}")
            //.SetScVoucherHash({Put your VoucherHash})
            //.SetScApiKey("{Put your ApiKey}")
            .Build();
            var output = new ResultSrv<InvoiceSrv>();
            var verifyAndCloseInvoiceVo = VerifyAndCloseInvoiceVo.ConcreteBuilder
                                .SetServiceCallParameters(internalServiceCallVo)
                                .SetId({put your id})
                                .Build();
            BillingService.VerifyAndCloseInvoice(verifyAndCloseInvoiceVo,response => Listener.GetResult(response, out output));
    }
    catch (PodException podException)
    {
        Console.WriteLine($"-- {podException.Code}-an error has occured : 
                              {Environment.NewLine{podException.Message}");
        throw;
    }
catch (Exception exception)
    {
        Console.WriteLine(exception.Message);
        throw;
    }
```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/verifyAndCloseInvoice/</div>

# [Java](#tab/java)

``` java
//        List<String> scVoucherHashs =new ArrayList<>();
//        scVoucherHashs.add("RFSFGDYEDYGS");
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
//                .setScApiKey("SDFJKSHFJwshfJshfDJH")
//                .setScVoucherHash(scVoucherHashs)
                .build();

        BillingService billingService = new BillingService();




        try {
            VerifyAndCloseInvoiceVo verifyAndCloseInvoiceVo = new VerifyAndCloseInvoiceVo.Builder(baseInfoVo)
                    .setId(3581653L)
                    .build();
            billingService.verifyAndCloseInvoice(verifyAndCloseInvoiceVo, new OnGetResponseListener<InvoiceSrv>() {
                @Override
                public void onResponse(ResultVo<InvoiceSrv> result) {
                    System.out.println(result.getResult().getId());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/verifyAndCloseInvoice/</div>

# [PHP](#tab/php)

``` php
$param =
        [
            ## ========================= *Required Parameters  ======================
            'id' => '{put invoice id}', 
            ## ======================== Optional Parameters  ========================
            'scVoucherHash'     => ['{Put Service Call Voucher Hashes}'],
            'scApiKey'           => '{Put service call Api Key}',
        ];
    try {
        $result = $BillingService->verifyAndCloseInvoice($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/verifyAndCloseInvoice/</div>

# [Nodejs](#tab/nodejs)

``` javascript
let verifyAndCloseInvoiceData = {
  // ------ REQUIRED ------
  id: 0 // INVOICE ID

  // ------ OPTIONAL ------
  // scVoucherHash: ['HASH#1', 'HASH#2']
  // token: 'API TOKEN'
  // tokenIssuer: 0 | 1
  // scApiKey: ' SC API KEY'
};

podBillingService.verifyAndCloseInvoice(verifyAndCloseInvoiceData)
  .then(function (result) {
    console.log('function: verifyAndCloseInvoice ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error verifyAndCloseInvoice ============>', error);
  });


```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/verifyAndCloseInvoice/</div>

<div class="tab-end">
</div>




<div class="box-end">
</div>


## ابطال فاکتور

در صورتی که به هر دلیل بخواهید فاکتوری را ابطال کنید می توانید از سرویس cancelInvoice استفاده کنید.

<br/>

در صورتی که فاکتور باطل شود، دیگر قابل پرداخت نیست و در صورتی که قبلا پرداخت شده باشد، مبلغ آن به پرداخت کننده برگشت خواهد خورد.

<br/>

توجه: در صورتی که فاکتور با شرایط safe=true صادر شده باشد، فقط پرداخت کننده می تواند فاکتور را کنسل کند و اگر safe نباشد فقط صادر کننده فاکتور مجاز به کنسلی فاکتور می باشد.


<div class="tab-start">
</div>

# [C#](#tab/csharp)

``` csharp
try
    {
        var internalServiceCallVo = InternalServiceCallVo.ConcreteBuilder
            .SetToken("{Put your ApiToken}")
            //.SetScVoucherHash({Put your VoucherHash})
            //.SetScApiKey("{Put your ApiKey}")
            .Build();
            var output = new ResultSrv<bool>();
            var cancelInvoiceVo = CancelInvoiceVo.ConcreteBuilder
                                .SetServiceCallParameters(internalServiceCallVo)
                                .SetId({put your id})
                                .Build();
            BillingService.CancelInvoice(cancelInvoiceVo, response => Listener.GetResult(response, out output));
    }
    catch (PodException podException)
    {
        Console.WriteLine($"-- {podException.Code}-an error has occured : 
                              {Environment.NewLine{podException.Message}");
        throw;
    }
catch (Exception exception)
    {
        Console.WriteLine(exception.Message);
        throw;
    }
```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/cancelInvoice/</div>

# [Java](#tab/java)

``` java
//        List<String> scVoucherHashs =new ArrayList<>();
//        scVoucherHashs.add("RFSFGDYEDYGS");
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
//                .setScApiKey("SDFJKSHFJwshfJshfDJH")
//                .setScVoucherHash(scVoucherHashs)
                .build();

        BillingService billingService = new BillingService();




        try {
            CancelInvoiceVo cancelInvoiceVo = new CancelInvoiceVo.Builder(baseInfoVo)
                    .setId(3581653L)
                    .build();
            billingService.cancelInvoice(cancelInvoiceVo, new OnGetResponseListener<Boolean>() {
                @Override
                public void onResponse(ResultVo<Boolean> result) {
                    System.out.println(result.getResult());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/cancelInvoice/</div>

# [PHP](#tab/php)

``` php
 $param =
        [
            ## ============================ *Required Parameters  =========================
            'id' => '{put invoice id}', # شناسه فاکتور
            ## =========================== Optional Parameters  ===========================
            'scVoucherHash'     => ['{Put Service Call Voucher Hashes}'],
            'scApiKey'           => '{Put service call Api Key}',
        ];
    try {
        $result = $BillingService->cancelInvoice($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/cancelInvoice/</div>

# [Nodejs](#tab/nodejs)

``` javascript
let cancelInvoiceData = {
  // ------ REQUIRED ------
  id: 0 // Invoice ID

  // ------ OPTIONAL ------
  // scVoucherHash: ['HASH#1', 'HASH#2']
  // token: 'API TOKEN'
  // tokenIssuer: 0 | 1
  // scApiKey: ' SC API KEY'
};
podBillingService.cancelInvoice(cancelInvoiceData)
  .then(function (result) {
    console.log('function: cancelInvoice ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error cancelInvoice ============>', error);
  });


```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/cancelInvoice/</div>

<div class="tab-end">
</div>




<div class="box-end">
</div>


## کاهش فاکتور

در مواردی ممکن است نیاز به تغییری در بندهای فاکتور داشته باشید. در صورتی که فاکتور پرداخت نشده است، فاکتور قبلی را باطل (cancel) نمایید و فاکتور جدیدی صادر کنید. اگر فاکتور پرداخت شده است(در صورتی که باید پول بیشتری از مشتری دریافت نمایید)، لازم است فاکتوری جداگانه به مبلغ افزوده شده، با ذکر دلیل صادر نموده و مشتری را مجددا برای پرداخت هدایت نمایید. در برخی مواقع لازم است مبلغی از فاکتور پرداخت شده به مشتری بازگردانده شود. برای این منظور از سرویس ReduceInvoice برای اصلاح فاکتور پرداخت شده استفاده نمایید.

<br/>

توجه: تعداد پارامترهای []invoiceItemId و []itemDescription و []price و []quantity باید با هم برابر و برابر با تعداد آنها در فاکتور اول باشد.

<br/>

به این ترتیب موارد زیر اجرا می شوند:

- فاکتور اول باطل شده و یک فاکتور جدید با همان خصوصیات قبلی و با اصلاحات بالا صادر شده و billNumber فاکتور اول Null می شود.
- فیلد edited در فاکتور اول true می شود.
- در فاکتور جدید مقدار editedInvoiceId برابر با id فاکتور اول قرار می گیرد.
- در لیست فاکتورها فقط فاکتورهای ویرایش نشده نمایش داده می شوند مگر اینکه دقیقاً id فاکتور ویرایش شده مورد نظر ارسال شود.
- فاکتور ویرایش شده قابل بستن یا باطل شدن نیست و لازم است فاکتور نهایی بسته یا باطل شود.
- اگر فاکتور اول با مقدار مالیات پیشفرض سیستم ثبت شده باشد و در اصلاح فاکتور نیز داده نشود، در صورتی که مالیات پیشفرض سیستم عوض شده باشد، فاکتور دوم نیز با مالیات پیشفرض جدید ثبت خواهد شد.



<div class="tab-start">
</div>

# [C#](#tab/csharp)

``` csharp
try
    {
        var internalServiceCallVo = InternalServiceCallVo.ConcreteBuilder
            .SetToken("{Put your ApiToken}")
            //.SetScVoucherHash({Put your VoucherHash})
            //.SetScApiKey("{Put your ApiKey}")
            .Build();
            var output = new ResultSrv<InvoiceSrv>();
            var reduceInvoiceVo = ReduceInvoiceVo.ConcreteBuilder
                                .SetServiceCallParameters(internalServiceCallVo)
                                .SetId({Put your id})
                                .SetInvoiceItemsInfo(new List<InvoiceItemInfoVo>
                                {
                                    InvoiceItemInfoVo.ConcreteBuilder.SetInvoiceItemId({Put your id}).SetItemDescription("{Put your description}").SetPrice({Put your price}).SetQuantity({Put your quantity}).Build(),
                                    InvoiceItemInfoVo.ConcreteBuilder.SetInvoiceItemId({Put your id}).SetItemDescription("{put your description}").SetPrice({Put your price}).SetQuantity({Put your quantity}).Build()
                                })
                                //.SetPreferredTaxRate({Put your PreferredTaxRate})
                                .Build();
            BillingService.ReduceInvoice(reduceInvoiceVo, response => Listener.GetResult(response, out output));
    }
    catch (PodException podException)
    {
        Console.WriteLine($"-- {podException.Code}-an error has occured : 
                              {Environment.NewLine{podException.Message}");
        throw;
    }
catch (Exception exception)
    {
        Console.WriteLine(exception.Message);
        throw;
    }
```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/reduceInvoice/</div>

# [Java](#tab/java)

``` java
//        List<String> scVoucherHashs = new ArrayList<>();
//        scVoucherHashs.add("");

BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
        .setToken(TOKEN)
        .setToken_issuer(1)
        //.setScVoucherHash("")
        //.setScApiKey("")
        .build();

BillingService billingService = new BillingService();
List<InvoiceItemInfoVo> invoiceItemInfoVos = new ArrayList<>();
InvoiceItemInfoVo invoiceItemInfoVo = new InvoiceItemInfoVo();
invoiceItemInfoVo.setInvoiceItemId({id});
invoiceItemInfoVo.setPrice(new BigDecimal({price}));
invoiceItemInfoVo.setItemDescription("");
invoiceItemInfoVo.setQuantity(new BigDecimal({quntity}));
invoiceItemInfoVos.add(invoiceItemInfoVo);


try {
    ReduceInvoiceVo reduceInvoiceVo = new ReduceInvoiceVo.Builder(baseInfoVo)
            .setId({id})
         .setInvoiceItemsInfo(invoiceItemInfoVos)

            .build();
    billingService.reduceInvoice(reduceInvoiceVo, new OnGetResponseListener<InvoiceSrv>() {
        @Override
        public void onResponse(ResultVo<InvoiceSrv> result) {
            System.out.println(result.getResult().getId());
        }

        @Override
        public void onFailed(PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }
    });
} 
catch (
        PodException e) {
    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
}

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/reduceInvoice/</div>

# [PHP](#tab/php)

``` php
$param =
        [
            ## ======================= *Required Parameters  ==================
            'id' => '{put invoice id}', 
            'invoiceItemList' => [
                [
                    'invoiceItemId' => '{put invoice id of item 1}', 
                    'price' => '{put price of item 1}',
                    'quantity' => '{put quantity of item 1}', 
                    'itemDescription' => 'reduce invoice', 
                ],
                [
                    'invoiceItemId' => '{put invoice id of item 2}', 
                    'price' => '{put price of item 2}',
                    'quantity' => '{put quantity of item 2}', 
                    'itemDescription' => 'reduce invoice', 
                ],
            ],
            ## ===================== Optional Parameters  ======================
            'preferredTaxRate' => '{put tax, default 0.09}',
            'scVoucherHash'     => ['{Put Service Call Voucher Hashes}'],
            'scApiKey'           => '{Put service call Api Key}',
        ];
    try {
        $result = $BillingService->reduceInvoice($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/reduceInvoice/</div>

# [Nodejs](#tab/nodejs)

``` javascript
let reduceInvoiceData = {
  // ------ REQUIRED ------
  id: 0, // INVOICE ID
  invoiceItemList: [
    { productId: 0, price: 0, quantity: 0, productDescription: 'DESCRIPTION' },
    { productId: 0, price: 0, quantity: 0, productDescription: 'DESCRIPTION' }
  ]

  // ------ OPTIONAL ------
  // preferredTaxRate: TAX RATE
  // scVoucherHash: ['HASH#1', 'HASH#2']
  // token: 'API TOKEN'
  // tokenIssuer: 0 | 1
  // scApiKey: ' SC API KEY'
};
podBillingService.reduceInvoice(reduceInvoiceData)
  .then(function (result) {
    console.log('function: reduceInvoice ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error reduceInvoice ============>', error);
  });


```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/reduceInvoice/</div>

<div class="tab-end">
</div>

<div class="box-end">
</div>




## دریافت فایل لیست فاکتورها

<div class="mermaid">
graph TD  
A((شروع))  
A-.->B  
B(ایجاد گزارش فاکتور)-.->C  
C(شروع ایجاد فایل گزارش توسط پاد)-.->E  
E{وضعیت فایل} 
E-- در حال آماده سازی ---C 
E-- خطا ---N 
N(خطا در گزارش لیست فاکتورها)
E-- ایجاد شد ---F 
F(دانلود فایل)-.->M
M((پایان))
</div>

برای مشاهده فاکتورهایی که کسب و کار شما صادر نموده و وضعیت آنها می توانید به پنل مدیریت کسب و کار خود به آدرس https://panel.pod.ir مراجعه نمایید و از منوی « مالی ، فاکتورها » آنها را مشاهده نمایید. این قسمت امکان فیلتر یا جستجو در شرح فاکتورها را نیز دارد.

<br/>
همچنین می توانید برای استفاده در برنامه خود، از API زیر استفاده نمایید.


<div class="box-end">
</div>


## دریافت فایل خروجی فاکتورها

توسط سرویس getInvoiceListAsFile امکان جستجو و دریافت فایل فاکتورهای صادر شده توسط کسب و کار قابل انجام خواهد بود و میتوانید ازخروجی این سرویس یک فایل اکسل با فیلترهای متنوع دریافت کنید.

<br/>

بدیهی است در سرویس بالا با توجه به اختیاری بودن اکثر فیلترها اگر هیچ یک از فیلترهای اختیاری ارسال نشود گزارش حجیم تر و کاملتری در اکسل خواهید داشت و هرچه تعداد فیلترها بیشتر باشد گزارش دقیق تر و سبک تری در اختیار خواهید داشت.

<br/>

با فراخوانی این سرویس درخواست شما ثبت شده و بعد از مدتی گزارش آماده دریافت است، که برای دریافت گزارش می توانید از سرویس دریافت وضعیت خروجی فاکتورها استفاده نمایید.


<div class="tab-start">
</div>

# [C#](#tab/csharp)

``` csharp
try
    {
        var internalServiceCallVo = InternalServiceCallVo.ConcreteBuilder
            .SetToken("{Put your ApiToken}")
            //.SetScVoucherHash({Put your VoucherHash})
            //.SetScApiKey("{Put your ApiKey}")
            .Build();
            var output = new ResultSrv<InvoiceSrv>();
            var getInvoiceListAsFileVo = GetInvoiceListAsFileVo.ConcreteBuilder
                                .SetServiceCallParameters(internalServiceCallVo)
                                .SetLastNRows({Put your LastNRows})
                                //.SetFromDate({Put your FromDate})
                                //.SetToDate({Put your ToDate})
                                //.SetGuildCode("{Put your GuildCode}")
                                //.SetId({Put your Id})
                                //.SetBillNumber("{Put your BillNumber}")
                                //.SetUniqueNumber("{Put your UniqueNumber}")
                                //.SetTrackerId({Put your TrackerId})
                                //.SetIsCanceled({Put your IsCanceled})
                                //.SetIsClosed({Put your IsClosed})
                                //.SetIsPayed({Put your IsPayed})
                                //.SetIsWaiting({Put your IsWaiting})
                                //.SetReferenceNumber("{Put your ReferenceNumber}")
                                //.SetUserId({Put your UserId})
                                //.SetQuery("{Put your Query}")
                                //.SetProductIdList({Put your ProductIdList})
                                //.SetCallbackUrl("{Put your CallbackUrl}")
                                .Build();
            BillingService.GetInvoiceListAsFile(getInvoiceListAsFileVo,response => Listener.GetResult(response, out output));
    }
    catch (PodException podException)
    {
        Console.WriteLine($"-- {podException.Code}-an error has occured : 
                              {Environment.NewLine{podException.Message}");
        throw;
    }
catch (Exception exception)
    {
        Console.WriteLine(exception.Message);
        throw;
    }
```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getInvoiceListAsFile/</div>

# [Java](#tab/java)

``` java
//        List<String> scVoucherHashs =new ArrayList<>();
//        scVoucherHashs.add("RFSFGDYEDYGS");
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken(TOKEN)
                .setToken_issuer(1)
//                .setScApiKey("SDFJKSHFJwshfJshfDJH")
//                .setScVoucherHash(scVoucherHashs)
                .build();

        BillingService billingService = new BillingService();




        try {
            GetInvoiceListAsFileVo getInvoiceListAsFileVo = new GetInvoiceListAsFileVo.Builder(baseInfoVo)
                    .setLastNRows(10L)
                    .build();
            billingService.getInvoiceListAsFile(getInvoiceListAsFileVo, new OnGetResponseListener<ExportServiceSrv>() {
                @Override
                public void onResponse(ResultVo<ExportServiceSrv> result) {
                    System.out.println(result.getResult().getId());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getInvoiceListAsFile/</div>

# [PHP](#tab/php)

``` php
$param =
        [
            ## ============================ *Required Parameters  =========================
             # یکی از این سه فیلد اجباری است
            'lastNRows' => '{put last n rows}', 
            'fromDate' => 'yyyy/mm/dd hh:mi:ss', 
            'toDate' => 'yyyy/mm/dd hh:mi:ss', 
            ## =========================== Optional Parameters  ===========================
            'guildCode' => '{put guild code}', # کد صنف
            'id' => '{put invoice id}',
            'billNumber' => '{put bill number}',
            'uniqueNumber' => '{put unique number}',
            'trackerId' => '{put tracker id}',
            'isCanceled' => '{true/false}',
            'isPayed' => '{true/false}',
            'isClosed' => '{true/false}',
            'isWaiting' => '{true/false}',
            'referenceNumber' => '{put reference number}', 
            'userId' => '{put user id}',
            'query' => '{put query}',
            'productIdList' => [],  #
            'callbackUrl' => '{put call back url}'
            'scVoucherHash'     => ['{Put Service Call Voucher Hashes}'],
            'scApiKey'           => '{Put service call Api Key}',
        ];
    try {
        $result = $BillingService->getInvoiceListAsFile($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getInvoiceListAsFile/</div>

# [Nodejs](#tab/nodejs)

``` javascript
let getInvoiceListAsFileData = {
  // ------ REQUIRED (One of these fields is required) ------
  lastNRows: 0,
  fromDate: 'YYYY/MM/DD HH:MM:SS', // or 'YYYY/MM/DD'
  toDate: 'YYYY/MM/DD HH:MM:SS' // or 'YYYY/MM/DD'

  // ------ OPTIONAL ------
  // id: ID
  // billNumber: 'BILL NUMBER'
  // uniqueNumber: 'UNIQUE NUMBER'
  // trackerId: ID
  // isCancelled: true | false
  // isPayed: true | false
  // isClosed: true | false
  // isWaiting: true | false
  // guildCode: 'GUILD CODE'
  // referenceNumber: 'REFERENCE NUMBER'
  // query: 'QUERY'
  // productIdList: ARRAY OF INTEGERS
  // callbackUrl: 'CALL BACK URL'
  // scVoucherHash: ['HASH#1', 'HASH#2']
  // token: 'API TOKEN'
  // tokenIssuer: 0 | 1
  // scApiKey: ' SC API KEY'
};

podBillingService.getInvoiceListAsFile(getInvoiceListAsFileData)
  .then(function (result) {
    console.log('function: getInvoiceListAsFile ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error getInvoiceListAsFile ============>', error);
  });

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getInvoiceListAsFile/</div>

<div class="tab-end">
</div>

<div class="box-end">
</div>


## دریافت وضعیت خروجی فاکتورها

جهت مشاهده وضعیت هریک از سرویس های درخواست داده شده خود میتوانید از سرویس getExportList استفاده نمایید.
در صورتی که هر یک از گزارش ها آماده باشد وضعیت (statusCode) آن برابر با EXPORT_SERVICE_STATUS_SUCCESSFUL است، که به این معنی است شما می توانید آن را دانلود نمایید.

<br/>

<div class="tab-start">
</div>

# [C#](#tab/csharp)

``` csharp
try
    {
        var internalServiceCallVo = InternalServiceCallVo.ConcreteBuilder
            .SetToken("{Put your ApiToken}")
            //.SetScVoucherHash({Put your VoucherHash})
            //.SetScApiKey("{Put your ApiKey}")
            .Build();
            var output = new ResultSrv<List<ExportServiceSrv>>();
            var getExportListVo = GetExportListVo.ConcreteBuilder
                                .SetServiceCallParameters(internalServiceCallVo)
                                .SetOffset({Put your Offset})
                                //.SetSize({Put your Size})
                                //.SetId({Put your Id})
                                //.SetStatusCode({Put your StatusCode})
                                //.SetServiceUrl("{Put your ServiceUrl}")
                                .Build();
            BillingService.GetExportList(getExportListVo, response => Listener.GetResult(response, out output));
            var link=getExportListVo.GetLink({Put your FileId}, "{Put your HashCode}");
    }
    catch (PodException podException)
    {
        Console.WriteLine($"-- {podException.Code}-an error has occured : 
                              {Environment.NewLine{podException.Message}");
        throw;
    }
catch (Exception exception)
    {
        Console.WriteLine(exception.Message);
        throw;
    }
```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getExportList/</div>

# [Java](#tab/java)

``` java
//        List<String> voucherHashs =new ArrayList<>();
//        voucherHashs.add({voucherHash}); 
BaseInfoVo baseInfoVo = new BaseInfoVo.Builder()
                .setToken({token})
                .setToken_issuer(1)
//                .setScApiKey("SDFJKSHFJwshfJshfDJH")
//                .setScVoucherHash(scVoucherHashs)
                .build();

        BillingService billingService = new BillingService();  
        EnumFileStatusCode enumFileStatusCode = EnumFileStatusCode.EXPORT_SERVICE_STATUS_SUCCESSFUL;


        try {
            GetExportListVo getExportListVo = new GetExportListVo.Builder(baseInfoVo)
                    .setOffset({offset})
                    .setSize({size})
                    .setStatusCode(enumFileStatusCode.getValue())
                    .build();
            billingService.getExportList(getExportListVo, new OnGetResponseListener<List<ExportServiceSrv>>() {
                @Override
                public void onResponse(ResultVo<List<ExportServiceSrv>> result) {
                    LinkSrv linkSrv=new LinkSrv();
                    linkSrv=getExportListVo.getLink(result.getResult().get(0).getResultFile().getId(),result.getResult().get(0).getResultFile().getHashCode());
                    System.out.println(linkSrv.getRedirectUrl());
                }

                @Override
                public void onFailed(PodException e) {
                    System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
                }
            });
        } catch (PodException e) {
            System.out.println("code : " + e.getCode() + "\nmessage : " + e.getMessage());
        }

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getExportList/</div>

# [PHP](#tab/php)

``` php
$param =
        [
            ## ========================= *Required Parameters  ======================
            'offset' => '{put offset}',
            'size' => '{put size}', 
            'id' => '{put request id}',
            ## ======================== Optional Parameters  ========================
            'statusCode' => '{put status code}',
            'serviceUrl' => '{put server url}', 
            'scVoucherHash'     => ['{Put Service Call Voucher Hashes}'],
            'scApiKey'           => '{Put service call Api Key}',
        ];
    try {
        $result = $BillingService->getExportList($param);
        print_r($result);
    } catch (ValidationException $e) {
        print_r($e->getResult());
        print_r($e->getErrorsAsArray());
    } catch (PodException $e) {
        print_r($e->getResult());
    }

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getExportList/</div>

# [Nodejs](#tab/nodejs)

``` javascript
let getExportListData = {
  // ------ REQUIRED ------
  offset: 0,
  sie: 0

  // ------ OPTIONAL ------
  // id: 0
  // statusCode: 'EXPORT_SERVICE_STATUS_CREATED' | 'EXPORT_SERVICE_STATUS_RUNNING' |'EXPORT_SERVICE_STATUS_SUCCESSFUL' | 'EXPORT_SERVICE_STATUS_FAILED'
  // serviceUrl: 'SERVICE URL'
  // scVoucherHash: ['HASH#1', 'HASH#2']
  // token: 'API TOKEN'
  // tokenIssuer: 0 | 1
  // scApiKey: ' SC API KEY'
};

podBilling.getExportList(getExportListData)
  .then(function (result) {
    console.log('function: getExportList ============>', result, '\n');
  })
  .catch(function (error) {
    console.log('error getExportList ============>', error);
  });

```
<div class="swaggerLink">http://core.pod.ir/apidocs/swagger-ui.html?srv=/nzh/biz/getExportList/</div>

<div class="tab-end">
</div>




<div class="box-end">
</div>


## خرید امن

امکان پرداخت امن برای نوع خاصی از کسب و کارها که امکان لغو یا تایید خرید را تا آخرین لحظه بر عهده مشتری می‌گذارند (مانند فروشندگان واسطه) بسیار مناسب است. در این حالت مشتری می تواند بعد از پرداخت فاکتور تا زمان اعلام شده توسط کسب و کار، آن را لغو و پول خورد را پس بگیرد یا آن را تایید نماید تا فروشنده پول خود را دریافت کند.

<br/>

برای فعال کردن این قابلیت تنها کافیست تا در زمان صدور فاکتور پارامتر safe را برابر true قرار دهید.

<div class="mermaid">
graph TD  
A((شروع))  
A-.->B  
B(صدور فاکتور)-.->C  
C(پرداخت)-.->D  
D{تایید خرید توسط مشتری} 
D-.->L  
D-- خیر -->M  
M(برگشت پول)
L(استعلام پرداخت)-.->E  
E{عملیات فاکتور} 
E-.->F  
E-.->G  
E-.->H   
F(ابطال فاکتور)-.->I
G(کاهش فاکتور)-.->I
H(بستن فاکتور)-.->I
I(تسویه حساب)-.->K
K((پایان))
</div>

<div class="box-end">
</div>

## لینک‌های مرتبط

- [مقدمه](/documents/introduction/)
- [مفاهیم](/documents/concepts/)
- [استاندارد و خطاها](/documents/errors/)
- [شروع به کار](/documents/get-started/)
- [پکیج‌ها](/documents/packages/)

<div class="box-end">
</div>

