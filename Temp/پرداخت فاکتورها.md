- [مقدمه](#menu)
- [پرداخت از طریق کیف پول](#menu)
- [پرداخت از درگاه](#menu)
- [پرداخت با پیامک](#menu)
- [پرداخت خارج از پلتفرم پاد](#menu)
- [پرداخت از طریق فاکتور دیگر](#menu)
- [پرداخت در آینده](#menu)
- [پرداخت از پایانه فروشگاهی-POS](#menu)
- [دریافت لینک پرداخت](#menu)
- [لینک‌های مرتبط](#menu)


## مقدمه

در مواردی ممکن است کسب و کار اقدام به فروش محصولات کسب و کار دیگر نماید یا به هر دلیلی بخشی از مبلغ دریافتی به یک یا چند کسب و کار دیگر تعلق داشته باشد. اهمیت این موضوع در امور مالیاتی مشهود و راه حل آن بسیار ضروری است.برای پرداخت کردن فاکتور ها روش های متفاوتی وجود دارد، که می توان با استفاده از این روش ها فاکتور را پرداخت کرد:

<br/>

در این شرایط کسب و کار می تواند نوعی فاکتور با قوانین تسهیم فروش بین کسب و کارهای ذینفع صادر نماید. ظاهراً خریدار تغییری را احساس نخواهد کرد و یک فاکتور تجمیعی را پرداخت می کند ولی در عمل، به تعداد ذینفعان با مبلغ تسهیمی فاکتور صادر شده و مبالغ مستقیماً پس از پرداخت به حساب صنفی آنها منتقل می شود.

<br/>

قوانین زیر در تسهیم وجود دارند:

- پرداخت از طریق کیف پول
- پرداخت از طریق کیف پول کسب و کار
- پرداخت از درگاه
- پرداخت با پیامک
- پرداخت خارج از پلتفرم پاد
- پرداخت از طریق فاکتور دیگر
- پرداخت در آینده
- پرداخت از طریق پایانه فروشگاهی (POS)


![](/assets/images/markdown/facture1.JPG)

<div class="box-end">
</div>

## پرداخت از طریق کیف پول


<div class="mermaid">
graph TD  
A((شروع))  
A-.->B  
B( ایجاد لینک پرداخت)-.->C  
C(هدایت کاربر به صفحه پرداخت از کیف پول)-.->N  
N{پرداخت توسط مشتری تایید شد} 
N-- خیر ---O 
N-- بله ---P
P(هدایت به صفحه بازگشت از خرید - مقدار redirect url)
P-.->M
M((پایان))
</div>

مشتری برای مشاهده فاکتور خود و پرداخت آن از طریق کیف پول خود، لازم است به آدرسی که توسط متد getPayInvoiceByWalletLink تولید می شود، هدایت شود. در این صفحه کاربر امکان پرداخت وجه از طریق درگاه بانک را نیز دارد و میتواند از اعتبار خرید نیز در صورت وجود استفاده نماید.

<br/>

مقدار invoiceId، مقداری است که از پاسخ سرویس issueInvoice با عنوان id دریافت می‌نمایید و این مقدار از billNumber که توسط خود کسب و کار انتخاب شده است، متمایز می‌باشد.

<br/>

در این حالت، مشتری باید لاگین باشد و در صورتی که شناسه اشتباه وارد شود با خطای " فاکتور یافت نشد " مواجه می شود.

<div class="box-end">
</div>


## پرداخت از درگاه

<div class="mermaid">
graph TD  
A((شروع))  
A-.->B  
B( ایجاد لینک پرداخت)-.->C  
C(هدایت کاربر به صفحه پرداخت از کیف پول)-.->N  
N(انجام پرداخت توسط مشتری)
N-- هدایت صفحه ---P 
P(هدایت به صفحه بازگشت از خرید - مقدار redirect url)
P-.->M
M((پایان))
</div>

کسب و کار میتواند برای تمام مشتریان خود، بدون نیاز به ورود به سامانه احراز هویت یکپارچه، امکان خرید را از طریق لینکی که متد getPayInvoiceByUniqueNumberLink تولید می کند، فراهم کند. برای این منظور لازم است کسب و کار از کد یکتا (uniqueNumber در خروجی صدور فاکتور ) که برای فاکتور تولید می شود استفاده نماید

<div class="box-end">
</div>


## پرداخت با پیامک


<div class="mermaid">
graph TD  
A((شروع))  
A-.->B  
B(ارسال پیامک به مشتری)-.->C  
C{پرداخت توسط مشتری تایید شد}
C-- خیر ---D 
D(پرداخت ناموفق)
C-- بله ---N  
N(انجام عملیات کسر از کیف پول توسط پاد)-.->M
M((پایان))
</div>

در صورتی که کاربر به رایانه جهت پرداخت دسترسی ندارد، یا در فروش حضوری، کسب و کار میتواند درخواست ارسال پیامک پرداخت به کاربر دهد و کاربر با پیامک کردن کدی که دریافت کرده به همان شماره، فاکتور را از کیف پول خود پرداخت مینماید.

<br/>

همچنین در پیامکی که به کاربر ارسال می شود، لینک پیش نمایش فاکتور نیز ارسال می شود تا در صورت نیاز کاربر فاکتور را مشاهده و بعد نسبت به پرداخت آن اقدام نماید.

<div class="box-end">
</div>



## پرداخت خارج از پلتفرم پاد

از طریق این سرویس کسب و کار قادر خواهد بود که پرداخت شدن برخی فاکتورهای خود را منوط به پرداخت شدن فاکتورهای دیگری نماید. یا به عبارتی نوعی تهاتر را بوسیله فاکتورها انجام دهد که این امر توسط سرویس payInvoiceByInvoice قابل اجرا خواهد بود

<br/>

خطاهای سرویس فوق به شرح جدول زیر میباشد

|    خطا            |شرح خطا               |
|----------------|--------------------------------
|فاکتور بستانکار پرداخت نشده است| هنوز فاکتور مربوطه جهت پرداخت بدهی پرداخت نشده است           
|مجوز انجام این عملیات را ندارید          | احتمالا خطایی در ارسال پارامتر ها وجود دارد مثلا مقدار پارامتر بستانکار و بدهکار جا به جا وارد شده است یا توکن کاربر صاحب فاکتور بدهکار اشتباه است         
|فاکتور بستانکار آماده برای مسدودی می باشد          | قبلا فاکتور مسدود شده و پس از تسویه شاپرک به حساب بستانکار واریز خواهد شد

جهت روشن تر شدن موضوع و درک بهتر استفاده از این سرویس سناریوی زیر را مشاهده بفرمایید.

<br/>

فرض کنید کسب و کار A فاکتوری را برای کسب و کار B صادر میکند و کسب و کار B برای پرداخت فاکتور مورد نظر میتواند اگر فاکتورقابل پرداختی دارد و برای مشتری یا کسب و کاری آن را صادر کرده است و مبلغ آن نیز فاکتور A را پوشش میدهد از طریق سرویس فوق این پرداخت را انجام دهد.

<br/>

**[ در خصوص استفاده از این سرویس به موارد زیر توجه داشته باشید ]**

<br/>

- فاکتوری که قرار است از طریق آن فاکتور شخص دیگری را پرداخت کنید باید در وضعیت پرداخت شده قرار بگیرد. در غیر این صورت سرویس فوق خطای " فاکتور بستانکار پرداخت نشده است " میدهد.
- فاکتور بدهکار شده پس از تسویه شاپرک قابل برداشت خواهد بود.
- پس از فراخوانی سرویس فوق در پاسخ دریافتی از سرویس مقدار true در result نمایش داده خواهد شد. که به معنی انجام شدن صحیح سرویس میباشد.
- اگر وضعیت فاکتور بستانکار را دریافت نمایید مقدار willBePaid در پاسخ سرویس برای فاکتور مربوطه true میباشد.
- اگر وضعیت فاکتور بدهکار را دریافت نمایید مقدار willBeBlockedدر پاسخ سرویس برای فاکتور مربوطه true میباشد. البته پس از پرداخت شدن فاکتور 


<div class="box-end">
</div>


## پرداخت در آینده


<div class="mermaid">
graph TD  
A((شروع))  
A-.->B  
B(ایجاد درخواست پرداخت در آینده توسط کاربر بدهکار)-.->C  
C(بررسی موجودی و بلوکه  کردن آن توسط پاد)-.->D
D(انجام عملیات پرداخت  ازکیف پول توسط پاد در سررسید)-.->N
N(تغییر وضعیت فاکتور به پرداخت شده )-.->M
M((پایان))
</div>

در فاکتور تسهیمی نیز مانند فاکتور عادی با لغو شدن، کل مبلغ فاکتور و با کاهش، قسمتی از مبلغ به مشتری بازگردانده می شود. ولی در فاکتور تسهیمی برای کاهش لازم است کل سهم ها مجدداً اعلام شوند تا مبلغی که کسر می شود از حساب درست برداشته شوداز طریق این سرویس کسب و کار قادر خواهد بود فاکتورهایی که برایش توسط دیگران صادر شده را درتاریخ آینده یا سررسید توافقی از طریق مبلغی که در کیف پول یا اصناف خود دارد پرداخت نماید .

<br/>
این سرویس باید توسط کسب و کار یا کاربر بدهکار یا شخصی که فاکتور برایش صادر شده صدا زده شود در غیر این صورت با خطای زیر روبرو خواهد شد.

<br/>

پس از فراخوانی سرویس فوق مبلغ فاکتورهای درخواست داده شده جهت پرداخت در آینده از [ کیف پول یا صنف مورد نظر برداشت شده ] و در حساب مسدودی کسب و کار که قابل برداشت توسط ایشان نیست نگهداری میشود و سپس در سررسیدهای تعیین شده به حساب کسب و کارهای تعهد شده واریز خواهد شد.

<br/>

همچنین اگر مبلغ مورد نیاز جهت پرداخت فاکتورها در آینده , توسط [ کیف پول کسب و کار یا اصناف قابل تامین نباشد ] و یا [ کمتر ] باشد اجازه استفاده از این سرویس به کسب و کار داده نمیشود و با خطای " اعتبار کافی جهت انجام عملیات مسدودی را ندارید " مواجه خواهید شد.

<br/>
**تــــوجه :**
 پلتفرم پاد پرداخت شدن تمامی فاکتورهای از این دست را در سررسیدهای تعیین شده  تضمین مینماید.
 همانطور که در تصویر زیر مشاهده میکنید پس از فراخوانی سرویس فوق در بخش حساب های پنل کسب و کار بدهکار کادری جهت نمایش مبالغ مسدود شده نمایش داده میشود که قابل گزارشگیری نیز میباشد
 
![](/assets/images/markdown/pay-invoice1.jpg)
 
 همچنین با کلیک بر روی دکمه " گزارش " در تصویر بالا در بخش حساب های پنل کسب و کاری ریز تراکنش های مربوط به حساب مسدودی برای شما نمایش داده میشود و هربار که سرویس فوق صدا زده میشود یک سند به همراه اطلاعات مربوط به مسدود سازی مبلغ در این بخش درج خواهد شد.
 
![](/assets/images/markdown/pay-invoice2.jpg)

همچنین پس از ثبت یک فاکتور بعنوان " فاکتور پرداخت در آینده "  اجازه پرداخت توسط سرویس های پرداخت فاکتور و یا کیف پول و درگاه بانکی تا سررسید مشخص شده وجود ندارد و با خطای " اجازه پرداخت این فاکتور را ندارید " و یا  " فاکتور در انتظار پرداخت توسط  تضمین ارائه شده میباشد "  را دریافت خواهید کرد.

![](/assets/images/markdown/pay-invoice3.jpg)

همچنین در هر زمان با دریافت وضعیت فاکتور میتوانید ببینید تاریخ پرداخت تعهد شده چه تاریخی میباشد که در فیلد willBePaidAt  به شکل timestamp  قابل مشاهده میباشد.

<br/>
همچنین کسب و کار بدهکار امکان کنسل یا لغو فاکتور را پس از ثبت بعنوان پرداخت در آینده ندارد. اما کاربر صادر کننده فاکتور این امکان را دارد تا فاکتور ثبت شده بعنوان پرداخت در آینده را در هر زمان تا قبل از پرداخت کنسل کند 

<div class="box-end">
</div>


## پرداخت از پایانه فروشگاهی-POS

در صورت نیاز می توانید برای فروشگاه خود پایانه فروشگاهی پاد مبتنی بر حساب مجازی راه اندازی نمایید. جهت استفاده از این امکان، مبلغ و شناسه فاکتور پاد جهت پرداخت به دستگاه پوز ارسال می شود. پس از انجام تراکنش موفق روی پوز، اطلاعات تراکنش با استفاده از سرویس payInvoiceByPos به پلتفرم پاد ارسال گردد.

<br/>
پارامتر invoiceId همان شناسه فاکتور در پاد است که به عنوان شناسه واریز تراکنش پوز نیز باید ارسال گردد.

<br/>
سایر موارد پس از تراکنش موفق از دستگاه پوز دریافت می گردد.

<br/>
این سرویس موارد دریافت شده را استعلام نموده و در صورت وجود و صحت تراکنش مربوطه، فاکتور را پرداخت می نماید. بنابرین لازم است قبل از فراخوانی این سرویس از موفقیت پرداخت پوز اطمینان حاصل نمایید.

<div class="box-end">
</div>

## دریافت لینک پرداخت

ممکن است لازم باشد لینک پرداخت برای مشتری با روش های مختلفی ارسال شود. این لینک قابل اشتراک گذاری خواهد بود و هر کسی که آن را داشته باشد می تواند آن را پرداخت نماید. برای دریافت لینک از سرویس getInvoicePaymentLink استفاده نمایید:

<br/>

که در صورت تمایل، می‌توانید پارامترهای redirectUri ، callbackUri و "gateway="PEP را نیز ارسال نمایید. اگر پارامتر "gateway="PEP را در لینک بگذارید، کاربر مستقیما به صفحه درگاه پرداخت بانک پاسارگاد هدایت خواهد شد و در صورت ارسال پارامتر redirectUri کاربر ملزم به تکمیل فرآیند خرید، خواهد بود.

<br/>

توجه داشته باشید که لینک فوق، شامل یک هش کد می‌باشد که مدت اعتبار آن 300 ثانیه می‌باشد؛لذا در صورتی که با پیغام خطای " کد وارد شده معتبر نمی‌باشد و یا منقضی شده است." روبه‌رو شدید ممکن است کد هش منقضی شده باشد.

<div class="box-end">
</div>

## لینک‌های مرتبط

- [مقدمه](/app/documents/introduction/)
- [مفاهیم](/app/documents/concepts/)
- [استاندارد و خطاها](/app/documents/errors/)
- [شروع به کار](/app/documents/get-started/)

<div class="box-end">
</div>

